- [1.1-自动驾驶定位技术（Localization）—GNSS - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/329169929)

![img](https://pic4.zhimg.com/80/v2-d4e8c815a755d17dd9751ccf7402bf6b_720w.jpg)

自动驾驶模块关系示意图

Localization在自动驾驶中是极为重要的一个模块，且自动驾驶对于定位的需求是显而易见的。好比我现在要从嘉定前往浦东坐飞机，首先我要打开高德地图搞清楚我在哪里，这样才能规划我去浦东机场的路线。但光做到这样还远远不够，因为作为一辆成熟的自动驾驶车辆，你要学会自己从车库出来然后出小区上高速，因此必须时刻知道自身所在的位置才能实时对规划的轨迹做出调整，而这一系列动作对于一辆车而言是高精度高难度操作，简单的给出“车辆在昌吉东路，前方路口左转弯”这种信息是远远不够的，我们需要更精确的“车辆在昌吉东路最右车道行驶，前方 10 米有车慢速行驶，准备超车”这样的信息。

行业内已有的定位解决方案:

1. GNSS（Global Navigation Satellite System）**：**全球导航卫星系统。比如我们常见的GPS（Global Positioning System），原苏联的GLONASS，欧盟的伽利略（GALILEO）以及中国的北斗（BDS）。传统的定位精度在大约为米级别的，无法满足自动驾驶需求，因此多使用 RTK （Real - time kinematic，实时动态）的方式。
2. IMU（Inertial Measurement Unit）:惯性传感器。利用加速度计和角速度计（陀螺仪）, 根据上一时刻的位置和方位推断现在的位置和方位，即航迹推测. 惯性导航和GPS可以结合起来使用, 惯性导航可以弥补GPS更新频率低的缺陷, GPS可以纠正惯性导航的运动误差. 但是, 如果是在地下隧道或者其他信号不好的地方, GPS可能无法及时纠正惯性导航的运动误差.
3. 传感器融合: 利用RADAR 和LIDAR, 记录道路外观的图像, 测量车辆到静态物体如建筑物,电线杆,路缘的距离, 将传感器的点云数据与高精地图储存的特征进行匹配, 并实现车辆坐标系与世界坐标系之间的转换, 确定最有可能位于的位置.
4. 摄像头: 利用摄像头, 记录道路外观的图像, 将摄像头的数据与地图进行匹配, 确定最有可能位于的位置

自动驾驶定位技术的组合方案：

- 基于 GPS 和惯性传感器的传感器融合
- 基于 LiDAR 点云与高精地图的匹配 (研究方向: 粒子滤波, 深度学习)
- 基于视觉的道路特征识别

拿自己组装的自动驾驶小车为例，我想实现一个车辆寻迹的功能，就需要GPS+IMU联合定位。

![img](https://pic3.zhimg.com/80/v2-81404d1b09cd45aeb3334ac481418a46_720w.jpg)

本文主要对GNSS原理进行介绍

------

我要知道我现在所在的位置，也就是确定自身的 XYZ 坐标，显然有三个未知量，那就借助卫星找三个方程求解即可。

![img](https://pic4.zhimg.com/80/v2-f7b9ff4b83646b02b15854966cda2e7f_720w.jpg)

三个卫星的位置坐标如上图所示，卫星在发送位置信息的同时，也会附加上该数据包发出时的时间戳。GPS接收器收到数据包后，用当前时间（当前时间当然只能由GPS接收器自己来确定了）减去时间戳上的时间，就是数据包在空中传输所用的时间了。因此我们找到三个卫星，利用时间差×光速去测算自身到这三个卫星的距离，结合这三个卫星的坐标就拿到了三个方程，从而解出自身的坐标 XYZ。

![[公式]](https://www.zhihu.com/equation?tex=%28x-x_%7B1%7D%29%5E%7B2%7D%2B%28y-y_%7B1%7D%29%5E%7B2%7D%2B%28z-z_%7B1%7D%29%5E%7B2%7D+%3D+%28%5CDelta+T_%7B1%7D%2Ac%29%5E%7B2%7D+%5C%5C+%28x-x_%7B2%7D%29%5E%7B2%7D%2B%28y-y_%7B2%7D%29%5E%7B2%7D%2B%28z-z_%7B2%7D%29%5E%7B2%7D+%3D+%28%5CDelta+T_%7B2%7D%2Ac%29%5E%7B2%7D+%5C%5C+%28x-x_%7B3%7D%29%5E%7B2%7D%2B%28y-y_%7B3%7D%29%5E%7B2%7D%2B%28z-z_%7B3%7D%29%5E%7B2%7D+%3D+%28%5CDelta+T_%7B3%7D%2Ac%29%5E%7B2%7D+)

然而这其中有个问题，就是三个卫星的时间不是同步的，可能卫星 1 的时间比 2 多 0.1s 、比 3 少 0.2s，这些微小的误差乘以光速后会变为很大的偏差，而我并不知道这三个卫星之间的时间关系。因此我们需要第四个卫星用于做时间同步，去修正卫星之间的时间戳误差。假设标准时间为 t0，这颗卫星的时间为 t4：

![[公式]](https://www.zhihu.com/equation?tex=%28x-x_%7B1%7D%29%5E%7B2%7D%2B%28y-y_%7B1%7D%29%5E%7B2%7D%2B%28z-z_%7B1%7D%29%5E%7B2%7D+%3D+%28%28%5CDelta+T_%7B1%7D-%28t_%7B1%7D-t_%7B4%7D%29%29%2Ac%29%5E%7B2%7D+%5C%5C+%28x-x_%7B2%7D%29%5E%7B2%7D%2B%28y-y_%7B2%7D%29%5E%7B2%7D%2B%28z-z_%7B2%7D%29%5E%7B2%7D+%3D+%28%28%5CDelta+T_%7B2%7D-%28t_%7B2%7D-t_%7B4%7D%29%29%2Ac%29%5E%7B2%7D+%5C%5C+%28x-x_%7B3%7D%29%5E%7B2%7D%2B%28y-y_%7B3%7D%29%5E%7B2%7D%2B%28z-z_%7B3%7D%29%5E%7B2%7D+%3D+%28%28%5CDelta+T_%7B3%7D-%28t_%7B3%7D-t_%7B4%7D%29%29%2Ac%29%5E%7B2%7D+%5C%5C+%28x-x_%7B4%7D%29%5E%7B2%7D%2B%28y-y_%7B4%7D%29%5E%7B2%7D%2B%28z-z_%7B4%7D%29%5E%7B2%7D+%3D+%28%28%5CDelta+T_%7B4%7D-%28t_%7B4%7D-t_%7B0%7D%29%29%2Ac%29%5E%7B2%7D+)

四个方程，四个未知数，就可以定出我当前的位置了。

------

以上就是 GPS 的基本原理，然而这种定位精度是米级的，并不算很高。

在这一定位过程中，存在着三部分误差。一部分是对每一个用户接收机所公有的，例如，卫星钟误差、星历误差、电离层误差、对流层误差等。因为导航卫星发射的信号从太空到地面的过程不是一帆风顺的，其在通过电离层、对流层等区域，电磁波信号会发生“延缓”，相当于信号在他们那里打了个弯。同时，导航卫星“告诉”用户的其位置坐标和时间也并不是绝对准确的（即卫星轨道误差）；第二部分为不能由用户测量或由校正模型来计算的传播延迟误差；第三部分为各用户接收机所固有的误差，例如内部噪声、通道延迟、多径效应等。

利用差分技术，第一部分误差完全可以消除，第二部分误差大部分可以消除，其主要取决于基准接收机和用户接收机的距离，第三部分误差则无法消除。

根据差分GPS基准站发送的信息方式可将差分GPS定位分为三类，即：位置差分、伪距差分和载波相位差分。这三类差分方式的工作原理是相同的，即都是由基准站发送修正数据，由用户站接收并对其测量结果进行修正，以获得精确的定位结果。所不同的是，发送修正数据的具体内容不一样，其差分定位精度也不同。

### 1. 位置差分原理

这是一种最简单的差分方法，任何一种GPS接收机均可改装和组成这种差分系统。安装在基准站上的GPS接收机观测4颗卫星后便可进行三维定位，解算出基准站的坐标。由于存在着轨道误差、时钟误差、SA影响、大气影响、多径效应以及其他误差，解算出的坐标与基准站的已知坐标是不一样的， 存在误差。基准站利用数据链将此**改正数**发送出去，由用户站接收，并且对其解算的用户站坐标进行改正。

最后得到的改正后的用户坐标已消去了基准站和用户站的共同误差，例如卫星轨道误差、 SA影响、大气影响等，提高了定位精度。以上先决条件是基准站和用户站观测同一组卫星的情况。 位置差分法适用于用户与基准站间距离在100km以内的情况。

### 2. 伪距差分原理(DGPS)也称为（RTD）

RTD(real time differential)——实时动态码相位差分技术

伪距差分是目前用途最广的一种技术。几乎所有的商用差分GPS接收机均采用这种技术。国际海事 无线电委员会推荐的RTCM SC-104也采用了这种技术。

在基准站上的接收机要求得它至可见卫星的距离，并将此计算出的距离与含有误差的测量值 加以比较。利用一个α-β滤波器将此差值滤波并求出其偏差。然后将**所有卫星的测距误差**传输 给用户，用户利用此测距误差来改正测量的伪距。最后，用户利用改正后的伪距来解出本身的位置， 就可消去公共误差，提高定位精度。

与位置差分相似，伪距差分能将两站公共误差抵消，但随着用户到基准站距离的增加又出现了系统误差，这种误差用任何差分法都是不能消除的。用户和基准站之间的距离对精度有决定性影响。利用伪距差分方法，定位精度可达到亚米级。

### 3. 载波相位差分原理(RTK)

载波相位差分技术又称之为RTK技术（real time kinematic），是建立在及时处理两个测站的载波相位基础上的。载波相位差分技术能实时提供观测点的三维坐标，并达到厘米级的高精度。

与伪距差分原理相同，由基准站通过数据链及时将其**载波观测值及基准站坐标信息**一同传送给用户站。用户站接收GPS卫星的载波相位与来自基准站的载波相位，并组成相位差分观测值进行及时处理，能及时给出厘米级的定位结果。

实现载波相位差分GPS的方法分为两类：修正法与差分法。前者和伪距差分相同，基准站把载波相位修正量发送给用户站，以改正其载波相位，之后求解坐标。后者把基准站采集的载波相位发送给 用户台进行求差解算坐标。前者是准RTK技术，后者为真正的RTK技术。



自动驾驶小车上安装两个天线用于确定小车的车头车尾姿态。双天线姿态测量采用的是相对定位载波相位观测法，在相同时刻测量基线向量两端天线接收到的 GPS 载波信号相位，求得相位差，用相位差法求解基线向量，得到载体的运动姿态。

![img](https://pic3.zhimg.com/80/v2-d254d1f55dc8b338ae69992f867dc4e6_720w.png)

以天线 B 为主天线，天线 A 为从天线。两个天线的基线距离为![[公式]](https://www.zhihu.com/equation?tex=l_%7Bab%7D),且该距离为固定值不变。根据双差公式（见参考文献6）可求得天线 A 和天线 B 的双差载波相位测量值，根据双差与基线向量方程可解得向量 ![[公式]](https://www.zhihu.com/equation?tex=l_%7Bab%7D)。且在一定范围内，基线距离越短，精度越高。

另外还有依靠云计算中心，搜集多个基站的信息给出精准坐标的方法。北斗的定位系统可以借助此方法达到毫米级的定位。但这一块开销过大且偏军用了，在此就不进行介绍了。

------

参考文献&博客

1. [GPS定位基本原理浅析](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/sddai/p/9692722.html)
2. [GPS几种基本定位模式原理概述及精度介绍](https://link.zhihu.com/?target=https%3A//www.pianshen.com/article/47681061208/)
3. [北斗导航真的能达到毫米级定位精度吗？](https://www.zhihu.com/question/65638680/answer/233896068)
4. [RTK+GPS提高定位精度原理解析](https://link.zhihu.com/?target=https%3A//blog.csdn.net/leeang121/article/details/107179265/)
5. [自动驾驶定位技术-马尔科夫定位](https://zhuanlan.zhihu.com/p/128520715)
6. 夏佩, 王峰, 黄祖德, & 邱文添. (2018). 基于双天线的rtk-gps定向方法. *中国新通信,**020*(022), 58-60.
7. [RTK与差分测量的区别](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/yejuelei/p/9899817.html)