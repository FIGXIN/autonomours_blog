- [(2 条消息) 高精地图和普通的导航地图有什么区别？科普一下国内高精地图专业平台？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/284050134)

## 引言

高精地图是相对于普通地图来说的，它提供了更高精度，内容更为丰富的地图信息，主要服务于自动驾驶。目前L2+及以上自动驾驶方案普遍对高精地图是有明确依赖的。如下图所示，高精地图可以说是数据流的最上游。



![img](https://pic3.zhimg.com/80/v2-d63d375419d0d573fd0418e1d2566010_720w.jpg?source=1940ef5c)

## 高精地图VS普通地图

对于高精地图，没有一个标准的定义。比普通SD地图在精细度或丰富度上面有更高要求的地图，常常都被称为高精地图。比如辅助驾驶中用到的ADAS地图，相对精度1m，绝对精度5m，有时也被称为高精地图。

| 对比   | 普通地图                          | 高精地图                                                     |
| ------ | --------------------------------- | ------------------------------------------------------------ |
| 精度   | 米级                              | 厘米级                                                       |
| 丰富度 | 普通地图主要包括道路，POI等信息。 | 高精地图除了包括普通地图都有的元素之外，还会包含路灯、护栏、红绿灯等几十个甚至上百个要素的信息。对于道路信息也会有更为丰富的车道、路口的精细信息。 |
| 应用   | 主要服务人的导航。                | 主要服务于车的导航，也可以提升人导航的体验。                 |

如下图，可以直观感受到普通地图和高精度地图的区别：

![img](https://pic3.zhimg.com/80/v2-6413969e10c48941c6b53b8b24e6dfd8_720w.jpg?source=1940ef5c)

Apollo高精地图数据元素参考：

![img](https://pic2.zhimg.com/80/v2-894216e526ebe66b5b881c4c4228570d_720w.jpg?source=1940ef5c)

## 高精地图与自动驾驶

在目前的主流解决方案中，L2+、L3、L4级别的自动驾驶普遍依赖高精地图。不同自动驾驶方案对高精地图的依赖程度有所不同，如下以Apollo的方案来说明一下自动驾驶在各个模块上对高精地图的依赖。



![img](https://pic1.zhimg.com/80/v2-ead2d9803acd66dc7937a48a214f8fcf_720w.jpg?source=1940ef5c)

### 高精地图与感知

高精地图可以提供超感知距离周边信息，拓展感知的边界。自动驾驶系统通过传感器获取周边信息，但是传感器都是有距离限制的。距离有限则控制时间有限，时间有限就可能导致决策错误或者控制不及时。比如摄像头可以看到100km时速下9秒内的路况信息（还得是直线），但是如果前方500米有个闸道出口，而且是只有某个车道可以通往这个闸道，那么车辆就应该提前进入这个车道。9秒的时间很可能不足以进行变道切换，就容易错过路口。而具备高精地图的超视距路况信息（后续闸道出口位置，弯道曲率，坡度等信息），自动驾驶熊就可以提前进行变道并做好速度准备，从而不容易错过路口。特斯拉没有采用高精地图，所以特斯拉在NOP启动时就很容易因为路况复杂无法及时切换到正确车道导致需要急刹车或者错过路口。



![img](https://pic3.zhimg.com/80/v2-a96436ec2b7497b31c6984115784b9db_720w.jpg?source=1940ef5c)



高精地图还可以提供感知冗余。传感器在很多情况下无法获取全面信息，如光照复杂无法区分是否红绿灯，视野被遮挡看不到车道线，雨天雷达噪点多等等。这些时候，高精地图都可以提供先验的参考，补充感知的能力。

另外，高精地图还可以提升感知的效率。自动驾驶系统通过图像数据来识别红绿灯，如果始终扫描全局图像进行图像分析，判断是否有红绿灯，计算和时间消耗都比较大。而如果有高精地图的先验数据，就可以根据定位信息，提前锁定某个区域，对特定区域（ROI）进行图像分析，来识别红绿灯及状态。这就可以有效减少计算量，加速识别。

### 高精地图与定位

卫星定位的精确度是比较低的，但是自动驾驶对于自车位置定位要求是厘米级。而基于高精地图的特征定位方式就可以达到厘米级的定位。我们通过一个场景演示来说明高精地图是如何辅助系统进行精准定位的。

1. 通过卫星定位获取自车的大概位置，比如在王府井十字路口。
2. 通过传感器扫描周边获取周边的点云信息，点云会包含周边物体的空间特征。
3. 将传感器扫描的信息与高精地图中王府井十字路口周边的点云信息（包含精确的位置信息）进行匹配，就可找到车辆在高精地图上的精确位置，从而也就获取到了自车的精确位置。



![img](https://pic1.zhimg.com/80/v2-5b23e59e67769086b1eb0cc5ef8b1274_720w.jpg?source=1940ef5c)

这是通过点云特征匹配实现高精定位的方法。还有一些其他方式也可以实现高精定位，比如通过图像识别到前方5米有一个路牌，高精地图知道路牌的位置，通过相对位置推算，就可以获取到主车的精确位置。扫地机器人也是采用类似的方式来定位自己在房间中的位置的，只是机器人的高精地图是通过自己SLAM算法扫描获取的。

### 高精地图与规划

高精地图在规划中的作用体现在长距离路线规划和短距离轨迹规划两方面。

普通地图也可以进行路线规划，但是只提供了路线，具体要在哪个车道开，什么时候该切换车道等信息是没有的。对于导人来说，这就够了，要导车，就不够了。高精地图则可以赋能系统实现车道级路线规划，是车辆真正可以实际行驶的路线。



![img](https://pic1.zhimg.com/80/v2-85c091615cbbc95f12f5e2b5f1332dca_720w.jpg?source=1940ef5c)

车辆在行驶的时候，还需要精细的轨迹规划。高精地图可以帮助系统预测周边障碍物的移动轨迹，如知道某辆车在某个左拐车道上，就可以预测它将要左拐的路线。根据高精地图的信息（车道、宽度、坡度、曲率等等），以及周边障碍物的信息，系统才能规划出一条精细的轨迹行驶，以匹配长路线上的计划路线。

![img](https://pic1.zhimg.com/80/v2-2ebb4b2b0ab009b4150e2ab31291b975_720w.jpg?source=1940ef5c)

### 高精地图与安全

高精地图可以为自动驾驶系统提供感知冗余，从而提升安全性。传感器可能遭遇各种攻击，如下图所示：假交通灯、假GPS信号、激光屏蔽Lidar等等。

![img](https://pic2.zhimg.com/80/v2-f9f29aa363cd3b75a5e2590c672cd26a_720w.jpg?source=1940ef5c)

高精地图可以提供准确度较高的先验数据，与传感器实时获取的数据可以进行对比验证，发现可疑问题，进一步做相应的安全应对。当传感器故障时，系统也可以依据高精地图提供的信息，行驶到相对安全区域停靠。

总结来说，高精地图可以说时自动驾驶之心，帮助自动驾驶系统在各种情况下都能获取到真实世界丰富的全局电子化信息，让自动驾驶“心”中有数。

## 高精地图规格

高精地图的规格标准，业界比较通用的有两种，一种是NDS（Navigation Data Standard导航数据标准），一种是OpenDrive。

### NDS

NDS是欧洲多跨国企业联合开发的统一地图存储标准。它的特点是，在兼顾性能和功能的基础上，采用了数据库技术存储地图数据，能够比较好地解决地图增量更新、扩展和数据安全的问题。下面简单介绍下NDS的一些核心特点：

- 产品数据库：NDS中格式文档本身，格式文档就有上百页，对于地图考虑得非常全面。在NDS地图中有POI数据，它指的是地图上的用户可能感兴趣的一个点，比如一个商铺，一个公园。 它提供了很多描述功能，包括表述语音、基本地图显示，功能非常全面，但是比较复杂。
- 支持局部更新：NDS支持局部更新，可以对某个特定范围区域（如国家、省、市）进行更新。而且数据库可以分为多个产品，每个产品独立维护更新，最典型的应用就是NDS数据里面可以既包含A公司的基本导航技术数据，又包含B公司的POI（兴趣点）数据，非常适合各优势领域的公司进行合作。
- Level划分：Level就是我们手机地图里可以看到的比例尺的概念。不同比例尺下，我们可以看到不同颗粒度的地图信息。
- 地图块：分块是地图领域的一个通用技术。因为地图范围非常大，把整个地图切分为众多小格子，便于地图数据的更新维护。

NDS规范比较重，国内厂商用得少一些，国外大厂比如宝马用得比较多。

### OpenDrive

OpenDriver相对轻一些，也是Apollo用的方案，后续更多的以OpenDrive来介绍高精地图的规格。OpenDrive标准的核心如下：

- 参考线：reference line是规格中一个重要概念。OpenDrive中道路分为三个部分：道路参考线（reference line）、车道（lanes）和道路设施（features）。地图绘制都是先画参考线，参考线包括xy位置坐标，路的形状等属性，其他道路元素都是基于参考线再画的。



![img](https://pic3.zhimg.com/80/v2-edce194bff8dee15c94b51ff41d7e406_720w.jpg?source=1940ef5c)

- ts坐标：Tracking坐标系，s坐标为道路方向，以米为单位向前延伸；t坐标为偏离参考线距离，向着s方向，左为正，右为负。ts坐标可以依据参数信息转化为地图采用的[WGS84椭球体坐标系](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzg4MzIwMDM5Ng%3D%3D%26mid%3D2247485432%26idx%3D2%26sn%3Dc95e3dfd22f78779860e2b034f8e0bd0%26chksm%3Dcf4a5f1bf83dd60da7bf9e0b0f752dbab1223f77abf392486886229da802cef73659a7bab0ea%26scene%3D178%26cur_album_id%3D1513281559280304130%23rd)。

![img](https://pic1.zhimg.com/80/v2-56959e082da85cc85ac5a1797446a39b_720w.jpg?source=1940ef5c)

![img](https://pica.zhimg.com/80/v2-b14133c752203af91962a65244888477_720w.jpg?source=1940ef5c)

- 节点组织：规范中主要包含三个大节点：Header、Road以及Junction。Header主要包括版本以及地理参考坐标系的参数信息。Road为道路及相关设施的信息。Junction为路口信息。如下左图为节点组织框架。右图为Apollo定制版本的组织框架。



![img](https://pic2.zhimg.com/80/v2-b82b69afaa3d5468f07ef89df09bfd71_720w.jpg?source=1940ef5c)

![img](https://pica.zhimg.com/80/v2-3fe2e6d51f353227a30e03ff94aa5a86_720w.jpg?source=1940ef5c)

其中核心的两个节点是Road和Junction，如下图所示。

![img](https://pic2.zhimg.com/80/v2-c3927d5f1a7d705f6d50bcfe029632d2_720w.jpg?source=1940ef5c)

- - 左边road 10，reference line黑色箭头所在位置，左边有lane 1 ,2,右边为lane -1,-2,-3

  - 上边road 60，reference line黑色箭头所在位置，左边有lane 1 ,2,右边为lane -1,-2

  - 右边road 50，reference line黑色箭头所在位置，左边有lane 1 ,2,右边为lane -1,-2，-3

  - 下边road 70，reference line黑色箭头所在位置，左边有lane 1 ,2,右边为lane -1,-2

  - 中间是一个Junction，包含road 40, road 20,road 30，都是connectingRoad，对应的连接关系为：

  - - road 10 -1 lane (incoming road)<—>road40(connectingRoad) -1 lane
    - road 10 -2 lane (incoming road)<—>road30(connectingRoad) 1 lane
    - road 10 -1 lane (incoming road)<—>road20(connectingRoad) -1 lane
    - road 10 -2 lane (incoming road)<—>road20(connectingRoad) -2 lane

- section：当道路数量有变化时，OpenDrive会对Road进行分段，每一段是一个lanesection（车道组）。如下一条road，先是上面车道减少，后是下面车道减少，所以被分割为三个section。每个lane section必须包含一个center以及right和left之中至少一个。每个lane就是一条车道线，center只包含线，left和right还会包含宽度等车道属性。

![img](https://pic2.zhimg.com/80/v2-e9caec2e06dd28088c51ace9ab2d94e6_720w.jpg?source=1940ef5c)

- xodr格式：OpenDrive数据存储于XML文件中，文件拓展名为.xodr。OpenDrive压缩文件的拓展名为".xodrz"（压缩格式gzip）。文件示例如下：

![img](https://pica.zhimg.com/80/v2-5792d5e8cbc47c7c28b45ca6a84a223d_720w.jpg?source=1940ef5c)

更多关于OpenDrive的详细规格介绍，可以到[ASAM OpenDRIVE](https://link.zhihu.com/?target=https%3A//www.asam.net/standards/detail/opendrive/)上下载文档查看详细说明。

## 高精地图制作

高精地图制作可以分为两种，一种是专业集中制图，另一种是众包制图。专业集中制图就是目前高德、四维这些图商的制图方式。专业的人员，采用专业的方法，使用高精度设备，自主进行数据采集而后加工建图。采集成本较高，包括设备成本（一辆采集车就几百万）和人力时间成本。采集精度较高（如绝对精度小于1米，相对精度小于20厘米）。众包制图是将地图数据的采集分配给普通人及设备分别进行，然后收集合并数据的方式来构建地图。众包的方式具备快速制图，成本低廉等显著优势，但精度相对较低。采用这种方式的方案商有Tesla、Mobileye和Momenta。其他主流方案上都依赖专业制作的高精地图数据。未来最可能普遍采用的方案是专业集中制图+众包更新，可以同时满足精度和鲜度的要求。

这里重点介绍专业集中制图，参考Apollo的方案，高精地图制作可以分为四个阶段：数据采集，数据处理，元素识别，人工验证。

![img](https://pic2.zhimg.com/80/v2-af5f226f7caea929d2e72c8596fea401_720w.jpg?source=1940ef5c)

### 数据采集

数据采集主要看硬件方案，采集硬件决定了采集的数据信息。Apollo地图采集的硬件方案主要包含如下五个传感器：

- - 64线激光雷达：平装，用于偏低位置空间信息采集，生成点云地图
  - 16线激光雷达：仰装，用于偏高位置空间信息采集，生成点云地图
  - GPS & IMU：采用GNSS + IMU + RTK的高精定位方案(定位模块有介绍)，用于采集位置信息
  - 长焦相机：偏远距离视觉图像获取
  - 短焦相机：偏近距离视觉图像获取

![img](https://pic1.zhimg.com/80/v2-3054a7e43c07b8cc4f457fe90609f784_720w.jpg?source=1940ef5c)

方案中成本最高的就是这个激光雷达了，一般也需要跑3-5遍才能有较好的点云采集效果。16线比64线的成本要低很多，如果主要采用16线雷达，则需要比64线多跑几圈。采集过程中车速不能超过60km/h。高精地图采集的数据量非常大（一天几十T），所以方案中使用了超高速10G/s，超大存储空间的NVME SSD Hard Disk。方案中还部署了一套传感器的监控系统，确认采集过程中传感器的状态。状态包括连接，[多传感器标定](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/liuzubing/p/11056936.html)（可参考感知模块的介绍）等。多传感器标定是指对于拥有不同特性和不同观测范围的传感器，去准确地找到它们之间的相对位置关系，方便后续数据处理融合。

### 数据处理

数据主要分为点云和图像两类，因为高精度要求，所以制图以点云为主。要想创建一个点云地图，需要两个重要的信息一个是定位信息，另一个是点云信息。通过GNSS、IMU及轮速计可以高频率地获取当前采集车的定位，但各个传感器都存在一定程度的精度问题。需要将各传感器数据进行融合，再运用Slam算法，对位置进行矫正，最终才能得出一个相对精确的位置。点云信息，来自激光LiDAR，是对环境扫描的点云信息，包括XYZIT（X,Y,Z坐标,光强度,时间戳）等信息。最后把点云信息通过时间关联匹配融合到定位信息中，从而构建了点云地图。拼接的过程有点像是我们用全景模式拍照，将多个角度上的图像进行对齐，最终拼接成为一个全景照片。下图展示通过拼接获取一个完整的点云地图。

![img](https://pic3.zhimg.com/80/v2-cf84dda55aac770816c57f1770df8caa_720w.jpg?source=1940ef5c)

### 元素识别

基于反射地图深度学习可以提取车道线、灯杆、红绿灯等信息，获取到这些道路设施的形状特征。下图演示通过点云特征提取到的一些特征和道路设施。

![img](https://pic1.zhimg.com/80/v2-4f5fd496af1dff8f7fb728ea90f7c6db_720w.jpg?source=1940ef5c)

虽然激光雷达采集的信息非常精确，但它采集的信息非常少，无法提供像图像那样丰富的语义信息、颜色信息（如：道路虚实线、黄白线、路口标识等信息）。因此，目前主流自动驾驶研发公司采用的是Camera融合激光雷达的方案。通过融合二者的优势，综合运用丰富的图像信息和精确的激光雷达数据，最终得出一个非常精确的高精地图。

![img](https://pica.zhimg.com/80/v2-4249a1c33932c0da29db5cd8d2018f37_720w.jpg?source=1940ef5c)

### 人工验证

自动化和算法无法解决所有问题，比如有些道路就是没有画车道线，算法无法理解车道和红绿灯的对应关系。这就需要人工进行校验和补充。

### 结果地图

通过如上一系列步骤后，高精地图就制作生成了：定位地图（辅助进行高精定位），高精地图。基于高精地图可以进一步建立路径规划地图和仿真地图。

![img](https://pic2.zhimg.com/80/v2-7dbf184a9b6760556901aa3fad638431_720w.jpg?source=1940ef5c)

## 高精地图展示

系统也可以将清晰的立体的高精地图实时展示给司机和乘客，提升驾驶体验和安全感。

![img](https://pic3.zhimg.com/80/v2-c1086bbe8d352d7edbc32000245a9a4a_720w.jpg?source=1940ef5c)

![img](https://pic3.zhimg.com/80/v2-7f98bab05d2316070e12ea271a1be6c5_720w.jpg?source=1940ef5c)

## 结语

本文介绍了高精地图与普通地图的差异，主要是在精确度和丰富度上有更高要求；介绍了高精地图在自动驾驶系统中发挥的作用，包括超视距感知、支持高精定位、支持路线和轨迹规划以及提供安全冗余；之后介绍了NDS以及OpenDrive两种常用的高精地图规格，最后介绍了高精地图的专业采集过程。无论是通过众包采集还是集中制图，高精地图会是自动驾驶系统中不可或缺的一环。除了上述的作用外，还有一点很重要，系统或者应用涉及空间位置的信息交互及处理，需要有一个统一的空间模型，而高精地图就是那个最合适的模型。