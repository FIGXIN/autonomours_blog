- [V2X应用开发流程介绍 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/262058154)

Apollo 6.0更新了v2x模块的部分内容，下面我们对v2x的应用场景和开发流程进行一些简单的介绍。

## V2X业务场景

首先我们通过一张图来了解下v2x的工作流程。

![img](https://pic1.zhimg.com/80/v2-e885f15c42d41233ab0833532ebed948_720w.jpg)

V2X设备包括2大部件：**车载端的OBU，以及路侧的RSU。**二者通过无线电进行直连通信，OBU安装在车载端，RSU安装在路侧。RSU可以简单理解为一个大型的WIFI，通过OBU连接RSU，然后进行通信。

那么Apollo无人车和RSU之间如何进行通信呢？

Apollo系统和OBU都安装在车载端，当Apollo系统要发送消息给RSU时，会先发送消息到OBU，OBU再转发消息到RSU路侧单元，它们之间的通信都是双向的。

## V2X标准

有了可以通信的硬件设备，那么如何构建跑在它们之上的应用程序呢？采用什么样的通信协议呢？

我们当然可以定义一些私有协议，然后在它之上去构建一些应用程序，但如果每个厂商都采用自己的私有协议，那么必然导致不同厂家之间功能不兼容。鉴于此，2017年9月中旬，中国智能网联汽车产业创新联盟正式发布《合作式智能交通系统 车用通信系统应用层及应用数据交互标准》，[下载链接](https://link.zhihu.com/?target=http%3A//www.sae-china.org/download/1745/%E5%90%88%E4%BD%9C%E5%BC%8F%E6%99%BA%E8%83%BD%E8%BF%90%E8%BE%93%E7%B3%BB%E7%BB%9F%2B%E8%BD%A6%E7%94%A8%E9%80%9A%E4%BF%A1%E7%B3%BB%E7%BB%9F%E5%BA%94%E7%94%A8%E5%B1%82%E5%8F%8A%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E6%A0%87%E5%87%86.pdf)。

该标准是一个应用层的标准，它规定了V2X消息的格式，保证了消息的统一性，同时还定义了基于安全、效率以及信息服务等17类应用场景。

### **5大消息类型**

上述标准中定义了5大消息类型:

1. **BSM** - basic safety message
2. **MAP** - map data
3. **RSM** - road side safety message
4. **SPAT** - signal phase and timing message
5. **RSI** - road side information

V2X标准通过定义这5大类消息，来满足不同应用场景的需求。

- BSM是车辆的基本安全消息。是使用最广泛的一个应用层消息，用来在车辆之间交换安全状态数据。车辆通过该消息的广播，将自身的实时状态告知周围车辆，以此支持一系列协同安全等应用。
- MAP是地图消息。由路侧单元广播，向车辆传递局部区域的地图信息。包括局部区域的路口信息、路段信息、车道信息、道路之间的连接关系等。
- RSM是路侧安全消息。路侧单元通过路侧本身拥有的相应检测手段，得到周围交通参与者的实时状态信息（路侧单元本身、周围车辆、非机动车、行人等）广播给周边车辆。
- SPAT信号灯消息。包含一个或多个路口信息灯的当前状态信息。结合MAP消息，为车辆提供实时的前方信号灯相位信息。
- RSI由路侧单元向周围车载单元发布的交通事件消息以及交通标志牌信息。

Apollo中的v2x消息协议定义在"**modules/v2x/proto**"中，实现了RSI，SPAT，MAP 3种消息格式， RSM和BSM消息格式没有定义。

### 17类应用场景

标准中还定义了17类应用场景，包括安全、效率和信息服务3大类，下面是具体的应用场景。

![img](https://pic2.zhimg.com/80/v2-f58bc72c147629dc7d162993b9f6b8e1_720w.jpg)V2X 3大类应用场景



最后我们通过分析上述的一个应用场景来了解V2X的开发流程。

## 应用场景分析

我们这里以**前向碰撞预警**为例来说明。

首先规范中对前向碰撞预警和预期的效果进行了定义。前向碰撞预警是指，主车在车道上行驶，与在正前方同一车道的远车存在追尾碰撞危险时，前向碰撞应用将对主车驾驶员进行预警。

接着标准中对主要场景进行了描述。标准中一共定义了4种应用场景，这里我们只节选其中一个。

![img](https://pic1.zhimg.com/80/v2-724ea1bac5307d093e01ed8f97242d48_720w.jpg)

## 通信方式

HV和RV需具备短程无线通信能力，车辆信息通过短程无线通信在HV和RV之间传递(V2X)。

同时还定义了基本性能要求

- 主车车速范围0-130km/h；
- 通信距离≥300m；
- 数据更新频率≤10Hz；
- 系统延迟≤100ms;
- 定位精度≤1.5m。

通过上述规范中的定义，我们了解了应用的需求以及要达到的目的，同时还需要达到性能要求。上述应用可以通过远车实时上报自己的位置和速度信息到RSU，并且由RSU广播给周围车辆，并且判断是否具有碰撞的可能，从而提醒司机。

车辆的信息上报可以采用BSM消息，同时借助车辆和OBU之间进行通信，就可以实现上述的17类应用场景。

## 总结

V2X提供了车辆和路侧设备进行的通信能力，同时还规范了互相之间传递消息的格式。在进行V2X开发之前一定要先实现V2X的5大消息内容，然后再参考规范中定义的17个具体应用场景，选择不同的消息，来满足不同场景的需求。

可以看到规范中V2X既可以给智能网联车辆，也可以给自动驾驶车辆，甚至在将来可能有一段时间出现混合交通流的情况。