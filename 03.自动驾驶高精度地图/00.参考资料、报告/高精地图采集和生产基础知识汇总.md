- [高精地图采集和生产基础知识汇总|点云_网易订阅 (163.com)](https://www.163.com/dy/article/G0N9EILL0538NEII.html)

高精地图是L3级以上自动驾驶的必备组件，对于自动驾驶汽车而言，高精度地图具备以下三大功能：**路径规划、地图匹配、辅助环境感知**。它可以将车辆位置精准地定位于车道之上、帮助车辆获取准确有效的当前位置及环境信息，并为车辆规划制定最优路线。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F6ad39a69j00qn64dn000rc000hs008tm.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

不同于传统导航地图，高精度地图的适用对象是汽车，为了保证自动驾驶汽车的安全性，地图数据需要保持“高精度、 高动态、多维度”等特点。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F68695ba6j00qn64dn000ec000hs006wm.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

高精度地图与普通导航地图的对比

那么一张高精度地图到底是由哪些元素构成的呢？

一般而言，电子地图是通过不同的图层去描述，然后将图层叠加来进行表达。在一张电子地图里，水系、铁路、街区、建筑物可能会分别位于不同图层，每一个图层可以理解为一张透明薄膜 ,多图层被绘制叠加后才能真正为我们所用。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F4bf20795j00qn64dn001ac000hs00eem.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

易图通副总裁羊铖在接受采访时曾表示：高精度地图也一样，同样是分层绘制而成。它能更加真实地反映道路实际样式，因此包含更多的图层数量和道路数据细节。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F251a2ba3j00qn64dn000kc000hs00dem.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

高精度地图应用分析

高精度地图可分为车道级路网、定位、动态地图三个图层。车道级路网以及所包含的元素列表大家做得都比较类似。**而目前业界分歧最大其实是定位层以及动态地图层**。

事实上，国外部分主流图商也会将高精地图分为:Road Model, Localization Model 和 Lane Model 这三层。虽然叫法不一，但大体上都是认为：Road Model用于导航规划；Localization Model用于在地图中定位车辆；Lane Model用于感知和考虑当前道路和交通状况的路线规划。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F05ba9d71j00qn64dn0009c000hs002tm.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

车道级路网图层

车道级路网图层（Road Model）， 需要为自动驾驶汽车提供准确的道路信息，因此要对路网精确的三维表征（厘米级精度）进行描述，比如路面的几何结构、道路标示线的颜色与形状、每个车道的（坡度、曲率、航向、高程等）数据属性，甚至还要将道路隔离带（及材质）等信息及其所在位置进行详尽描述。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F129d17a3j00qn64dn000oc000go008bm.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

车道路网信息

此外，在采集道路周边环境时，所生成的点云数据中包含了极为丰富的地理空间信息，如道路标识牌、路灯、安全岛、绿化带、里程桩、杆状物路灯、摄像头、交通护栏等特征点线，以及相关属性信息（等级、材质、类型、宽度等）。在制作高精度地图时，这些要素信息通过点云的提取，既方便又能达到较高的空间几何精度。

车道级路网数据，根据采集的特征点线，以及相应的属性信息，在 ArcGIS 软件中，经过符号化处理、图面整饰、晕渲后即可形成色彩协调、图面美观的显示地图。

**定位层**

定位层（Localisation Model）主要用于辅助自动驾驶车辆定位。

关于定位层，高精地图包含的元素取决于无人驾驶车辆本身采用了什么样的传感器。其次，定位层还与应用场景紧密相关，比如在无人矿区或地下停车场所自动驾驶时所需要的高精地图信息要素也不一样。

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2Fa5b7eb4dj00qn64dn000sc000gy009om.jpg&thumbnail=660x2147483647&quality=80&type=jpg)

目前自动驾驶汽车在“定位”方面的解决方案差异性较大，有太多不同的传感器包括摄像头、激光雷达组合方案，目前定位技术主要集中在Feature Based和Dense Information Based这两种方法上，高精度地图制图也主要围绕这两种方式。

因此在未来，图商有可能会根据不同的场景、不同的传感器生成不同的高精地图。

**动态层**

动态层（Lane Model），主要用于自动驾驶汽车感知和考虑当前道路和交通状况的路线规划，但只有当车辆在地图中准确定位时，动态地图层（Lane Model）才能辅助车辆进行环境感知。

目前也有些图商基于项目的研发，主张动态层信息要素需要具备如下要求：

Highly accurate geometry model；

Lane attributes ；

Traffic Regulations，Road Furniture And Parking；

Lane connectivity；

![img](http://dingyue.ws.126.net/2021/0119/9c40fe40g00qn64dn008cc000hj008hm.gif)

通信息示例图

实际上，现阶段大家对于高精度地图动态层需要哪些信息要素也还没有定论，仍处于探讨研究的阶段。

因此对于“高精度地图到底需要采集哪些要素”这个问题的答案其实是开放性的。

**高精地图和自动驾驶**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F1f4500cfj00qn64dn000qc000u000a8m.jpg&thumbnail=660x2147483647&quality=80&type=jpg)



L3以下可以不用高精度地图，L3+必须要用到高精度地图。
高精地图不一定比传统地图精度更高，但包含信息更全面，或者实时性更强。
高精地图的特征

- 实时性
- 描述车道或者车道边界线等，包含了人能看到的能影响驾驶的全部信息。

高精地图与传统导航地图的区别示意

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2Ffdadb84ep00qn64dn0080c000u000dbm.png&thumbnail=660x2147483647&quality=80&type=jpg)

**高精地图与其他模块的关系**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2Fd5470586p00qn64dn009rc000u000dem.png&thumbnail=660x2147483647&quality=80&type=jpg)


**定位**
目前两种主流定位方法：点云定位、视觉定位。
比如，结合粒子滤波以及高精地图计算概率确认所在位置

**感知**
超距感知与隔障碍物感知、红绿灯感知
弥补感知传感器的局限性：距离的局限性（如激光雷达在一定距离之外点云稀疏，摄像头在恶劣环境下的情况）；雷达穿透能力强，精度不高；激光雷达穿透能力弱，遇到雾霾等天气会有较大误差；遮挡情况
高精度地图的先验提高识别率，缩小检测范围。

**规划预测决策**
长距离规划（路由选择）：类似于导航，主要针对于静态环境，但会考虑车道级别的规划。
短距离规划（轨迹选择）：通过高精度地图决定短距离规划的目的地（车道）
预测：底层依赖于高精度地图，根据障碍物所在车道位置或者红绿灯等信息预测障碍物可能的运行轨迹。

**安全**
无人车的操作系统、控制系统、通信系统可能会被攻击、被干扰或者发生故障。
高精度地图提供了一个离线的标准，与实时探测到的进行匹配。

**仿真系统**
基于高精地图构建仿真系统，保证测试时候的场景和实际道路运行的差别不会很大。

**高精度地图作用**



- 静态感知，把人的经验传递给自动驾驶系统
- 弥补系统性缺陷，目前4G网络无法实现实时传输数据，云端计算



**高精度地图的采集与生产**

**采集用的一些传感器**



- GPS：通过观测卫星（四颗及以上）得到地球上的点位置
- IMU
- 轮速计：通过分析每个时间段里左右轮的总转数，可以得出车走了多远，但路面情况会影响结果
- 激光雷达



**生产——计算模型**

**空间结构的三维重建**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F982c08acp00qn64dn008oc000u000b6m.png&thumbnail=660x2147483647&quality=80&type=jpg)


**高度简化的计算模型**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F31c579a5p00qn64dn00c7c000u000d8m.png&thumbnail=660x2147483647&quality=80&type=jpg)


**生产——视觉制图**
采用纯视觉的制图模式。



1. 

   \1. 基于激光雷达：摄像头与激光雷达融合使用，激光雷达准确但信息少，摄像头信息更多

   

2. 

   \2. 基于视觉：硬件较强的可以实时监测实时生成

   



**高精度地图的格式规范**



- NDS
- OpenDRIVE

1. 

   \1. NDS支持局部更新，提供一些描述功能，较为复杂，但信息很全面。

   

2. 

   \2. 地图分块封装地图数据。

   

3. 

   \3. OpenDRIVE中，道路被切分成多个section，车道线变化、虚实线变化、道路属性变化都是其划分原则。规定了参考车道，基于参考车道向左向右的车道ID分别递加递减。规定了路口概念，包含红色线（虚拟路），用于连接可通行方向。

   

4. 

   \4. tracking坐标系：S相对于参考车道的起点的纵向偏移量；T基于参考车道的横向偏移量。所有车道线的描述都基于这个参考车道偏移描述。

   



**业界的高精地图产品**



1. 

   \1. HERE：基于云端的服务，精度高，更新快。

   

2. 

   \2. HERE采集地图的流程：建立一个Base Map（利用激光雷达结合图像）；众包更新；众包采集之后与Base Map匹配；云端Map Learing；云端将更新之后的地图传播到车端。

   

3. 

   \3. 数据采集不能通过网络传输，高精的技术数据不允许在网络上传输。

   

4. 

   \4. 点云分割，点云特征提取，点云的SLAM尚待完善。

   

5. 

   \5. HERE地图的表述：

   



道路车道层 Road&Lane Model Layer：最底层，道路车道边界的虚线（没有车道线的情况下也会提供虚拟车道线）实线，道路限速，道路标牌等

定位层 Localization Model Layer：基于点云的和基于图像的定位方法都需要提取特征，该层用于表述用于定位的信息

动态信息层 Activity Layer：描述路上一些动态事件，对实时性要求较高

驾驶习惯层 Analytics Layer：收集驾驶员的驾驶习惯信息，使自动驾驶汽车开的更像人。把人的经验抽象为数据，把这种数据转化为自动驾驶汽车的驾驶准则



1. 

   \1. MobileEye（下简称ME）技术体系分为三个层次：感知、制图、驾驶策略习惯

   

2. 

   \2. ME在感知层面更多基于视觉图像层面。

   

3. 

   \3. ME使用用REM的众包视觉制图；利用强化学习训练驾驶策略。

   

4. 

   \4. ME的制图：提出道路经验管理，即一个众包系统，在终端上实时收集数据上传云端，更新后下发车端。

   

5. 

   \5. 基于视觉方案的问题：对车道线的检测没有那么连续。

   

6. 

   \6. Road Book 车端首先进行语义分析和几何形状提取，把信息压缩打包传输云端，减少传输带宽。

   

7. 

   \7. Google Waymo

   

8. 

   \8. GW更类似于一种栅格形式的高精地图，区别于传统的矢量数据地图。

   

9. 

   \9. GW也是基于激光雷达加视觉融合的，但重新设计的激光雷达的感知距离很远

   

10. 

    \10. TomTom能做到在云端的实时更新

    

11. 

    \11. Road DNA定位方案：把三维的点云通过一定技术构建一个可对比可识别的feature

    



**Apollo地图采集方案**

**硬件方案**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F0e56d9d3p00qn64dn00bhc000u000f3m.png&thumbnail=660x2147483647&quality=80&type=jpg)



1. 

   \1. 64线激光雷达采集道路路面，16线激光雷达斜向上装检测高处红绿灯、标牌信息。

   

2. 

   \2. GPS采用RTK

   

3. 

   \3. 长短焦相机

   

4. 

   \4. 有监控传感器状态的部分，确保各个传感器在工作时情况良好

   

5. 

   \5. 有一键式采集方案，在一键采集之前要确认传感器是正常工作的，传感器是已经被标定过的（不同厂家对同一个地面的反射值不同）。

   

6. 

   \6. 在采集过程中，双向车道要采集3~5遍

   

7. 

   \7. 一次采集行为会把所有结果（点云、车辆的标定参数、定位结果、pose结果等）都放进一个包

   

8. 

   \8. 采集结束之后把数据传输给平台制图

   



**Apollo地图生产技术**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F15c34928p00qn64dn00gxc000u000gkm.png&thumbnail=660x2147483647&quality=80&type=jpg)



1. 

   \1. 数据处理：数据分为点云和图像两类，因为高精度要求，所以制图以点云为主。
   （1）点云拼接：采集过程中信号可能不稳定（RTK在遮挡情况下会出现不稳定现象），通过SLAM等对pose做优化，优化之后对点云信息做拼接得到完整的点云信息。点云信息被压扁得到定位地图图像、反射地图图像。反射地图可以做一些标注。
   （2）点云图像处理后得到一个高精度图像，基于图像可以做精确的车道线识别，获得车道线的形状特征。但仍需要道路虚实线、黄白线、路口标识等信息，这时候需要元素识别。

   

2. 

   \2. 元素识别
   （1）车的自动化程度不够 ，无法解决道路上没有车道线的部分以及无法理解逻辑信息（比如停止线和红绿灯的关联关系）

   

3. 

   \3. 人工验证：车道线识别是否正确，补充关联处理。比如路口虚拟线的处理，这种虚拟线的处理依赖于半自动化的处理。

   

4. 

   \4. 基于深度学习的地图要素识别有两个层面：
   （1）是否能基于点云分割，从点云里提取特征。
   （2）尝试从点云中提取车道线、灯杆、红绿灯等。

   

5. 

   \5. 定位地图类似于整齐排列的小格子，存储了坐标信息和反射强度信息等，用于点云定位。

   

6. 

   \6. 高精地图

   

7. 

   \7. 路径规划地图主要用于车道级别规划的

   

8. 

   \8. 仿真地图用于基于高精地图的仿真

   



**Apollo高精地图**

**高精地图的数据元素**

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F5f8d9fd9p00qn64dn008zc000u000cum.png&thumbnail=660x2147483647&quality=80&type=jpg)



1. 

   \1. 道路本身分为道路级别（道路边界，是强约束）和车道级别（左右边界）；

   

2. 

   \2. 路口边界对感知做过滤。

   



![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F17acaa23p00qn64dn00d1c000u000eqm.png&thumbnail=660x2147483647&quality=80&type=jpg)

1.left sample中心线到两个（车道）边界的距离；left/right road sample车道中心线到道路物理边界的距离
2.在车道变化的地方也做一个junction，可以给感知做一个约束
\3. 高精地图用UTM坐标系、WGS84、Tracking（ST）
\4. WGS84本身是一套全球经纬度。把整个地球想象成一个椭球，地面的高度是相对于椭球面的偏移，高低对应正负。
\5. Apollo OpenDrive规范（与标准OpenDrive的差异）：

![img](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0119%2F6367f133p00qn64dn003ic000l100avm.png&thumbnail=660x2147483647&quality=80&type=jpg)

元素做了归类，road、junction、地面所有的标识都是object、标牌都是signal，用overlap关联。
（1）标准是通过参考车道偏移量计算，Apollo是采用绝对坐标点序列描述边界形状，不采用方程的方式。好处是对下游的计算友好，不用再做点的采样。
（2）标准基于偏移量的计算在道路急转弯情况会出现道路上的毛刺，可能导致无人车猛打方向盘造成危险。
（3）扩展了禁停区、人行横道、减速带等元素。
（4）新增了junction和junction之间的关联关系。（5）增加了车道中心线到真实道路边界的距离、停止线和红绿灯的关系。
\6. overlap：用来描述两个元素的空间关系。两个车道在空间上有重叠，则这两个车道有overlap。能进入到路边停车位的车道与停车位之间也存在overlap。下游的控制决策模块拿到地图之后，知道哪个车道进入停车位。
\7. HDMAP引擎：从HDMAP中提取相关元素给下游用。通过ID检索或者空间位置（点或半径）检索。
\8. 高精地图属于国家机密，不可以任何人都来做测绘。
\9. 国内地图的数据加偏，对发布的地图数据都做加密；高程、曲率、坡度不允许在地图里表述。