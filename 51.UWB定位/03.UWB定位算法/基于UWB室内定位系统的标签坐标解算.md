- [基于UWB室内定位系统的标签坐标解算 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/362217424)

随着**智能手机和可穿戴设备等**智能终端的普及，产生了庞大的室内外定位需求，并逐渐成为新的经济增长点与战略性新兴产业。由于**5G**技术的问世，这种高带宽、超低时延的通信技术，更助力了室内外定位服务市场的快速增长。对于室外定位，常常采用基于GPS或北斗系统的解决方案。室内定位，则有基于蓝牙、wifi、地磁、超宽带的定位技术。据有关数据，到2022年，全球的室内定位市场规模将达到409.9亿美元。**超宽带**（Ultra-Wide Band,简称**UWB**）技术因其具备功耗低、频带宽、抗干扰能力强、距离分辨率高（视距条件下，测距误差在10厘米以内）的优点，逐渐成为了高精度室内定位技术的首选。目前，该技术主要有以下应用场景：工业、仓储、机器人定位与导航；新冠社交距离管控；大型商场的店铺、停车位定位与导航。除了商用外，对于消费者，该技术的应用也逐渐在扩展，如苹果与小米公司都在各自的新款手机中加入了UWB定位技术，一些著名车企也在新款车中加入了该技术。UWB定位技术通过测量**标签**与若干**基站**间的距离，计算标签在二维或三维场景中的坐标，从而实现对**标签**的定位。按照基站是否发射超宽带电磁波，可划分为**主动式UWB定位系统**与**被动式UWB定位系统**。标签与基站间的距离被确定后，基站把距离信息上传至服务器（上位机），服务器采取某种算法完成对标签坐标的解算。接下来，将介绍UWB定位系统坐标解算的基本原理，并给出相关算例。

## **坐标解算基本原理**

利用超宽带（Ultra-Wide Band，简称UWB）通信技术可以在室内精确测量出基站与标签的距离，视距情况下，测距精度在0.1 m以内。非视距情况下，由于障碍物的影响，会使电磁波传播距离大于真实距离，此时测距误差会变大，而且是正向的，即测量值一定大于真实值，绝对误差水平在0.3 m左右。考虑这样一种二维定位场景，假设有![[公式]](https://www.zhihu.com/equation?tex=N)个台站配置在应用场景中，每个台站的坐标是已知的，且认为是没有误差的。基站在收到进入场景中的标签发射的信号后，就会对其测距，每个基站都会测量一个距离。此时，我们可以列出以下方程：

![img](https://pic3.zhimg.com/80/v2-41190f3c640afa7a4b71e5e15327437e_720w.jpg)

其中，![[公式]](https://www.zhihu.com/equation?tex=r_%7Bi%7D%E2%80%99)是第![[公式]](https://www.zhihu.com/equation?tex=i)个基站给出的距离测量值，（![[公式]](https://www.zhihu.com/equation?tex=x)，![[公式]](https://www.zhihu.com/equation?tex=y)）是待求的标签坐标，（![[公式]](https://www.zhihu.com/equation?tex=x_i), ![[公式]](https://www.zhihu.com/equation?tex=y_i)）是第![[公式]](https://www.zhihu.com/equation?tex=i)个基站的坐标。对于上式，我们令第![[公式]](https://www.zhihu.com/equation?tex=i)式与第![[公式]](https://www.zhihu.com/equation?tex=i%2B+1)式相减，即可消去二次项。得到如下线性方程组：

![img](https://pic4.zhimg.com/80/v2-bfcc596cbef6b0b7eff3e52589c48b53_720w.jpg)

进一步地，将以上线性方程组写成矩阵形式：

![img](https://pic1.zhimg.com/80/v2-23ce5ef39bc49f3515093c042d8b0f4c_720w.jpg)

因为右端向量**b**中存在测量误差。且大多数情况下，式（3）是一超定的线性方程组，需要使用最小二乘法求解。**m**的表达式为：

![img](https://pic3.zhimg.com/80/v2-25c4591db1acc8f5a16f6023e782eabe_720w.jpg)

由公式（4），我们可以得到最小残差平方和意义下的标签坐标。无论采取何种方法求解，本质上是希望残差平方和越小越好，这个残差平方和就是最优化求解过程中的目标函数。其表达式为：

![img](https://pic4.zhimg.com/80/v2-3e8867e27ad776cdd4c86710fee01477_720w.jpg)

可以在得到最小二乘解后，以最小二乘解为初始值，再采取模式搜索方法进一步更新标签的坐标，以令目标函数值再下降一些。

## **模型测试**

首先考虑3基站组网情况，基站的坐标分别为（0 m, 0 m）、（6 m, 0 m）、（0 m，10 m），测距误差保持在0.1 m以内，即误差在[-0.1 m 0.1 m]之间，且满足均匀分布。在由（0 m, 0 m）和（6 m, 10 m）这两个顶点确定的矩形中，以0.05 m间隔生成24321个标签坐标。然后采用以上算法解算标签坐标。最小二乘方法给出的坐标解算距离误差二维分布图，如图1所示，图中的黄色三角代表基站。图2给出了最小二乘方法的坐标解算距离误差频率分布直方图，该方法得到的距离误差的均值是0.0924，标准差是0.0545。图3给出了以最小二乘解为初始值，采取模式搜索方法再优化的坐标解算距离误差二维分布图。模式搜索方法得到的坐标解算距离误差频率分布直方图如图4所示。解算结果的均值是0.0711，标准差是0.0370。和最小二乘的方法相比，模式搜索法结果的均值和方差更小，结果更稳定。为定量评估这两种方法的性能，根据坐标解算结果，我们统计距离误差小于0.15 m的标签的数量，然后除以标签总数量，我们就知道了坐标估计误差小于0.15 m的频率，当标签总数量非常庞大时，频率也就变成了概率。经计算得最小二乘法估计的标签坐标距离误差落在0.15 m内的频率是86.34%，模式搜索法估计的结果的距离误差落在0.15 m内的频率是96.97%。需要注意的是模式搜索法估计结果误差的上界大于最小二乘方法的结果，这点可以从图2和图4看出，但是模式搜索法给出不良结果的概率是很低的。综上，在3基站组网时，虽然模式搜索给出的一些标签坐标的估计结果与真实坐标距离较大，但总体上均值和方差是很小的。不良结果出现的概率是极低的。

![img](https://pic3.zhimg.com/80/v2-51a3aca8dd5bec6a690fc28cbca7d292_720w.jpg)图 1 三基站组网情况下最小二乘坐标解算距离误差二维分布图

![img](https://pic2.zhimg.com/80/v2-5474d67a4feecf7358de148e001a16bd_720w.jpg)图 2 三基站组网情况下最小二乘坐标解算距离误差频率分布直方图

![img](https://pic4.zhimg.com/80/v2-1003ffd67bea28deb98c15a40e952aef_720w.jpg)图 3 三基站组网情况下模式搜索坐标解算距离误差二维分布图

![img](https://pic3.zhimg.com/80/v2-64431d556e0e0a55b96f089c5efadc72_720w.jpg)图 4 三基站组网情况下模式搜索坐标解算距离误差频率分布直方图

接下来，我们考虑4基站组网，第4个基站的坐标是（5 m, 8 m）。其他参数保持与三基站模型相同。由最小二乘方法得到坐标解算距离误差二维分布图如图5所示，频率分布直方图如图6所示。图7、8给出了模式搜索法的坐标解算距离误差的评估结果。经计算得，最小二乘法给出的估计结果的距离误差小于0.15 m的概率是96.06%；模式搜索法给出的估计结果的距离误差小于0.15 m的概率是99.95%。分析四基站组网的坐标解算结果，我们可以得到如下认识，在数据域增加约束，能够使坐标解算误差进一步地降低。而且模式搜索算法的性能总是优于最小二乘法。

![img](https://pic1.zhimg.com/80/v2-4fcce94508363cf2e446487d6636a668_720w.jpg)图 5 四基站组网情况下最小二乘坐标解算距离误差二维分布图

![img](https://pic4.zhimg.com/80/v2-73f06ddfc09fd80f9b1e1cf3ede6c0ab_720w.jpg)图 6 四基站组网情况下最小二乘坐标解算距离误差频率分布直方图

![img](https://pic4.zhimg.com/80/v2-eb1b0cccbb3fb53eebb4c0d49025162b_720w.jpg)图 7 四基站组网情况下模式搜索坐标解算距离误差二维分布图

![img](https://pic2.zhimg.com/80/v2-ba07ea02258562fc016621c6203e3321_720w.jpg)图 8 四基站组网情况下模式搜索坐标解算距离误差频率分布直方图

## **结论**

模式搜索法的性能总是优于最小二乘法。增加基站的数量，会使标签坐标的估计结果更准确。

## **代码**

matlab实现，主程序，main.m。

```matlab
%% 基于UWB室内定位系统的标签坐标解算：以四基站组网为例
clear;

% 定义基站坐标，第一列为x，第二列为y
BaseStation_Pos = [0 0; 6 0; 0 10;5 8];  

% 在场景中生成大量标签坐标
[label_posx, label_posy] = meshgrid(0:0.05:6,0:0.05:10);  

[M,N] = size(label_posx);
num_label = M*N;         % 确定场景中的标签数量

% 采用最小二乘方法得到的坐标解算距离误差
RoughPosAccuracy = zeros(num_label,1);

% 采用模式搜索方法得到的坐标解算距离误差
PrecisePosAccuracy = zeros(num_label,1);

[num_Station, ~] = size(BaseStation_Pos);
r_real = zeros(num_Station, 1);

for k=1:num_label
    for i=1:num_Station
        r_real(i) = norm(BaseStation_Pos(i,:)-[label_posx(k) label_posy(k)]);    % 各基站与标签间真实的距离
    end
    
    % 假设基站测距误差在0.1 m以内，且满足均匀分布
    eps = [-0.1 0.1];                        
    err = eps(1)+(eps(2)-eps(1))*rand(num_Station, 1);  
    r_obs = r_real+err;            % 测量出的各基站与标签间真实距离
    
    [RoughPos,~,~] = UWBRoughPosLSInv(BaseStation_Pos,r_obs);
    [PrecisePos, fmin_sequence] = UWBPrecisePosPatternSearch(RoughPos, BaseStation_Pos, r_obs);
    
    RoughPosAccuracy(k) = norm(RoughPos'-[label_posx(k) label_posy(k)]);
    PrecisePosAccuracy(k) = norm(PrecisePos'-[label_posx(k) label_posy(k)]);
end
```

## **参考资料**

文铠. 基于超宽带的室内定位与定向关键技术研究[D].武汉大学,2020.