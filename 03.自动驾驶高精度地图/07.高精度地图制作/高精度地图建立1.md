**一 概述**

前篇提到的GPS&IMU的行车定位方式，由于GPS信号的多路径传输（例如[电磁波](https://www.zhihu.com/search?q=电磁波&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A2569821567})信号空气漫反射，建筑区域信号折射等），信号丢失（例如隧道场景等）等问题，定位精度仅能满足低阶辅助驾驶功能的需求（GPS信号飘了，IMU基于GPS的预测也就没啥精度可言），对于高阶的全自动驾驶，基于HD-Map的辅助定位应该是必不可少的。下面一起看看HD-Map如何帮助定位的。

**二 什么是High-Definition (HD) Map**

为了方便理解，从我们最熟悉的Navigation Map导航地图说起。平时手机上用的高德地图，百度地图等等就属于这一类，它提供了抽象的主要道路信息和不是很精确的位置信息，例如就画一下道路的拓扑，道路上有几条线，实线还是虚线，具体处在道路的多少m处都不知道。反正是给人用的，人能够很容易的把抽象的信息和实际场景匹配起来，进而确定当前位置。

然而对于机器来讲，看似很简单的逻辑分析却往往难以实现。于是需要把地图信息用机器可以做运算的数据形式进行量化。于是可以应用于低阶辅助驾驶的ADAS Map应运而生，它里面包括了更多的信息，例如当前位置在当前路径的多少m处，当前路径多少m处的限速是多少，车辆前方多远处会有道路分叉和汇入道路，各段道路的曲率是多少等等，给辅助驾驶的关键控制逻辑提供一些必要的输入，例如在哪变道，何时变道等。

随着自动驾驶等级的提高，对地图信息的要求也越来越高，于是HD Map就出现了，它几乎可以提供几乎所有的道路信息，例如车道线位置，种类，颜色；交通信号灯位置及朝向，道路维修区域等等。

**三 HD-Map的采集**

HD-Map包含了更多的信息，[即时性](https://www.zhihu.com/search?q=即时性&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A2569821567})的要求也就会相应的高很多。例如某条车道维修或者多了一个交通标识等，如果不能很快的更新，很容易误导系统做出错误的操作。于是地图供应商需要不断的采集和更新道路信息，有的供应商会组件专门的采集车队，例如Waymo，这种方式一般称为**集中采集**。优点是专门的人专门的设备，成图质量高，容易后处理；缺点是维护成本高，更新频率也很难上去。于是有的地图供应商复用量产车的上传感器，当用户开车的时候把路过的地图数据上传，在云端完成构图，例如Tesla, 这种方式一般称为**众包采集**。优点是成本低，每一个用户都是免费的羊毛；缺点是原始数据精度低，可信度低，需要复杂算法后期处理（例如差分算法，可信性确认等）。

**四 HD-Map的构建**

由于包含信息众多，也为了更加精确，通常使用多传感器融合的方式。综合使用IMU,GNSS, Lidar, Camera, Wheel Odometer, Radar等传感器提供的信息。GNSS可以提供绝对位置信息，还可以提供时间戳用于时间同步。IMU和Wheel Odemeter可以维护预测GNSS的位置信息。Lidar和Camera结合可以提供道路结构点云信息，图像特征深度信息，颜色信息，交通标识等细节特征，也有效的减少了漏检和误检。

多个传感器提供的信息都是基于各自的[坐标系](https://www.zhihu.com/search?q=坐标系&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A2569821567})，首先要做的是**坐标系融合**，将所有的数据表示在同一个坐标系下。又由于各个传感器的输出是不同时间检测到的，如果时间轴不对齐，数据也不能很好的匹配，所以还需要进行**时间同步**。进而求解采集车在某一时间点在全局坐标系下的位姿（经度/纬度/高度; yaw/pitch/roll). 知道了车的全局位姿，车辆连续行驶过程中，就可以把各个传感器从不同角度，不同时间和不同位置获得的不同的或者相同的局部特征（此处要有算法去除掉动态物体）互相验证后一点点拼接起来，最终获得一张完整的地图。

地图生成后，有些深度学习无法很好完成的场景，需要人工审核和确认，以保证地图质量。最后是不断的采集识别道路变更，并更新地图。

**五 HD-Map的应用**

- 定位，通过车载传感器实时数据与HD-Map中的特征进行匹配，以确定车辆在地图（现实世界）中的位姿。需要注意特征匹配算法在缺乏几何特征，重复几何特征和初始几何特征偏差较大的情况下可能会有收敛问题，例如ICP。
- 动态物体识别和跟踪，实时数据采集到了HD-Map没有的特征，一般是动态物体，通过[聚类算法](https://www.zhihu.com/search?q=聚类算法&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A2569821567})予以区分。
- 交通标识，提供限速等交通信息
- 路径规划，有图之后，已知出起始点和目的点，根据搜索算法规划出行驶的路径。
- 仿真验证，高精地图以其与现实世界的高度相似性，是最佳的仿真场景来源，可以覆盖更多真实的场景。
- 需要考虑各个国家和地区的法规和政策，由于地图测绘涉及国家安全，各个国家数据不能共享，地图特征和[数据结构](https://www.zhihu.com/search?q=数据结构&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A2569821567})也因地而异，我国需要需要测绘资质，所以入门和应用的门槛极高。

**六 回到浅入浅出的主题**

HD-Map能够提供精确的多种道路信息，是自动驾驶控制不可缺少的信息来源。但门槛高，大规模落地应用还有些不确定性。