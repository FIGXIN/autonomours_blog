# 3 室内定位技术原理介绍

目前，室内定位技术众多，考虑到市场应用普及性及技术应用前景，本章将从定位原理、定位方式及性能、产业链支持情况以及产业痛点分析这些维度，分析介绍 5G 基站定位、4G 基站定位、蓝牙 4.2定位、蓝牙 5.1 定位、Wi-Fi 定位、UWB 定位、vSLAM 等定位技术。 

## 3.1 室内定位基本原理

室内位置解算分为终端侧解算和网络侧解算两种。其中，终端侧解算是指不经过网络传输，终端可直接解析其自身位置，室外以 GNSS为代表，室内需定位信标发送其坐标位置信息。目前室内定位技术多以网络侧解算为主。 

无线定位信号测量主要包括功率测量、时间测量和角度测量。功率测量包括三角定位和指纹定位，时间测量包括 TOA、UTDOA 和 OTDOA，角度测量包括 AoA 和 AoD。

### **3.1.1** **基于功率测量** 

基于场强测量的定位技术可以分为 2 种，分别是三角定位技术和指纹定位技术。 

 **三角定位技术** 

通过接收信号强度（RSS, Received Signal Strength）计算得到终端到多个定位节点的距离，并以已知节点位置为圆心，终端距离节点的距离为半径形成圆形，多个圆的交点就是终端位置，如图 3.1-1 所示。

![image-20220822105456925](https://img-blog.csdnimg.cn/img_convert/12fc674fdaf0a9722e12c9b6a9c0cc56.png)

终端到基站的距离解算方程组如式（1）：

![image-20220822105515329](https://img-blog.csdnimg.cn/img_convert/3e5b55428625a7b77eb9765d1bc1d88f.png)

此种定位方式要求定位基站与定位终端间可直视，无墙体等阻挡， 可达到较高定位精度。 

 **指纹定位技术** 

当定位信号存在非视距等环境影响因素时，测量到的场强等信息难以真实反映定位基站与终端间的实际距离时，可采用指纹定位技术减轻此类误差。 

指纹定位技术由离线与在线两个阶段构成。离线阶段即指纹库采集阶段，首先进行定位区域的网格划分，然后采集不同网格的信号特征值，将采集得到的信息建立定位指纹库，特征值可为场强等信息。 

在线阶段即指纹定位阶段，测量信号特征值，将测量的信号特征值与指纹库中的预存信息进行指纹匹配，根据匹配算法得出终端坐标位置。

指纹定位流程如图 3.1-2 所示：

![image-20220822105543464](https://img-blog.csdnimg.cn/img_convert/8c2336a2061b1bf802599a5bc3408e78.png)

指纹定位技术主要缺点在于指纹数据库采集工作量大，且在后期维护过程中，随着环境发生变化，需重新采集维护指纹数据库。 

### **3.1.2** **基于时间测量** 

 **TOA** **测量** 

TOA（Time of Arrival）又称 TOF（Time of Flight），一般又分为双向测距和基于时钟同步的 TOA 测距。常用的双向测距法不需要定位标签和定位基站之间严格时钟同步，只需要未知点（即定位标签）向参考点（即定位基站）发送信号，定位基站也向定位标签发送信号，如图 3.1-3 所示：

![image-20220822105612390](https://img-blog.csdnimg.cn/img_convert/d06b8375227559c6671101d9afd58c18.png)

![image-20220822105623809](https://img-blog.csdnimg.cn/img_convert/20031287ff75d5537d8180f84ec4535c.png)

同理，确定该未知点与其他参考点之间的距离，根据至少三个距离即可确定该未知点的位置。例如当获取到标签到至少 3 个基站的间距时，即可根据三点定位方法实现定位，如下图 3.1-4：

![image-20220822105645584](https://img-blog.csdnimg.cn/img_convert/969bff3fef579a95ce5dc16c446e7f5c.png)

 **TDOA** **测量** 

基于时间到达差(TDOA，Time Deference of Arrival)的定位法要求参考点之间的时钟严格同步，而对参考点与未知点之间则没有时钟严格同步的要求，这就能相对简化定位系统，降低定位系统成本。 

TDOA 定位法的定位过程：预先将所有参考点之间时钟同步，未知点发出信号，不同参考点在不同时刻接收到该信号，选取某参考点接收到信号的时刻作为基准，其他参考点收到信号的时刻减去该基准得到定位信号到达时间差，该到达时间差即为 TDOA 值。根据未知点与两个参考点之间的 TDOA 值可以建立一条双曲线，实现二维定位需要至少三个参考点建立一组双曲线方程求解得到未知点的位置估计，如图 3.1-5 所示： 

![image-20220822105711278](https://img-blog.csdnimg.cn/img_convert/c3e771db58bdfda18265c460e403b455.png)

由于根据距离差做出的双曲线相较于根据距离做出的圆而言，其呈发散型，因此，实际应用中通常需要至少 4 个基站来获得多条双曲线来获取冗余 TDOA 值，并将误差较大的 TDOA 值剔除之后再确定未知点的坐标，这样可提高 TODA 定位的精度。 

根据信号上下行，TDOA 测量技术可分为 OTDOA 和 UTDOA。 

OTDOA（Observed Time Difference of Arrival）：移动终端对基站下行定位信号进行测量。 

UTDOA（Uplink Time Difference of Arrival）：移动终端发射上 行 测 量 信 号 ， 网 络 侧 基 站 或 者 定 位 测 量 单 元 （ LocationMeasurement Unit，LMU）测量得到时间差。 

 **TOA** **测量和** **TDOA** **测量有各自的优势：** 

TOA 测量的优势在于： 

 精度较高，定位收敛； 

 基站逻辑简单； 

 结合一定的算法，可以实现小房间内单基站存在性检测； 

TDOA 的优势在于： 

 容量大； 

 标签功耗低； 

 标签逻辑简单，省去基站； 

 搜寻机制。

### **3.1.3** **基于角度测量** 

 **AOA** **测量** 

到达角（Angle of Arrival, AOA）是发射器通过单一天线发送特殊的数据包，接收器通过多天线接收，由于各个天线到发射器的距离不同，会产生相位差。通过相位差和天线间的距离计算出相互之间的角度关系。 

![image-20220822105801159](https://img-blog.csdnimg.cn/img_convert/571bc2b0aac75347345b381a2919bbe1.png)

![image-20220822105809391](https://img-blog.csdnimg.cn/img_convert/aa6481ca705445aa44cc59d962e69df7.png)

采用到达角测量在视距传播时定位精度较高，在非视距传播时定 位精度显著降低。 

 **AOD** **测量** 

出发角（Angle of Departure, AOD）与到达角相反，接收器是单天线，发射器多个天线发射特殊的数据包，接收器根据产生的相位差、天线距离，计算出相对的方向和距离。

![image-20220822105827697](https://img-blog.csdnimg.cn/img_convert/21cf5fc3fab44ce8e4f3c942174d51b6.png)

# 4 室内定位评测体系

目前，能够实现室内定位的技术众多，不同技术各具优势但同时也各有局限性。如何选择不同的定位技术满足业务层面对定位精度、定位时延、容量等方面的需求，同时兼顾设备成本、部署难度等，将需要对多个维度的关键指标进行评估测试。本章将介绍评价不同定位技术的关键指标，以及相应的测试方法。

## 4.1 室内定位关键性能评价指标

### 4.1.1 关键指标定义

**定位精度**：定位精度是评价室内定位技术性能最重要的指标，是指定位系统计算得到的终端位置信息与其真实位置之间的接近程度，通常用两者之间的欧式距离表征。 

为便于下文表述，将不同定位精度的定义约定如下: 

 厘米级定位精度：固定概率模型下，定位系统计算得到的位置信息准确度在 0.01-0.1 米； 

 分米级定位精度：固定概率模型下，定位系统计算得到的位置信息准确度在 0.1-1 米； 

 米级定位精度：固定概率模型下，定位系统计算得到的位置信息准确度在 1-10 米； 

**定位时延：**指从定位终端到达特定位置与定位平台稳定显示该终端位置的时间差，主要包括定位信号传输时延和平台解算时延； 

**并发容量：**定义为在单位时间内，在满足定位精度和定位时延性能的条件下，单个定位基站可以支持的定位终端数量； 

**同步性能：**在定位系统中，为了提高定位精度，通常多采用多站联合定位，同步性能指的是多站定位中对基站时间同步的要求； 

**单站距离**：指特定定位精度下，单个定位基站的覆盖距离； 

**功耗性能**：指基站和定位终端在特定状态下的耗电，包括在休眠状态、定位数据传输状态以及位置信息解算状态的耗电； 

**射频性能**：指基站和定位终端的发射功率、测量精度、解调能力等射频能力满足应用要求。

### 4.1.2 不同定位技术关键指标

![image-20220822110029569](https://img-blog.csdnimg.cn/img_convert/1fc207c6cfa68e33ca9cf73398fd7dae.png)

## 4.2 室内定位关键性能评测方法

### 4.2.1 室内定位精度

定位精度是评价室内定位技术性能最重要的指标，指的是定位系统计算得到的终端位置信息与其标定真实位置之间的接近程度，在二维定位中为平面位置，三维定位中还包括高度。严格来说，定位精度包括“准确度”和“精确度”，“准确度”表示测量值与标定真实值的接近程度，用于表明测量值的正确性；“精确度”表示多次测量结果相互之间的符合程度，用于表明测量值的可重复性。影响定位精度的重要因素为定位解算算法，同时定位基站部署密度和位置、遮挡和干扰、设备测量误差等均会对定位精度产生影响，在测试中需要考虑到。 

如图 4.2-1 所示，定位系统包含定位解算平台、定位基站以及定位终端。定位基站和定位终端承担了底层通信，获取通信信号的原始信息并上传到定位平台，定位平台进行位置解算，最终定位结果在定位平台呈现。

![image-20220822110112527](https://img-blog.csdnimg.cn/img_convert/fbbb6c92442a50daacf61956f7eb9765.png)

定位精度可在实际环境下选定测试点进行测试，将定位平台解算出来的位置坐标和标定的实际位置坐标进行比对，计算定位误差。根据应用场景不同，室内定位模式可分为零维定位、一维定位、二维定位和三维定位。其中零维定位为存在性测试，仅用于检测定位标签是否位于特定房间内；一维定位为线性定位，应用于走廊、隧道等场景，通常忽略线性区域的宽度，仅关注标签的 X 坐标；二维定位为平面定位，关注标签在空间内的具体位置（X、Y 坐标）；三维定位是在二维定位基础上增加对标签所处高度的测算。 

为覆盖较为全面的使用场景，如图 4.2-2 所示，测试环境可包含一个正方形大房间、长度适宜的走廊以及相邻的两到三个小房间，分别用于测试二维、一维及零维定位性能。同时考虑到环境中是否存在遮挡对定位精度是有影响的，可在二维测试的大房间中，利用立柱等构造遮挡环境。

![image-20220822110146847](https://img-blog.csdnimg.cn/img_convert/4608585445a591d7e3f395b6169e6aca.png)