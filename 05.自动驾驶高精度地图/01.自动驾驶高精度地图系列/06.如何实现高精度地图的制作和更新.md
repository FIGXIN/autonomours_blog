- [自动驾驶之高精度地图（六）如何实现高精度地图的制作和更新 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/369258953)

前面有提到普通地图是通过GPS+卫星图片进行制作的，当然也有测绘相关的介入，相对于比较简单一些，但是高精度地图就没有那么容易了，我们先整体来看看高精度地图制作的全貌，再针对每个细节进行描述，这里就以目前走的最前沿的百度高精度地图制作为例。

## 1 高精度地图的制作

![img](https://pic1.zhimg.com/80/v2-2d517002be58204d1d7df0052cb0a6b8_720w.jpg)



总共目前高精度地图的生产有四大步骤，包括**数据采集，数据处理、元素识别、人工验证**最终才是产品编译。

①**首先我们来看看数据采集阶段**，正如不是所有的牛奶都是特仑苏，不是所有的地图采集车都是高精度采集车一样，只有像下面这样配置的车（百度Apollo2.5）才是高精地图采集车。

它得有采集点云数据的激光雷达装置，进行高精定位的RTK装置，获取车辆角度和加速度的惯导系统等，才能叫做高精地图采集车。一台车的成本在百万以上，由此可见，自动驾驶和高精地图是烧钱产业。

![img](https://pic4.zhimg.com/80/v2-a938dfa2b7b1877d8a9886424ddc8d37_720w.jpg)

我们先来看看硬件配置

1、64线激光雷达采集道路路面，16线激光雷达斜向上装检测高处红绿灯、标牌信息。

2、GPS采用RTK

3、长短焦相机

4、有监控传感器状态的部分，确保各个传感器在工作时情况良好

5、有一键式采集方案，在一键采集之前要确认传感器是正常工作的，传感器是已经被标定过的（不同厂家对同一个地面的反射值不同）。

6、在采集过程中，双向车道要采集3~5遍

7、一次采集行为会把所有结果（点云、车辆的标定参数、定位结果、pose结果等）都放进一个包

8、采集结束之后把数据传输给平台制图；

**②数据处理**：数据分为点云和图像两类，因为高精度要求，所以制图以点云为主。

![img](https://pic4.zhimg.com/80/v2-7f65e8d78379bdd9be5ba5bd45b9646f_720w.jpg)

（1）点云拼接：采集过程中信号可能不稳定（RTK在遮挡情况下会出现不稳定现象），通过SLAM等对pose做优化，优化之后对点云信息做拼接得到完整的点云信息。点云信息被压扁得到定位地图图像、反射地图图像。反射地图可以做一些标注。

（2）点云图像处理后得到一个高精度图像，基于图像可以做精确的车道线识别，获得车道线的形状特征。但仍需要道路虚实线、黄白线、路口标识等信息，这时候需要元素识别。

**③元素识别**

车的自动化程度不够 ，无法解决道路上没有车道线的部分以及无法理解逻辑信息（比如停止线和红绿灯的关联关系）

![img](https://pic1.zhimg.com/80/v2-ab7a3c11f321fd8524c84fa724ede710_720w.jpg)



这里的元素识别最能体现高科技了，基本上都是使用深度学习来获取地图的要素识别；

基于深度学习的地图要素识别有两个层面：

（1）是否能基于点云分割，从点云里提取特征。

（2）尝试从点云中提取车道线、灯杆、红绿灯等；

**④人工验证：**

![img](https://pic3.zhimg.com/80/v2-847d483ac5071bdda73d77615969a5b2_720w.jpg)

这一环节由人工完成，自动化处理的数据还不能百分百准确，需要人工在进行最后一步的确认和完善。按照现在的情况，一名员工修正的数据量在30-50公里左右，对于修正后的数据，需要上传到云端，最终形成的高精度地图也通过云平台进行分发。

## 2 如何进行高精度地图的数据更新

![img](https://pic1.zhimg.com/80/v2-8c8f2cf20bac3a5d62fb76b7e596d52c_720w.jpg)



高精地图落地的完整闭环包括制图、用图和更新三个紧耦合的过程，以保证数据的高频流动和更新。制图包括外业采集和内业制作，用图包括高精（自）定位、环境感知和路径规划，更新包括变化检测和交叉验证。上面几个章节已经说明了制图和用图两个技术环节，本章节重点讲述更新部分。

高精度地图动态与静态信息并存的特性决定了后期的更新维护会占据更大的工作量。业内已经形成共识，相比于前期劳动密集型的绘图制图工作，高精度地图后期的维护更新才是核心竞争点。根据博世提出来的定义，无人驾驶时代所需要的局部动态地图数据依据更新频率可以划分为四类：**永久静态数据（更新频率为1个月）、半永久静态数据（频率为1小时）、半动态数据（频率为1分钟）、动态数据（频率为1秒）**。与当前普及的电子导航地图1~2月更新一次的频率相比，高精度地图的更新频率之高、难度之大可想而知。传统的地图生产方式在面对高精度地图日级乃至更高频率的更新时会显得捉襟见肘。

![img](https://pic1.zhimg.com/80/v2-91478c48f3a472ab00761b7833a76190_720w.jpg)



地主家也没有余粮啊，按照这个更新频率，地图厂家早晚得破产，我们就简单算一笔账单，前面也提了采集的高精度的地图车一辆在100W左右，按照这个频率，需要上万辆车都没有办法做到这个更新频率，而且人工就更不说了，估计得上百万的人工验证，那投入就是天量资金，所以在这种情况下人民群众的智慧出现了，有点类似做工程外包一样，出现了地图的众包方案。

具体而言，就是把地图更新的任务交给道路上行驶的大量非专业采集车辆，利用车载传感器实时检测环境变化，并与高精度地图进行比对，当发现道路变化时，将数据上传至云平台，再下发更新给其他车辆，从而实现地图数据的快速更新。

![img](https://pic3.zhimg.com/80/v2-2d6acca34e0e176a55ad74145bc67a16_720w.jpg)

上图是Mobileye 高精地图众包采集模式，可以看到就是搭载这个芯片的车辆就可以成为众包采集的车，主要采集路面和路标等数据，而且上传是匿名加密上传到云系统，通过云系统进行数据的加工整合，然后形成新的高精度地图roadbook，通过下发给到有允许高精度地图roadbook的车辆进行10cm的高精度定位。

**总体而言高精度地图的制作和更新都是天价。**