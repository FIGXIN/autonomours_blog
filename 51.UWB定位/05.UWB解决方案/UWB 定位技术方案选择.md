1、 基于测距的定位方案；

定位标签和定位基站逐一测距，得到所有的距离数据之后，服务器计算标签的位置。

2、 基于到达时间差（TDOA）的定位方案

基站时间同步之后，标签只需要发送一个广播报文，所有基站将收到这个报文的时间戳发送到服务器，服务器计算标签的位置。

# 1 定位系统逻辑单元

定位系统由至少三个逻辑单元组成：

 定位标签：即被定位设备；

 定位基站：信息收集单元；

 定位服务器：位置计算单元；

# 2 进入检测

![image-20220822111734837](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f5551aef3.png)

这种模式，主要是用于检测目标是否在指定区域。这种模式，只需要一个基站，标签和基站进行测距即可完成。

# 3 按维定位

根据应用场景的不同，可以实现一、二、三维定位。

## 3.1 一维定位

典型应用为巷道定位，只需要定位目标在这个巷道的相对位置。一般会忽略巷道的宽度。

![image-20220822111819692](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f5574c0a1.png)

在这种模式下，可以采用基站时间同步的方式实现一维定位。

## 3.2 二维定位

二维定位需要确定在空间的 X、Y 坐标。分两种情况

1、 类似于道路的伪二维定位

和一维定位非常类似，但采用测距的方式实现定位功能。通过标签离基站的距离，计算标签的位置，有于场景的特殊性，可以计算出标签的最终位置。

![image-20220822111855021](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f55967ee2.png)

2、 标准二维定位

![image-20220822111907004](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f55b3908e.png)

通过三个以上的基站，确定区域内的标签的位置。可以得出基站的二维坐标。在这个系统中，由于只有二维坐标，需要关注“垂直投影”带来的误差。如下图：

![image-20220822112004326](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f55d1931e.png)

基站 4 和其他基站不在同一个平面上，若做测距，得到的是标签和基站4 的斜边的距离，需要通过投影到平面进行计算。

## 3.3 三维定位

实现三维定位，需要求出被定位设备的 XYZ 三维坐标，在基站架设的时候，需要特别拉开 Z 轴的高度差，以确保在 Z 轴上的精确度。若用测距的方式，三个基站就可以完成三维定位，用 TDOA 的方式，必须要四个以上基站才能完成。

![image-20220822112029215](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f55f2b96e.png)

# 4 方案优势与不足

## 4.1 基于测距的不足

在上文中提到，采用测距的方式，标签需要和基站逐个测距，然后才能完成定位。在 6.8Mbps 的工作速率下，完成一次 TWR 测距，需要 2ms，若有 4 个基站，完成一轮测距需要 8 ms。导致系统容量比较低；

另外一个方面，由于测距需要多次的报文发送，和较长的等待接收的时间，系统的功耗增加，导致电池的待机时间变短。

但基于测距的系统，由于不需要时间同步，其实施相对简单，容易上手。

## 4.2 TDOA的优势与不足

相对于测距，TDOA 每次定位，只需要发送一个广播报文，即可完成定位。

其容量远高于基于测距模式，同时，功耗也极大降低。理想情况下，按 1Hz 计算，系统容量可以达到 1500 个标签。

但 TDOA 实现难度更大，时间同步要求比较高。需要达到 0.2ns 以下，才能有效的保障系统精度。沃旭通讯提供无线时间同步的方式，系统定位精度达到30 厘米。

但 TDOA 也有不足，有一些场景无法适用于 TDOA，比如，基站在中间，标签在基站外围的情况下，其定位精度比较差，TDOA 不适用。

# 5 场景分析

方案选择

![image-20220822112118797](https://www.lovebetterworld.com:8443/uploads/2022/08/22/6302f5621809e.png)

**如何提高基于测距的系统容量**：

由于 UWB 目前不支持 CSMA，同时也为了确保系统的容量，若采用自由冲突的方式，进行测距定位，系统的容量非常低。可以通过增加一个中间点，来控制标签的测距流程，以增加系统的容量。比如，在刚才的例子中，若一轮测距需要 8ms，1Hz 的工作模式下，可以达到 125 个标签的容量。

**如何解决基站在中间，标签在外围的定位**

在这种模式下，无法采用 TDOA 的方式实现定位，因为 TDOA 的方式，标签在外围的时候得到的精度会比较差，误差将超过 1 米以上，系统可用性会比较差。在这个模式，主要采用测距的方式来实现，但是测距的模式需要优化，如何在测距的同时，降低测距所需要的时间。