- [GNSS+UWB 精确室内定位解决方案 (gemsnav.com)](https://www.gemsnav.com/cases_detail_40.html)

星火源的UWB+GNSS定位系统，其主要的解决的问题是UWB标签在室外没有UWB的地方，可以通过GPS来实现定位，通过运营商的NBIOT网络回传定位信息到定位引擎服务器，通过服务器反馈到用户界面。

在有UWB基站的环境中（无论是室内还是室外），WUB标签的定位数据由 UWB 基站传输到定位引擎服务器进行定位，在室内外地图中展示。在室外没有UWB基站的环境中，北斗 GPS 定位数据通过 NBIOT 传输到定位引擎服务器，在地图中显示位置。北斗GPS 只能用在室外定位。

本文主要针对集成 UWB 和北斗 GPS一体标签和UWB基站的使用。

# 一、简介

G1000标签集成 UWB，NBIOT 和 GNSS 室内外定位技术一体的标签，可以用于室内外 UWB 和室外北斗 GPS 的无缝定位。

室内外 UWB 定位的数据由 UWB 基站传输到后台进行定位，在室内外地图中展示。注意，如果室外也布局 UWB 基站，也是可以再室外定位的。

室外北斗 GPS 定位数据通过 NBIOT 传输到后台，在地图中显示位置。北斗GPS 只能用在室外定位。

## 1.1 UWB 和 GPS 北斗融合定位架构框图

**基站：**要用UWB技术给一个空间做室内定位，必须要预先在该空间安装好定位基站。基站通过UWB信号和定位标签进行通信，实现标签的定位功能。

**标签：**标签发射UWB信号，与基站相互通信，使标签自身被定位。

**定位引擎：**环境中的基站实时通过互联网网络将原数数据发送给定位引擎（可能位于本地服务器或云端）。定位引擎运行定位算法，实时计算出待定位标签的坐标位置置。

**显示终端：**定位引擎计算出的标签坐标，要在显示终端上呈现。终端可能是PC、平板电脑、手机等任意有浏览器的屏幕。

![img](https://www.gemsnav.com/upload/image/20211020/211.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/23.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/356.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/4.jpg)

# 二、软件管理平台

我司定位管理平台，既可以部署在本地服务器，也可以部署在共有云上。

定位管理平台包含几部分主要功能：定位引擎、基站和标签配置、定位呈现和管理。

当定位管理平台部署完毕后，打开任意一种终端（PC、平板、手机等）的浏览器，即可访问。

![img](https://www.gemsnav.com/upload/image/20211020/14.jpg)

# 三、软件功能

实时精确定位：2D高精度定位展示，运动轨迹拖尾展示（可设置长度）

历史轨迹回放：历史轨迹记录、回放（可加速）

电子围栏管理：多类型区域划定（安全/警告/危险）、多种触发方式（进入/离开/进出）、多种报警方式（屏幕推送/声音提示/邮件/短信/电话）、自动日志记录

灵活标签管理：人员信息设置，低电量报警，异常轨迹提醒，标签分组设置，标签图标设置

多屏便捷查看：中央监控屏幕，PC/Pad/手机多屏显示（无需安装应用程序）

账户权限管理：自助配置管理员/访客账户，账户写操作权限灵活设置

手机自主定位：被定位人员可以用手机微信看到自己的位置

开放API：标签位置坐标，传感器信息（电量等），事件上报（突破围栏等）

摄像头联动：摄像头自动追踪、定位、联动，支持符合ONVIF接口标准的全球主流品牌摄像头

大数据分析：热点分析，位置行为分析，工序效率分析，供应链路径分析等。

# 四、通信接口

接口电平：串口 TTL 电平 3.3V

数据协议：《GEMS 标签配置协议_V1..1_USER.pdf》

硬件连接：MicroUSB 硬件连接器当做串口使用，具体连接方法如下：

![img](https://www.gemsnav.com/upload/image/20211020/5.jpg)

# 五、引脚描述

VBUS：5V 充电接口

D-：实际连接到串口 TX，特殊处理 D+：实际连接到串口 RX，特殊处理 GND：地

ID：浮空，用于物理断电，特殊处理

![img](https://www.gemsnav.com/upload/image/20211020/6.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/7.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/8.jpg)

![img](https://www.gemsnav.com/upload/image/20211020/9.jpg)

**UWB室内外定位地图访问方法**

![img](https://www.gemsnav.com/upload/image/20211020/10.jpg)



# 六、北斗 GPS 室外定位地图访问方法

(1)   拔掉标签 MicroUSB 的黑色塞子，让标签处于运行状态，拿到没有 UWB基站的地方

(2)   由于室内楼宇的遮挡，室内 GNSS 基本无法定位，需要走到室外；

(3)  联系销售或者技术人员获取后台账号，登录之后可以在后台管理系统中看到如下：

![img](https://www.gemsnav.com/upload/image/20211020/11.jpg)

(4) 查看需要定位的标签是否添加到列表中，只有添加到列表中，才可以在该地图显示该标签的位置，如果没有添加，是不会显示室外定位的位置。

![img](https://www.gemsnav.com/upload/image/20211020/12.jpg)

**室外成功定位后，如下图显示，可以放大地图查看具体的位置**

![img](https://www.gemsnav.com/upload/image/20211020/13.jpg)



# 七、GPS和UWB的定位原理

**GPS/北斗定位原理：**

![img](https://www.gemsnav.com/upload/image/20211020/1244.jpg)

整个室内定位系统基于UWB（Ultra-Wideband超宽带）技术

![img](https://www.gemsnav.com/upload/image/20211020/1255.jpg)

UWB信号的    时域波形如上图所示。不同于传统的无线射频信号有固定频率的载波（如蓝牙2.4G），UWB在不发送数据时是完全静态的，要发送数据时才发送宽度很窄（如1ns）的脉冲信号。该窄脉冲在频域上很宽，所以叫超宽带。因为UWB时域信号脉冲较窄，所以在时间、空间上有较大分辨力，比较容易抵抗室内信号传输常见的多径效应（信号因为反射造成的多路径传播）的影响，因此测距和定位精度较高。

我司UWB定位系统通过在固定的基站和移动的标签之间发送UWB无线脉冲来测量飞行时间（差），然后通过类似三边定位等方法，及创新的定位算法，来实现标签的精确定位。在无遮挡情况下，定位误差可以达到10厘米。

# 八、部署实施方法和流程

基站通常安装在墙面高处，或天花板吊顶。

为一个空间做3维定位（平面坐标和高度），至少需要4个基站；

为一个空间做2维定位（平面坐标），至少需要3个基站；

为一个空间做1维定位（线性位置，例如走廊和隧道等），至少需要2个基站。

为一个空间做0维定位（存在性检测，例如小房间），需要1个基站。

实现定位需求所需的最小基站数，我们称为一组基站（例如2维定位的一组基站是3个）。

我司普通室内型基站，彼此间距最大100米，最小5米。

基站安装时需要确保组内基站彼此间目视不要有障碍物遮挡，并且尽量让基站间包含的面积最大（2维定位为例），这样定位精度比较理想。

当空间很大时，布置多组基站即可。

基站需要将定位数据传递给定位引擎。传输路径有：网线、WIFI、4G三种。如果选择4G联网方式，定位引擎需要部署在云端。

# 九、硬件管理平台

我司定位管理平台，既可以部署在本地服务器，也可以部署在共有云上。

定位管理平台包含几部分主要功能：定位引擎、基站和标签配置、定位呈现和管理。

当定位管理平台部署完毕后，打开任意一种终端（PC、平板、手机等）的浏览器，即可访问。