# 1 范围

本文件规定了智能网联汽车车载终端与云控基础平台之间的数据交互方式和报文传输格式。

本文件适用于智能网联汽车云控系统中智能网联汽车车载终端（以下简称“车端”）与云控基础平台（以下简称“云端”）的数据交互，包括车辆运行数据上报、车端功能订阅，云端实时感知、决策、控制信息与指令等数据下发。

# 2 规范性引用文件

下列文件中的内容通过文中的规范性引用而构成本文件必不可少的条款。其中，注日期的引用文件，仅该日期对应的版本适用于本文件；不注日期的引用文件，其最新版本（包括所有的修改单）适用于本文件。

GB 5768.2-2009 道路交通标志和标线 第2部分道路交通标志

GB/T 29100-2012 道路交通信息服务 交通事件分类与编码

GB/T 40855-2021 电动汽车远程服务与管理系统信息安全技术要求及试验方法

# 3 术语和定义

T/CSAE XXXX《智能网联汽车云控系统第 1 部分 基础术语》界定的以及下列术语和定义适用于本文件。

3.1 云控基础平台 cloud control basic platform

云控基础平台是由边缘云、区域云与中心云三级云组成，形成逻辑协同、物理分散的云计算中心。云控基础平台以车辆、道路、环境等实时动态数据为核心，结合支撑云控应用的已有交通相关系统与设施的数据，为智能网联汽车与产业相关部门和企业提供标准化共性基础服务。

3.2 上行 upstream

车端到云端的数据传输方向。

3.3 下行 downstream

云端到车端的数据传输方向。

3.4 心跳 heartbeat

车端向云端发送的用于维护连接不被断开的通信数据。

3.5 心跳回应 heartbeat response

云端对心跳数据的回应数据。

# 4 缩略语

下列缩略语适用于本文件。

ABS 制动防抱死系统 Antilock Brake System

ACC 自适应巡航 Adaptive Cruise Control

AEB 自动紧急制动系统 Autonomous Emergency Braking

CLOUD2VEH 云端下发至车端 Cloud to Vehicle

DMS 驾驶员监测系统 Driver Monitor System

EDR 事件数据记录系统 Event Data Recorder

ESP 车身电子稳定系统 Electronic Stability Program

FCW 前向碰撞预警系统 Forward Collision Warning

LCA 变道辅助系统 Lane Change Assist

LDW 车道偏离预警 Lane Departure Warning

LKA 车道保持辅助 Lane Keeping Assist

RSI 路侧单元信息 Road Side Information

TCS 牵引力控制系统 Traction Control System

UTC 协调世界时 Coordinated Universal Time

VEH2CLOUD 车端上传至云端 Vehicle to Cloud

# 5 数据类型

## 5.1 二进制类数据类型

协议约定的数据传输格式为二进制格式，二进制类数据类型定义见表 1。

| 序号 | 英文名称      | 长度 | 中文名称                                                     | 取值范围                            |
| ---- | ------------- | ---- | ------------------------------------------------------------ | ----------------------------------- |
| 1    | BYTE          | 1 B  | 无符号整型                                                   | [0..255]                            |
| 2    | BYTE[n]       | n B  | 无符号整型                                                   | [0..256<sup>n</sup>-1]              |
| 3    | WORD          | 2 B  | 无符号整型                                                   | [0..65535]                          |
| 4    | INT           | 4 B  | 有符号整型                                                   | [-2<sup>31</sup>..2<sup>31</sup>-1] |
| 5    | UNSIGNED INT  | 4 B  | 无符号整型                                                   | [0.. 2<sup>32</sup>-1]              |
| 6    | LONG          | 8 B  | 有符号长整型                                                 | [-2<sup>63</sup>..2<sup>63</sup>-1] |
| 7    | UNSIGNED LONG | 8 B  | 无符号整型                                                   | [0.. 2<sup>64</sup>-1]              |
| 8    | STRING[n]     | n B  | 字符串类型                                                   |                                     |
| 9    | TIMESTAMP     | 8 B  | UTC+8 时间（单位：ms）                                       | [0.. 2<sup>64</sup>-1]              |
| 10   | TS_MIN        | 4 B  | 当前时刻距 1970 年 1 月 1 日 0 时整的 分钟数，TS_MIN = TIMESTAMP/60000 | [0.. 2<sup>32</sup>-1]              |

## 5.2 结构体类数据类型

部分数据传输类型采用结构体进行描述，其定义及成员数据类型及定义见表 2。

![image-20221021213606231](https://img-blog.csdnimg.cn/img_convert/7d9e5718bf3931d866bf717299c40a8d.png)

![image-20221021213626095](https://img-blog.csdnimg.cn/img_convert/a163f50403d11ee4201b8ca11d867ed6.png)

![image-20221021213639648](https://img-blog.csdnimg.cn/img_convert/68150d9eb0b4878d427747e91e8cd617.png)

# 6 传输规则

## 6.1 整体规则

数据传输应符合下列要求。

——数据传输应采用大端字节序传输；

——经纬度等坐标信息采用 GCJ-02 坐标系等，可通过准静态参数配置确定；

——字符串类型应采用 UTF-8 编码格式；

——时间戳应为经过东八区转换后的 UTC 时间。

## 6.2 网络连接规则

车端与云端车云网关连接时，建立基于 TLS1.2 及以上版本的双向认证的 TCP 连接，并使用云控基础平台签发的客户端证书。

车端设备启动后，发起请求和云端建立两个 TCP/UDP 连接。一个用于高频实时数据上报（可使用 UDP 连接），另一个用于实现各种车云数据交互功能（应使用 TCP 连接）。数据上报采用云端固定端口（如固定端口 50001），下文称数据上报通道；车云数据交互中的指令下发也采用云端固定端口（如固定端口50002），下文称指令下发通道。

TCP 连接维持规则：连接建立后，车端应按固定频率向云端发送心跳消息，云端收到后向车端发送心跳返回消息。

TCP 断开规则：

——平台和车端都可以根据协议主动断开连接；

——平台判断 TCP 断开方法：

1）根据协议断开车端连接；

2）相同身份车端建立连接，断开原连接；

3）在一定的时间内未收到车端发出的消息或者心跳；

——车端判断 TCP 断开方法：

1）根据协议断开云端连接；

2）达到重传次数后仍未收到应答。

——车端和云端发现任意 TCP 连接断开后，由车端主动请求重新建立连接，车端处于非工作状态时，保持连接断开状态。

# 7 行为和时序

## 7.1 网络连接

本文件所述车端与云端的网络连接指车载终端通过运营商 4G 或 5G 网络与云控基础平台建立的网络连接，如图 1 所示。

![image-20221021215140619](https://img-blog.csdnimg.cn/img_convert/5f9af2fe2e7276a3955bae9e6cd6664e.png)

## 7.2 数据传输

本文件所述车端与云端之间的数据传输类型共 7 种，包括车载终端设备与云控基础平台之间的 3 种上行和 4 种下行数据传输，如图 2 所示。

![image-20221021215154685](https://img-blog.csdnimg.cn/img_convert/0a5324bfaf9bebbd443ddf3226919acc.png)

## 7.3 传输时序

本文件所述车端与云端之间的数据传输时序是指车端到云端建立网络连接、数据上报的顺序，以及车端到云端再到车端的建立网络连接、车端功能请求、云端指令下发的顺序，如图 3 所示。

![image-20221021215210341](https://img-blog.csdnimg.cn/img_convert/eec4e19715565fbc5284686ac3852067.png)

# 8 数据交互协议定义

## 8.1 数据格式

TCP 报文数据部分的数据格式，包括固定报头和数据段两部分。其中，固定报头总长度固定为 15 字节，包含报文头部信息；数据段长度不固定，包含有效负载数据，数据包结构见表 3。

![image-20221021215225959](https://img-blog.csdnimg.cn/img_convert/49a6fbba31c06defbcedfc04dc292778.png)

### 8.1.1 固定报头

固定报头包括报文类型、剩余长度、数据类别、版本号和数据时间戳等字段，共 17 字节，每个字段序号、名称及含义见表 4。

| 序号 | 字段名称   | 取值范围、单位及含义                               |
| ---- | ---------- | -------------------------------------------------- |
| 1    | 标识位     | 固定为 0xF2                                        |
| 2    | 数据段长度 | [0..16,777,214]，单位：字节，最多描述 16MB 数据    |
| 3    | 数据类别   | [0.255]，描述数据的类别，见附录 A TCP 数据类别列表 |
| 4    | 版本号     | [0.255]                                            |
| 5    | 时间戳     | UTC 时间戳（东八区），单位：毫秒                   |
| 6    | 控制内容   | 描述优先级控制的版本以及报文优先级，以及加密方式   |

## 8.2 字段含义

### 8.2.1 标识位

标识位固定为 0xF2。

### 8.2.2 数据段长度

数据段长度表示当前报文中数据段内容所占字节数。

### 8.2.3 数据类别

数据类别占 1 个字节，取值范围为 0x00~0xFF，表示不同的类别，定义见附录 A TCP传输数据类别定义。

### 8.2.4 版本号

同一数据类别的不同版本号标识不同的数据集。

### 8.2.5 时间戳

发送端采集数据时刻的时间戳，精确到毫秒。如采集多项数据时刻不同可取一个平均时刻。

### 8.2.6 控制内容

控制内容包括报文优先级与加密方式两个部分，为预留字段，可自定义实现方式。

表 5 给出了一种可参考的实现方式。针对优先级控制，车端应支持抢占式任务，高优先级的数据到达后优先响应高优先级的命令。云端的优先级由业务自行负责定义。

其中，车辆状态信息实时上报需要满足 GB/T 40855-2021 中的加密要求，应采用 SM4，秘钥长度不低于 128 位的 AES 或其他同级别以及更高级别的密码算法。

| 比特位 | 表示含义   | 备注                                                         |
| ------ | ---------- | ------------------------------------------------------------ |
| BIT0-3 | 报文优先级 | [0..7]，7 级别表示最高优先级                                 |
| BIT4-7 | 加密方式   | [0..7]，0：不加密；1：AES；2：SM4；3：SM2；4： SM3；4：RSA；5：国密 X509；6-7：预留位 |

### 8.2.7 数据段

数据段定义根据数据类别不同，数据结构和长度均有所不同，定义见本章 8.3~8.12 节。

## 8.3 车端准静态参数信息

车端准静态参数信息报文定义如下。

——报文名称：车端准静态参数信息 VEH2CLOUD_INH（8.3 称 INH）

——数据通道：数据上报通道

——数据类别：VEH2CLOUD_INH——0x34，CLOUD2VEH_INH_RES_0x35 

——版本号：0x01 

——数据定义：描述车端准静态参数的数据，如软硬件版本、坐标系类型等——业务功能：将车辆准静态参数信息上报云端。

### 8.3.1 传输行为

传输行为的前提条件是在车端启动完成 TCP 连接或完成 TCP 重连后。

在车端，使用 VEH2CLOUD_INH 上报一次设备准静态参数信息。发出准静态参数信息后超过预定时间（如 1s）未收到回复，重新发送信息，连续三次未收到返回，认为连接异常。

云端收到后返回 CLOUD2VEH_INH_RES。

注：每次断链重连均需要同步。

### 8.3.2 异常处理

当车端认为连接异常时，主动断开连接。

### 8.3.3 数据结构定义

车端准静态参数（VEH2CLOUD_INH）数据结构见表 6。

| 项目                       | 字段名称               | 元数据类型 | 描述                                                         |
| -------------------------- | ---------------------- | ---------- | ------------------------------------------------------------ |
| 车辆编号                   | vehicleId              | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控 基础平台中进行登记/注册，车辆编号定义可 参考附录 B vehicleId 编码规则，不可缺省。 |
| 车载终端设备软件版本号长度 | swVersionLeng th       | BYTE       | [0..255]，描述车载终端设备软件版本号的字 节长度，255 表示未获取版本号，不发送车辆 软件版本字段 |
| 车辆软件版本               | swVersion              | STRING[N]  | 长度为 N 的字符串，其中 N 为车辆软件版本号 长度              |
| 自动驾驶系统硬件版本号长度 | hwVersionLeng th       | BYTE       | [0..255]，描述自动驾驶系统硬件版本号的字 节长度，255 表示未获取版本号，不发送自动 驾驶系统硬件版本字段 |
| 自动驾驶系统硬件版本       | hwVersion              | STRING[N]  | 实现自动驾驶功能的相关硬件型号，长度为 N，其中 N 为自动驾驶系统硬件版本号长度 |
| 自动驾驶系统软件版本号长度 | adVersionLeng th       | BYTE       | [0..255]，描述自动驾驶系统软件版本号的字 节长度，255 表示未获取版本号，不发送自动 驾驶系统软件版本号字段 |
| 自动驾驶系统软件版本号     | adVersion              | STRING[N]  | 长度为 N 的字符串，其中 N 值为自动驾驶车辆 软件版本号长度    |
| 无线通讯类型               | comType                | BYTE       | 枚举类型：[0..3]，0：4g；1：5g；2： DSRC；3：其他；255：缺省 |
| 定位精度                   | posConfidence          | BYTE       | 枚举类型，取值见表 D.1 位置及高程精度等级                    |
| 时间同步方式               | timeSync               | BYTE       | 枚举类型：[0..5]，0：未知，1：PTP；2： GNSS；3：局域网 NTP 时钟同步；4：互联网 NTP 时钟同步；5：其他同步方式；255：缺省 |
| 坐标系类型                 | gnssType               | BYTE       | 枚举类型：[0..3]，0：GCJ02 坐标系；1： CGCS2000 坐标系；2：WGS84 坐标系；3：自定 义坐标系，不可缺省 |
| 自定义字段长度             | userdefinedDa taLength | BYTE       | [0..255]，描述自定义字段长度，255 表示没 有自定义字段，不发送自定义字段内容 |
| 自定义字段内容             | userdefinedDa ta       | STRING[N]  | 自定义数据字段，长度为 N，其中 N 为自定义 字段长度           |

车端准静态参数信息返回（CLOUD2VEH_INH_RES）数据结构见表 7。

| 项目     | 字段名称 | 元数据类型 | 描述                                                         |
| -------- | -------- | ---------- | ------------------------------------------------------------ |
| 消息标识 | seq      | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中seq，不可缺省 |
| 结果     | res      | BYTE       | 枚举类型：[0..2]，0：确认；1：失败；2：消息有误；3，不支持，不可缺省 |

## 8.4 车辆运行状态信息

车辆运行状态信息报文定义如下。

——报文名称：车辆运行状态信息 VEH2CLOUD_STATE（8.4 中称 STATE）

——数据通道：数据上报通道——数据类别：21（0x15）

——版本号：0x01~0x10 

——数据定义：描述车辆在运行状态下驾驶状态的数据，如车速、航向等。

——业务功能：将车辆运行中车辆当前运行状态数据上报云端。

### 8.4.1 传输行为

无前提条件。车端通过数据上传通道按车辆运行状态以固定频率发送 STATE 数据。云端通过数据上传通道接收并按照定义的数据协议解析的 STATE 数据。

### 8.4.2 异常处理

云端接收数据超时未收到，云端记录异常日志，车端不补发，云端可断开连接。

数据格式错误、数据字段值异常，云端记录异常日志。

当数据通信链路异常时，车端应将实时上报数据进行本地存储。在数据通信链路恢复正常后，在发送实时上报数据的空闲时间完成补发存储的上报数据。

补发的上报数据应为三日内通信链路异常期间存储的数据，数据格式与实时上报数据相同，并通过版本号标识为补发信息上报（0x10）。

### 8.4.3 数据结构及定义

按照需求，VEH2CLOUD_STATE 可根据所需的云端服务内容选择不同数据项集合的版本发送，云端服务内容包括实时决策建议类、实时控制建议及远程控制类、以及辅助功能类，不同版本号发送的数据项集合见表 8，可选择的数据项集合包括车辆基础信息、驾驶辅助系统信息以及自动驾驶信息信息。

| 版本号 | 数据项内容  |
| ------ | ----------- |
| 0x01   | 表9         |
| 0x02   | 表9表10     |
| 0x03   | 表9表11     |
| 0x04   | 表9表10表11 |

车辆基础信息、车辆其他信息与驾驶辅助系统信息及自动驾驶系统信息的数据结构技定义见表 9-表 11。

当车辆请求辅助类功能时，发送的数据项版本应为 0x01 及以上，当车辆请求实时决策建议类功能时，发送的数据项版本应为 0x02 及以上，当车辆请求实时控制建议及远程控制类功能时，发的数据项版本应为 0x03 及以上。

| 项目            | 字段名称        | 元数据类型   | 描述                                                         |
| --------------- | --------------- | ------------ | ------------------------------------------------------------ |
| 车辆编号        | vehicleId       | STRING[8]    | 长度为 8 位的字符串，该车辆编号必须在云控 基础平台中进行登记/注册，车辆编号定义可 参考附录 B vehicleId 编码规则，不可缺省。 |
| 消息编号        | messageId       | WORD         | 车辆状态信息编号，为[1..10000]间的自增序 列，超过 10000 后，重新从 1 开始计数，不可 缺省 |
| GNSS 时间戳     | timestampGNSS   | TIMESTAMP    | GNSS 数据中的时间戳，单位：ms，需要进行 转换为东八区 UTC 时间戳，不可缺省， 0xFFFFFFFFFFFFFFFF 表示异常 |
| GNSS 速度       | velocityGNSS    | WORD         | [0..20000]，GNSS 数据中的行驶速度，单 位：0.01m/s，不可缺省，65535 表示异常 |
| 位置            | position        | POSITION     | 车辆的经纬度及高程信息，详细定义见表 3 结构体类元数据类型定义表 |
| 航向角          | heading         | UNSIGNED INT | [0..3600000]，正北方向顺时针旋转至与车辆 当前车头指向方向重合所转过的角度，单位为 1e-4°，不可缺省，0xFFFFFFFF 表示异常 |
| 档位            | tapPos          | BYTE         | 枚举类型：[0..255]，0：数据失效； [1..20]：表示手动档车辆前进档对应档位，1 表示 1 档，2 表示 2 档，以此类推； [21..30]：表示手动挡车辆倒档对应档位，21 表示 R1 档，22 表示 R2 档，以此类推；31：D 档（前进档）；32：R 档（倒档）；33：P 档 （驻车档）；34：N 档（空档）；35：S 档 （运动模式）；36：L 档（低速档）；不可缺 省，255 表示异常 |
| 方向盘转角      | steeringAngle   | INT          | [-10000000..10000000]，方向盘转角，左正 右负，单位：1e-4°，0xFFFFFFFF 表示缺省 |
| 当前车速        | velocityCAN     | WORD         | [0..20000]，CAN 总线数据中的行驶速度，单 位：0.01m/s，65535 表示缺省 |
| 纵向加速度      | accelerationLon | WORD         | [0..20000]，车辆行驶纵向加速度，单位： 0.01m/s 2，offset = -100，表示实际值[- 100..100]，65535 表示缺省 |
| 横向加速度      | accelerationLat | WORD         | [0..20000]，车辆行驶横向加速度，单位： 0.01m/s 2，offset = -100，表示实际值[- 100..100]，左正右负，65535 表示缺省 |
| 垂向加速度      | accelerationVer | WORD         | [0..20000]，车辆行驶垂向加速度，单位： 0.01m/s 2，offset = -100，表示实际值[- 100..100]，左正右负，65535 表示缺省 |
| 横摆角速度      | yawRate         | WORD         | [0..20000]，横摆角速度，单位：0.01°/s， offset = -100，表示实际值[-100..100]， 65535 表示缺省 |
| 油门开度        | accelPos        | WORD         | [0..1000]，加速踏板开度，单位：0.1%， 65535 表示缺省         |
| 发动机输出转 速 | engineSpeed     | INT          | [-20000..20000]，发动机输出转速，单位： rpm，0xFFFFFFFF 表示缺省 |
| 发动机扭矩      | engineTorque    | INT          | -500000，500000]，发动机输出扭矩，单 位：0.01Nm，0xFFFFFFFF 表示缺省 |
| 制动踏板开关    | brakeFlag       | BYTE         | [0..1]，制动踏板是否踩下，0：未踩下，1： 踩下，255 表示缺省  |
| 制动踏板开度    | brakePos        | WORD         | [0..1000]，制动踏板开度，单位：0.1%， 65535 表示缺省         |
| 制动主缸压力    | brakePressure   | WORD         | [0..50000]，主缸制动压力，单位 0.01MPa,，65535 表示缺省      |
| 油耗            | fuelConsumption | WORD         | [0..65534]，车辆运行百公里油耗，单位 0.01L/100km，表示实际值[0..655.34]， 65535 表示缺省 |
| 车辆驾驶模式    | driveMode       | BYTE         | 枚举类型：[0..255]，1：人工接管（人工驾 驶）；2：单车自控（自动驾驶）；3：云端支 持下的人工驾驶；4：云端支持下的自动驾 驶；5：非主驾位置人工驾驶（不启用）；6： 脱离（非 AD 行程自动结束下的接管）；7：远 程驾驶（非现场人工驾驶）；8：未处于任何 驾驶模式；9：其他未定义状态；255：缺省 |
| 目的地位置      | destLocation    | POSITION2D   | 车辆当前驾驶任务的终点位置，POSITION2D 中经度或维度为异常值时，表示未获取到目的 地位置 |

表10 车辆辅助驾驶系统信息及其他状态信息数据结构

| 项目              | 字段名称               | 元数据类型 | 描述                                                         |
| ----------------- | ---------------------- | ---------- | ------------------------------------------------------------ |
| ABS状态           | absFlag                | BYTE       | 枚举类型：[0..2]，ABS 触发状态，0：ABS 未 激活；1：ABS 激活；2：ABS 功能异常；255： 缺省 |
| TCS状态           | tcsFlag                | BYTE       | 枚举类型：[0..2]，TCS 触发状态，0：TCS 未 激活；1：TCS 激活；2：TCS 功能异常；255： 缺省 |
| ESP状态           | espFlag                | BYTE       | 枚举类型：[0..2]，ESP 触发状态，0：ESP 未 激活；1：ESP 激活；2：ESP 功能异常；255： 缺省 |
| LKA状态           | lkaFlag                | BYTE       | 枚举类型：[0..3]，LKA 触发状态，0：LKA 关 闭；1：LKA 待机；2：LKA 激活；3：LKA 功能异 常；255：缺省 |
| ACC工作模式       | accMode                | BYTE       | 枚举类型：[0..7]，ACC 工作模式，0：ACC 关 闭；1：ACC 待机；2：ACC 速度控制；3：ACC 时 距控制；4：超控；5：ACC 功能异常；255：缺 省 |
| FCW状态           | fcwFlag                | BYTE       | 枚举类型：[0..2]，FCW 触发状态，0：FCW 未 激活；1：FCW 激活；2：FCW 功能异常；255： 缺省 |
| LDW状态           | ldwFlag                | BYTE       | 枚举类型：[0..2]，LDW 触发状态，0：LDW 未 激活；1：LDW 激活；2：LDW 功能异常；255： 缺省 |
| AEB状态           | aebFlag                | BYTE       | 枚举类型：[0..2]，AEB 触发状态，0：AEB 未 激活；1：AEB 激活；2：AEB 功能异常；255： 缺省 |
| LCA状态           | lcaFlag                | BYTE       | 枚举类型：[0..2]，LCA 触发状态，0：LCA 未 激活；1：LCA 激活；255：缺省 |
| DMS状态           | dmsFlag                | BYTE       | 枚举类型：[0..2]，DMS 触发状态，0：DMS 未 激活；1：DMS 激活；2：DMS 功能异常；255： 缺省 |
| 里程              | mileage                | INT        | [0..10000000]，对应车辆里程表读数，单位： 0.1km，0xFFFFFFFF 表示缺省 |
| 油量              | fuelGauge              | WORD       | [0..10000]，对应车辆油量表读数，单位： 0.1L，65535 表示缺省  |
| 电池剩余电量      | soc                    | WORD       | [0..10000]，单位：0.01%，65535 表示缺省                      |
| 电池温度          | temperature            | INT        | [-100，100]单位：摄氏度（℃）， 0xFFFFFFFF 表示缺省           |
| 预计续航里程      | endurance              | INT        | [0，500000]，单位：千米（km），0xFFFFFFFF 表示缺省           |
| 车辆故障状态      | vehFault               | INT        | 按位定义，见表 12 车辆系统故障字段详细定义                   |
| 电机转速          | motorspeed             | INT        | [-20000..20000]，电机输出转速，单位： rpm，0xFFFFFFFF 表示缺省 |
| 电机转矩          | motortorque            | INT        | [-500000，500000]，电机输出扭矩，单位： 0.01Nm，0xFFFFFFFF 表示缺省 |
| 运行模式          | vehMode                | BYTE       | 枚举类型：[1..6]，车辆运行模式，1：纯电驱 动模式；2：混合驱动模式；3：行车充电模 式；4：能量回收模式；5：停车充电模式；6： 能量混合回充模式；255：缺省 |
| 充电状态          | chargeState            | BYTE       | 枚举类型：[1..5]，车辆充电状态，1：未充 电；2：充电准备；3：正在充电；4：充电故 障；5：充电结束；255：缺省 |
| 动力电池实时 电压 | battVol                | INT        | [0..10000]，动力电池总电压，同时也是车辆 的充电电压（当充电枪状态为正在充电时）， 单位：0.1V，0xFFFFFFFF 表示缺省 |
| 动力电池实时 电流 | battCur                | INT        | [-2000..2000]，动力电池总电流，同时也是车 辆充电电流（当充电枪状态为正充电时），单 位：0.01A，offiset=-2000，0xFFFFFFFF 表示 缺省 |
| 喇叭状态          | hornState              | BYTE       | [0..100]，单位（%），255 表示缺省                            |
| 车轮数            | wheelNum               | BYTE       | [0..100]，表示车轮数                                         |
| 轮速              | wheelVelocity          | WORD[N]    | N 个车轮轮速，其中 N 为车轮数 [0..40000]，表示车轮转速，单位：0.01 rps，offset = -200，表示实际值[- 200..200]，65535 表示缺省或未安装轮速传感 器，标定车轮的顺序为从车头开始从左到右顺 序排列，例如：前左 1，前左 2，前右 1，前右 2，中左 1，中左 2，中右 1，中右 2，后左 1， 后左 2，后右 1，后右 2…，以此类推 |
| 胎压              | tirePressure           | WORD[N]    | N 个胎压，其中 N 为车轮数 [0..400]，单位为 kPa，每个车轮的胎压用 1 个 字节表示，标定车轮的顺序为从车头开始从左 到右顺序排列，例如：前左 1，前左 2，前右 1，前右 2，中左 1，中左 2，中右 1，中右 2， 后左 1，后左 2，后右 1，后右 2…，以此类推 |
| 车灯状态          | Lighs                  | WORD       | 按位定义，见表 14 车灯字段详细定义                           |
| 车门状态          | doors                  | WORD       | 按位定义，见表 15 车门字段详细定义                           |
| 自定义字段长 度   | userdefinedDa taLength | BYTE       | [0..255]，描述自定义字段长度，255 表示没有 自定义字段，不发送自定义字段内容 |
| 自定义字段内 容   | userdefinedDa ta       | STRING[N]  | 自定义数据字段，长度为 N，其中 N 为自定义字 段长度           |

表11 自动驾驶系统信息数据结构

| 项目                  | 字段名称               | 元数据类型    | 描述                                                         |
| --------------------- | ---------------------- | ------------- | ------------------------------------------------------------ |
| 执行云端控制 命令编号 | cloudMessageI d        | UNSIGNED INT  | 车辆当前执行云端控制指令编号，为 [1..10000]间的自增序列，超过 10000 后重新 从 1 开始计数不可缺省 |
| 自动驾驶需求 加速度   | accelCmd               | WORD          | [0..20000]，自动驾驶模式纵向加速度需求， 单位：0.01m/s 2，offset=-100，表示实际值[- 100..100]，65535 表示缺省 |
| 自动驾驶需求 扭矩     | torqueCmd              | INT           | [-500000，500000]，自动驾驶模式扭矩需求， 单位：0.01Nm，0xFFFFFFFF 表示缺省 |
| 自动驾驶需求 速度     | velocityCmd            | WORD          | [0..20000]，自动加速模式速度需求，单位： 0.01m/s，65535 表示缺省 |
| 规划-位置点轨 迹数量  | planningLocNu m        | WORD          | [0..65535]，描述车辆路径规划行驶路径的位 置点轨迹数量，65535 表示缺省 |
| 规划-位置点轨 迹列表  | planningLocs           | TRACEPOINT[N] | N 个目标位置点轨迹，其中 N 为规划-位置点轨 迹数量            |
| 决策-换道             | decisionLaneC hange    | BYTE          | 枚举类型：[0..2]，0：直行；1：向左换道； 2：向右换道；255：缺省 |
| 加减速                | decisionAccel          | BYTE          | 枚举类型：[0..2]，0：匀速；1：加速；2：减 速；255：缺省      |
| 决策-转向             | decisionTurnS ignal    | BYTE          | 枚举类型：[0..8]，0：直行；1：第一出口； 2：第二出口；3：第三出口；4：第四出口； 5：第五出口；6：第六出口；7：第七出口； 8：第八出口；255：缺省 出口定义从当前道路逆时针算起 |
| 决策-车辆状态         | decisionVehic leStatus | BYTE          | 枚举类型：[0..4]，0：人工驾驶；1：巡航； 2：跟车；3：停车；4：起步；255：缺省 |
| 车端感知目标 数量     | detectionNum           | WORD          | [0..10000]，表示车端感知目标数量，65535 表 示缺省或未获取到感知目标，不发送感知目标 数据 |
| 感知目标数据          | detectionData          | 90N           | N 组车端感知数据，其中 N 为车端感知目标数 量，车端上报的感知结果明细定义，见表 63 目 标信息数据格式定义 |
| 自动驾驶系统 故障     | AutoDrivingSy sFault   | WORD          | 按位定义，见表 13 自动驾驶系统故障字段详细 定义              |
| 电子手刹状态          | EPB                    | BYTE          | 枚举类型：[1..3]，手刹状态，1：释放；2： 驻车；3：故障；255：缺省 |
| 自定义字段长 度       | userdefinedDa taLength | BYTE          | [0..255]，描述自定义字段长度，255 表示没有 自定义字段        |
| 自定义字段内 容       | userdefinedDa ta       | STRING[N]     | 自定义数据字段，长度为 N，其中 N 为自定义字 段长度，表 16 给出一种自定义内容的实现方式 |

表13 车辆系统故障字段详细定义

| 比特位 | 功能             | 备注                                                      |
| ------ | ---------------- | --------------------------------------------------------- |
| BIT0   | 电池系统故障     | 0：无故障；1：故障                                        |
| BIT1   | 电机系统故障     | 0：无故障；1：故障                                        |
| BIT2   | 发动机故障       | 0：无故障；1：故障                                        |
| BIT3   | 制动液液位低     | 0：无故障；1：故障                                        |
| BIT4   | 蓄电池电压低     | 0：无故障；1：故障                                        |
| BIT5   | 胎压报警         | 0：无故障；1：故障                                        |
| BIT6   | 动力电池故障报警 | 0：无故障；1：故障                                        |
| BIT15  | 有效位           | 0：有效；1：车辆系统故障状态字段全部无效（或未 获取数据） |

表13 自动驾驶系统故障字段详细定义

| 比特位 | 功能                 | 备注                                                         |
| ------ | -------------------- | ------------------------------------------------------------ |
| BIT0   | GNSS 信号故障        | 0：无故障；1：故障                                           |
| BIT1   | CAN 总线接口断开     | 0：无故障；1：故障                                           |
| BIT2   | 车载以太网故障       | 0：无故障；1：故障                                           |
| BIT3   | 传感器数据异常       | 0：无故障；1：故障                                           |
| BIT4   | 自动驾驶计算平台异常 | 0：无故障；1：故障                                           |
| BIT5   | 决策功能异常         | 0：无故障；1：故障                                           |
| BIT6   | 规划功能异常         | 0：无故障；1：故障                                           |
| BIT7   | 纵向控制异常         | 0：无故障；1：故障                                           |
| BIT8   | 横向控制异常         | 0：无故障；1：故障                                           |
| BIT15  | 有效位               | 0：有效；1：自动驾驶系统故障状态字段全部无效（或未获取数 据） |

表14 车灯字段详细定义

| 比特位      | 功能         | 备注                                                         |
| ----------- | ------------ | ------------------------------------------------------------ |
| BIT0        | 近光灯       | 0：关闭；1：打开                                             |
| BIT1        | 远光灯       | 0：关闭；1：打开                                             |
| BIT2        | 左转灯       | 0：关闭；1：打开                                             |
| BIT3        | 右转灯       | 0：关闭；1：打开                                             |
| BIT4        | 双闪灯       | 0：关闭；1：打开                                             |
| BIT5        | 自动灯光控制 | 0：关闭；1：打开                                             |
| BIT6        | 日间行车灯   | 0：关闭；1：打开                                             |
| BIT7        | 前雾灯       | 0：关闭；1：打开                                             |
| BIT8        | 后雾灯       | 0：关闭；1：打开                                             |
| BIT9        | 驻车灯       | 0：关闭；1：打开                                             |
| BIT10       | 示廓灯       | 0：关闭；1：打开                                             |
| BIT11       | 倒车灯       | 0：关闭；1：打开                                             |
| BIT12       | 刹车灯       | 0：关闭；1：打开                                             |
| BIT14~BIT15 | 有效位       | 0：有效；1：自动驾驶系统故障状态字段全部无效（或未获取数 据） |

表15 车门字段详细定义

| 比特位      | 功能   | 备注                                                         |
| ----------- | ------ | ------------------------------------------------------------ |
| BIT0        | 引擎盖 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT1        | 左前门 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT2        | 右前门 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT3        | 左后门 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT4        | 右后门 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT5        | 后备箱 | 0：关闭；1：打开（适用于普通汽车）                           |
| BIT6        | 前门   | 0：关闭；1：打开（适用于商用客车）                           |
| BIT7        | 中门   | 0：关闭；1：打开（适用于商用客车）                           |
| BIT8        | 后门   | 0：关闭；1：打开（适用于商用客车）                           |
| BIT14~BIT15 | 有效位 | 0：有效；1：普通汽车， 2：商用客车，3：车门状态字段全部无效（或未获取 数据） |

表16 自动驾驶自定义功能详细定义

| 比特位 | 功能                              | 备注                                                  |
| ------ | --------------------------------- | ----------------------------------------------------- |
| BIT0   | 自动驾驶，驶出地图区域            | 0：在区域内；1：驶出区域                              |
| BIT1   | 车辆停车点停稳标志位              | 0：无效；1：有效                                      |
| BIT2   | 停车停稳回馈属性 （红绿灯停车点） | 0：无效；1：有效                                      |
| BIT3   | 停车停稳回馈属性 （约车停车点）   | 0：无效；1：有效                                      |
| BIT4   | 停车停稳回馈属性 （事件停车点）   | 0：无效；1：有效                                      |
| BIT15  | 有效位                            | 0：有效；1：车辆故障状态字段全部无效（或未获 取数据） |

## 8.5 功能订阅信息

功能订阅信息报文定义如下。

——报文名称：功能订阅信息 VEH2CLOUD_SUBS（8.5 中称 SUBS）功能订阅信息返回CLOUD2VEH_SUBS_RES（8.5 中称 SUBS_RES）

——数据通道：数据上报通道

——数据类别：SUBS——0x36，SUBS_RES——0x37 

——版本号：0x01 

——数据定义：描述车端向云端订阅指定功能的信息

——业务功能：车端根据需求向云端订阅指定功能，实现云端服务的订阅与取消功能

### 8.5.1 传输行为

无前提条件。车端根据场景需求或者用户需求向云端发送订阅指定功能信息。发出订阅信息后超过预定时间未收到回复，重新发送该信息，连续三次未收到返回，认为连接异常。预定时间可根据场景对时延需求来确定，如 500ms。云端在收到车端的功能订阅信息后返回。

### 8.5.2 异常处理

当车端认为连接异常时，主动断开连接。

### 8.5.3 数据结构及定义

功能订阅信息（VEH2CLOUD_SUBS）数据结构见表 17。

| 项目             | 字段名称      | 元数据类型 | 描述                                                         |
| ---------------- | ------------- | ---------- | ------------------------------------------------------------ |
| 车辆编号         | vehicleId     | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控 基础平台中进行登记/注册，车辆编号定义可参 考附录 B vehicleId 编码规则，不可缺省。 |
| 功能订阅信息长度 | subsLen       | BYTE       | [0..255]，表示功能订阅信息的字节数                           |
| 功能订阅         | funcSubscribe | BYTE[n]    | 按位定义，见表 18 功能订阅字段详细定义，对 于每一比特位，0：不订阅该功能；1：订阅该 功能 *紧接着 subsLen 的第一个字节是 BYTE[0],下一 个是字节是 BYTE[1]，以此类推待扩展 |

功能订阅字段的详细定义如表 18 所示，其中 BTYE[0-1]为实时决策建议类功能，BYTE[2]为实时控制建议类功能，BYTE[3]为辅助功能类功能。

![image-20221021221828547](https://img-blog.csdnimg.cn/img_convert/fbb4145cf5f8f6dde832671ae856ed06.png)

![image-20221021221834626](https://img-blog.csdnimg.cn/img_convert/c0e6517b51f3cbaecb9ace647fb4b832.png)

改变功能订阅信息长度可扩充功能订阅字段的功能列表，支持订阅云端更多功能，可用版本号区分。功能列表需按其他方式实现云端和车端的同步，如静态配置。

功能订阅信息返回（VEH2CLOUD_SUBS_RES）数据结构如表 19 所示。

| 项目              | 字段名称 | 元数据类型 | 描述                                                         |
| ----------------- | -------- | ---------- | ------------------------------------------------------------ |
| 功能订阅回复长度  | resLen   | BYTE       | [0..255]，表示功能订阅回复字段的字节数                       |
| 功能订阅回复 状态 | funcRes  | BYTE[n]    | 按位定义，见表 18 功能订阅字段详细定义，对 于每一比特位，0：该功能订阅失败或未订阅； 1：该功能订阅成功 *紧接着 resLen 的第一个字节是 BYTE[0],下一 个是字节是 BYTE[1]，以此类推待扩展 |

## 8.6 实时决策建议

实时决策建议报文定义如下。

——报文名称：实时决策建议 CLOUD2VEH_ADVICE（8.6 中称 ADVICE）；实时决策建议

返回 VEH2CLOUD_ADVICE_RES（8.6 中称 ADVICE_RES）

——数据通道：指令下发通道

——数据类别：ADVICE——0x3C，ADVICE_RES——0x3D 

——版本号：0x01 

——数据定义：云端根据车端的功能请求或用户操作，将实时决策建议下发给车端

——目的：根据功能向车辆传递实时决策建议，车辆根据自身状态做最终判断，执行实时决策建议

### 8.6.1 传输行为

传输的前提条件是车端请求指定功能或用户操作实现指定功能。

车端接收 ADVICE 实时决策建议并返回 ADVICE_RES 实时决策建议返回信息。云端根据功能请求下发 ADVICE 给指定车辆，超时预定时间未收到 RES，则记录异常日志，重新发送，连续 3 次失败后，认为连接异常。预定时间根据场景对时延要求确定，如 1s。

### 8.6.2 异常处理

云端下发后 3s 未收到返回，则记录异常日志，重发；连续三次未收到返回，则认为指令失败，记录异常日志。

当车端认为连接异常时，主动断开连接。

### 8.6.3 数据结构及定义

实时决策建议数据结构见表 20。

| 项目     | 字段名称   | 元数据类型 | 描述                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 车辆编号 | vehicleId  | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控 基础平台中进行登记/注册，车辆编号定义可参 考附录 B vehicleId 编码规则，不可缺省。 |
| 命令长度 | dataLen    | WORD       | [0..65535]，不可缺省                                         |
| 命令数据 | adviceData | BYTE[n]    | 长度由 dataLen 定义，数据定义见 8.6.5- 8.6.14                |

### 8.6.4 决策建议指令功能定义

实时决策建议共有 10 类功能，其功能列表见表 21。

![image-20221021221942284](https://img-blog.csdnimg.cn/img_convert/a3cdc33e5de426a17fb9a2a2cf070839.png)

### 8.6.5 信号灯路口车速引导功能指令及返回

#### 8.6.5.1 应用场景

车端请求信号灯路口车速引导功能。

#### 8.6.5.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_GLOSA 信号灯路口车速引导功能速度建议，车端返回执行状态 VEH2CLOUD_ADVICE_GLOSA_RES。

#### 8.6.5.3 数据结构

信号灯路口车速引导功能（CLOUD2VEH_ADVICE_GLOSA）数据结构见表 22。

![image-20221021222354854](https://img-blog.csdnimg.cn/img_convert/c76d36bced927d46dc582690ff4fe6aa.png)

信号灯路口车速引导功能返回（VEH2CLOUD_ADVICE_GLOSA _RES）数据结构见表 23。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 2                                                   |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.6 无信号灯路口右转功能指令及返回

#### 8.6.6.1 应用场景

车端请求无信号灯路口右转功能。

#### 8.6.6.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_NTLAR 无信号灯右转建议，车端返回执行状态 VEH2CLOUD_ADVICE_NTLAR_RES。

#### 8.6.6.3 数据结构

无信号灯路口右转功能（CLOUD2VEH_ADVICE_NTLAR）数据结构见表 24。

表24 无信号灯路口右转功能数据结构

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 3                                                   |
| 事件     | uuid       | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一个车辆在范围内触发，同一 uuid |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 建议标志 | adviceFlag | BYTE       | 枚举类型：[0..3]，0：失效；1：正常通过； 2：减速；3：停车    |
| 报警等级 | level      | BYTE       | 枚举类型：[0..3]，0：失效；1：1 级；2：2 级；3：3 级；255：缺省 |

无信号灯路口右转功能返回（VEH2CLOUD_ADVICE_NTLAR_RES）数据结构见表 25。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 4                                                   |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.7 动态车道级限速指令及返回

#### 8.6.7.1 应用场景

车端请求动态车道级限速功能。

#### 8.6.7.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_LANESPDLMT 动态车道级限速功能数据，车端返回执行状态 VEH2CLOUD_ADVICE_LANESPDLMT_RES。

#### 8.6.7.3 数据结构

动态车道级限速功能（CLOUD2VEH_ADVICE_LANESPDLMT）数据结构见表 26。

| 项目       | 字段名称    | 元数据类型    | 备注                                                         |
| ---------- | ----------- | ------------- | ------------------------------------------------------------ |
| 建议类型   | adviceType  | BYTE          | 固定值为 5                                                   |
| 事件       | uuid        | STRING[36]    | 一组固定长度为 36 位的字符串，UTF-8 编码，标识命令唯一编号； 一次结果一个 uuid |
| 消息标识   | seq         | BYTE[8]       | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识，以 确认对应消息的接收 |
| 告警类型   | alertType   | WORD          | 固定值为 5517，用于匹配 RSI                                  |
| 告警半径   | alertRadius | WORD          | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量 | pointNum    | BYTE          | [0..31]，描述告警路径中路径点数量                            |
| 告警路径   | alertPath   | TRACEPOINT    | N 个路径点，其中 N 为路径点数量。触发此次预 警的目标交通参与物的经纬度，如果传递一个点 则生成 RSI 时改为两个一样的点，如果未传递， 则生成 RSI 时填入两个默认零点 |
| 车道数量   | laneNum     | BYTE          | 当前道路上包含的车道数量                                     |
| 限速数据   | speedLmt    | SPEEDLIMIT[N] | N 个限速信息，其中 N 为车道数量                              |

动态车道级限速功能回（VEH2CLOUD_ADVICE_LANESPDLMT_RES）数据结构见表 27。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 6                                                   |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.8 匝道汇回预警指令及返回

#### 8.6.8.1 应用场景

车端请求匝道汇回预警功能，即对从出主路匝道驶回主路的车辆进行预警。

#### 8.6.8.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_RAMP_INTENT_CHANGE 匝道汇回预警功能数据，车端返回执行状态 VEH2CLOUD_ADVICE_RAMP_INTENT_ CHANGE_RES。

#### 8.6.8.3 数据结构

匝道汇回预警（CLOUD2VEH_ADVICE_RAMP_INTENT_CHANGE）数据结构见表 28。

| 项目              | 字段名称    | 元数据类型 | 备注                                                         |
| ----------------- | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型          | adviceType  | BYTE       | 固定值为7                                                    |
| 事件唯一标识      | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一汇回车同一 uuid |
| 消息标识          | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型          | alertType   | WORD       | 固定值为 5514，用于匹配 RSI                                  |
| 告警半径          | alertRadius | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量        | pointNum    | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径          | alertPath   | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点[0,0,0] |
| 到达冲突点的 距离 | dtc         | WORD       | [0..65535]，自车到达冲突点的距离，单位： cm；65535 表示缺省  |
| 到达冲突点时 间   | ttc         | WORD       | [0..65535]，自车到达冲突点的时距，单位： 0.01s；65535 表示缺省 |

匝道汇回预警返回（VEH2CLOUD_ADVICE_RAMP_INTENT_CHANGE_RES）数据结构见表 29。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 8                                                   |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.9 前向碰撞预警指令及返回

#### 8.6.9.1 应用场景

车端请求前向碰撞预警功能。

#### 8.6.9.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_FCW 前向碰撞预警功能数据，车端返回执行状态 VEH2CLOUD_ADVICE_FCW_RES。

#### 8.6.9.3 数据结构

前向碰撞预警（CLOUD2VEH_ADVICE_FCW）数据结构见表 30。

| 项目                  | 字段名称    | 元数据类型 | 备注                                                         |
| --------------------- | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型              | adviceType  | BYTE       | 固定值为9                                                    |
| 事件唯一标识          | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid 可自行确认选择生成方式，如 v1 |
| 消息标识              | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型              | alertType   | WORD       | 固定值为 6518，用于匹配 RSI                                  |
| 告警半径              | alertRadius | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量            | pointNum    | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径              | alertPath   | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点。 |
| 碰撞预警目标 类型     | objType     | BYTE       | 枚举类型：[0..255]，详细定义见表 C.2 目标 类型定义列表，255 表示缺省，缺省则告警功能 失效 |
| 碰撞告警类型          | fcwLevel    | BYTE       | 枚举类型：[0..255]，0：失效；1：1 级告警； 2：2 级告警；255：缺省，缺省则告警功能失效 |
| 碰撞距离              | fcwDistance | WORD       | [0..65535]，主车到碰撞预警目标（行人、非 机动车、车辆）的距离，单位：cm，65535,表 示缺省 |
| 碰撞预警目标 所在车道 | fcwLaneId   | BYTE       | [0.255]，碰撞预警车辆所在车道的 laneId，0 表示未能匹配车道; 道路上车道局部编号，从内侧车道向外侧车道 从 1 开始依次递增编号 |

前向碰撞预警返回（VEH2CLOUD_ADVICE_FCW_RES）数据结构见表 31。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 10                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.10 通用 RSI 预警指令及返回

#### 8.6.10.1 应用场景

车端请求通用 RSI 预警指令。通用 RSI 包含交通拥堵（alertType=5509）、弱势交通参与者提醒（alertType=5501，5502）、事故高发路段提醒（alertType=34）等，可根据附录E 规定的 RSI 事件进行扩展。

#### 8.6.10.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_COM_RSI 预警指令，车端返回执行状态 VEH2CLOUD_ADVICE_COM_RSI_RES。

#### 8.6.10.3 数据结构

通用 RSI 预警（CLOUD2VEH_ADVICE_COM_RSI）数据结构见表 32。

| 项目         | 字段名称      | 元数据类型 | 备注                                                         |
| ------------ | ------------- | ---------- | ------------------------------------------------------------ |
| 建议类型     | adviceType    | BYTE       | 固定值为11                                                   |
| 事件唯一标识 | uuid          | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid |
| 消息标识     | seq           | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型     | alertType     | WORD       | 枚举类型，用于匹配 RSI，交通标识应符合 GB 5768.2-2009，交通事件应符合 GB/T 29100- 2012，具体取值可参考附录 E |
| 告警半径     | alertRadius   | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量   | pointNum      | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径     | alertPath     | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点。 |
| 告警距离     | alertDistance | WORD       | 告警点与车辆的距离                                           |
| 事件分类     | contentType   | BYTE       | 枚举类型：[0..255]，255 表示 NULL； 取值及具体定义见表 33，NULL 表示该事件无需 分类。如数据无效，则云端不发给车端。 |

通用 RSI 预警中事件分类中 contentType 的定义见表 33。

| alertType | contentType定义                                   |
| --------- | ------------------------------------------------- |
| 5501      | 0：失效；1：行人横穿马路；2：行人穿行高速         |
| 5502      | 0：失效；1：非机动车横穿马路；2：非机动车穿行高速 |

通用 RSI 预警返回（CLOUD2VEH_ADVICE_COM_RSI_RES）数据结构见表 34。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 12                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.11 异常车辆预警指令及返回

#### 8.6.11.1 应用场景

车端请求异常车辆预警指令。包含紧急制动预警（alertType=5503）、逆行预警（alertType=5505）、异常低速（alertType=5506）、异常停车（alertType=5507）、超速提醒（alertType=5508），可根据附录 E 规定的 RSI 事件进行扩展。

#### 8.6.11.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_AVW 预警指令，车端返回执行状态VEH2CLOUD_ADVICE_AVW_RES。

#### 8.6.11.3 数据结构

异常车辆预警（CLOUD2VEH_ADVICE_AVW）数据结构见表 35。

| 项目         | 字段名称    | 元数据类型 | 备注                                                         |
| ------------ | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型     | adviceType  | BYTE       | 固定值为13                                                   |
| 事件唯一标识 | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid |
| 消息标识     | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型     | alertType   | WORD       | 枚举类型，用于匹配 RSI，取值和定义可参考附 录 E RSI 事件类型（alertType）数据格式和定 义 |
| 告警半径     | alertRadius | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量   | pointNum    | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径     | alertPath   | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点。 |
| 车速         | velocity    | WORD       | [0..20000]，车辆行驶速度，单位：0.01m/s， 65535 表示缺省     |
| 航向角       | heading     | INT        | [0..3600000]，正北方向顺时针旋转至与车辆 当前车头指向方向重合所转过的角度，单位为 1e-4°，0xFFFFFFFF 表示缺 |

异常车辆预警返回（VEH2CLOUD_ADVICE_AVW_RES）数据结构见表 36。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 14                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.12 紧急车辆预警指令及返回

#### 8.6.12.1 应用场景

车端请求紧急车辆预警指令。包含紧急车辆（alertType=5511），可根据附录 E 规定的RSI 事件进行扩展。

#### 8.6.12.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_EVW 预警指令，车端返回执行状态VEH2CLOUD_ADVICE_EVW_RES。

#### 8.6.12.3 数据结构

紧急车辆预警（CLOUD2VEH_ADVICE_EVW）数据结构见表 37。

| 项目         | 字段名称    | 元数据类型 | 备注                                                         |
| ------------ | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型     | adviceType  | BYTE       | 固定值为15                                                   |
| 事件唯一标识 | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid |
| 消息标识     | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型     | alertType   | WORD       | 用于匹配 RSI                                                 |
| 告警半径     | alertRadius | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量   | pointNum    | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径     | alertPath   | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点。 |
| 车辆类型     | type        | BYTE       | 枚举类型：[0..3]，0：失效；1：救护车；2： 警车；3：消防车；255：缺省；其他：预留 |
| 车速         | velocity    | WORD       | [0..20000]，车辆行驶速度，单位：0.01m/s， 65535 表示缺省     |
| 航向角       | heading     | INT        | [0..3600000]，正北方向顺时针旋转至与车辆 当前车头指向方向重合所转过的角度，单位为 1e-4°，0xFFFFFFFF 表示缺 |

紧急车辆预警（VEH2CLOUD_ADVICE_EVW_RES）数据结构见表 38。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 16                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.13 匝道辅助功能指令及返回

#### 8.6.13.1 应用场景

车端请求匝道辅助功能，用于车辆从匝道或主路通过驶入主路的匝道路段。

#### 8.6.13.2 行为

云端按照一定频率向车端下发 CLOUD2VEH_ADVICE_RAMP_ASSIST 指令，车端返回执行状态 VEH2CLOUD_ADVICE_RAMP_ASSIST_RES。

#### 8.6.13.3 数据结构

匝道辅助功能（CLOUD2VEH_ADVICE_RAMP_ASSIST）数据结构见表 39。

| 项目         | 字段名称    | 元数据类型 | 备注                                                         |
| ------------ | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型     | adviceType  | BYTE       | 固定值为17                                                   |
| 事件唯一标识 | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid |
| 消息标识     | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 告警类型     | alertType   | WORD       | 固定值为 6521，用于匹配 RSI                                  |
| 告警半径     | alertRadius | WORD       | [0..1024]，单位：dm，65535 表示缺省                          |
| 路径点数量   | pointNum    | BYTE       | [0..31]，描述告警路径中路径点数量                            |
| 告警路径     | alertPath   | TRACEPOINT | N 个路径点，其中 N 为路径点数量； 触发此次预警的目标交通参与物的经纬度，如 果传递一个点则生成 RSI 时改为两个一样的 点，如果未传递，则生成 RSI 时填入两个默认 零点。 |
| 车速         | velocity    | WORD       | [0..20000]，车辆行驶速度，单位：0.01m/s， 65535 表示缺省     |
| 方向         | direction   | BYTE       | 枚举类型：[0..2]，0：失效；1：左；2：右； 255：缺省 加减速建议时，填缺省 |

匝道辅助功能返回（VEH2CLOUD_ADVICE_RAMP_ASSIST_RES）数据结构见表 40。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 18                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.6.14 路线规划功能指令及返回

#### 8.6.14.1 应用场景

车端请求路线规划功能，内容包括由一系列道路组成的推荐路线、建议车速，行驶目的地。

#### 8.6.14.2 行为

云端下发CLOUD2VEH_ADVICE_GUIDANCE 指 令 ， 车端返回执行状态VEH2CLOUD_ADVICE_GUIDANCE_RES。

#### 8.6.14.3 数据结构

路线规划功能（CLOUD2VEH_ADVICE_GUIDANCE）数据结构见表 41。

| 项目              | 字段名称            | 元数据类型   | 备注                                                         |
| ----------------- | ------------------- | ------------ | ------------------------------------------------------------ |
| 建议类型          | adviceType          | BYTE         | 固定值为19                                                   |
| 事件唯一标识      | uuid                | STRING[36]   | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号； 同一影响目标交通参与物同一 uuid |
| 消息标识          | seq                 | BYTE[8]      | [0..2<sup>64</sup> -1]，云端维护下发消息中消息标识，车 端向云端反馈收到的云端消息中的消息标识， 以确认对应消息的接收 |
| 路线长度          | pathLength          | WORD         | [0..65535]，单位：10m，65535,表示缺省                        |
| 目的地位置        | destLocation        | POSITION2D   | 车辆当前驾驶任务的终点位置，POSITION2D 中 经度或维度为缺省值时，表示未获取到目的地 位置 |
| 目的地停车航 向角 | destinationHe ading | UNSIGNED INT | [0..3600000]，正北方向顺时针旋转至与车辆 当前车头指向方向重合所转过的角度，单位为 1e-4°，0xFFFFFFFF 表示缺省 |
| 道路数量          | roadNum             | BYTE         | [1..255]，路线包含的道路数量                                 |
| 道路序列          | roadName            | STRING[N]    | N 个路线名称，其中 N 为道路数量，每个名称为 一个字符串       |

路线规划功能返回（VEH2CLOUD_ADVICE_RAMP_ASSIST_RES）数据结构见表 42。

| 项目     | 字段名称   | 元数据类型 | 备注                                                         |
| -------- | ---------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | adviceType | BYTE       | 固定值为 20                                                  |
| 消息标识 | seq        | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag     | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

## 8.7 实时控制建议

实时控制建议报文定义如下。

——报文名称：实时控制建议 CLOUD2VEH_INSTRUCT（8.7 中称 INSTRUCT）

——数据通道：指令下发通道

——数据类别：INSTRUCT——30（0x1E）

——版本号：0x01 

——数据定义：云端根据车端的功能请求,将实时车辆控制建议下发给车端

——业务功能：根据订阅的功能向车辆传递实时控制建议，车辆做出最终判断，保证安全前提下执行控制建议。

### 8.7.1 传输行为

传输行为的前提条件是车端请求实时控制建议功能，且云端判断车端数据能够支持实时控制建议功能。车端接收云端控制建议，保证安全前提下执行建议。云端以固定频率向车端发送车辆控制建议。

### 8.7.2 异常处理

当车端认为连接异常时，主动断开连接。

### 8.7.3 数据结构及定义

实时控制建议数据结构见表 43。

![image-20221021224431847](https://img-blog.csdnimg.cn/img_convert/df6c5c74e10051af9e78df495fe1451b.png)

![image-20221021224438675](https://img-blog.csdnimg.cn/img_convert/6589e3e0e1ec8da1418cb84f033e704d.png)

不同控制模式下的控制建议内容的数据结构见表 44-表 45。

![image-20221021224449827](https://img-blog.csdnimg.cn/img_convert/77013b4dee7f27a7aaa43558edc02429.png)

## 8.8 远程控制

远程控制报文定义如下。

——报文名称：远程控制 CLOUD2VEH_REMOTECTL（8.8 中称 REMOTECTL）

——数据通道：指令下发通道

——数据类别：REMOTECTL——29（0x1D）

——版本号：0x01 

——数据定义：云端根据车端的功能请求，将远程控制指令下发给车端

——业务功能：云端根据车端订阅的功能向车辆发送远程控制指令并由车端执行

### 8.8.1 传输行为

传输行为的前提条件是车端请求云端远程控制功能，且云端判断车端能够支持远程控车。车端接收云端远程控制指令并执行。云端以固定频率向车端发送远程控制指令。

### 8.8.2 异常处理

当车端认为连接异常时，主动断开连接。

### 8.8.3 数据结构及定义

远程控制数据结构见表 46。

![image-20221021224512487](https://img-blog.csdnimg.cn/img_convert/85e25dfdfe7603ae9615e1ceb2bde400.png)

不同远程控制类型下的控制指令内容的数据结构见表 47-表 48。

![image-20221021224521105](https://img-blog.csdnimg.cn/img_convert/dc8c32f9627a0c50d6e503e13f5d20c7.png)

![image-20221021224528279](https://img-blog.csdnimg.cn/img_convert/7798c50954689c3df7fc21ceefe6b26e.png)

![image-20221021224534496](https://img-blog.csdnimg.cn/img_convert/b7eb628a320f3e2222320ce6ceebef2f.png)

## 8.9 辅助功能

辅助功能报文定义如下。

——报文名称：辅助驾驶信息 CLOUD2VEH_ASTFUNC（8.9 中称 ASTFUNC）

——数据通道：指令下发通道

——数据类别：ASTFUNC——62（0x3E）ASTFUNC——63（0x3F）

——版本号：0x01 

——数据定义：云端根据车端订阅的功能及车辆运行状态信息,将实时车辆辅助驾驶信息下发给车端

——业务功能：云端根据车端订阅的功能向车辆传递所需的实时辅助驾驶信息

### 8.9.1 传输行为

传输行为的前提条件是车端请求指定功能或用户操作实现指定功能。车端接收ASTFUNC 辅助功能信息并返回 ASTFUNC_RES 辅助功能返回信息。云端根据车端订阅的功能或用户操作下发 ASTFUNC 给指定车辆，超时预定时间未收到 RES，则记录异常日志，重新发送，连续 3 次失败后，认为连接异常。预定时间可根据场景对时延需求来确定，如 1s。

### 8.9.2 异常处理

云端下发后 3s 未收到返回，则记录异常日志，重发；连续三次未收到返回，则认为指令失败，记录异常日志。

当车端认为连接异常时，主动断开连接。

### 8.9.3 数据结构及定义

辅助功能数据结构见表 49。

![image-20221021224606820](https://img-blog.csdnimg.cn/img_convert/f4ea9981a53512fb473f7005cf9a58ef.png)

### 8.9.4 辅助驾驶信息分类

辅助功能共有 6 类，其功能列表见表 50。

![image-20221021224618719](https://img-blog.csdnimg.cn/img_convert/d3e464257f45652311429ba4525d2428.png)

### 8.9.5 车辆视频流上传及返回指令

#### 8.9.5.1 应用场景

云端请求车端实时上传车内视频流数据。

#### 8.9.5.2 行为

云端下发 CLOUD2VEH_ASTFUNC_STREAM_VIDEO 指定摄像头开始实时上传，车端返回执行状态 VEH2CLOUD_ASTFUNC _STREAM_VIDEO_RES。

云端下发 CLOUD2VEH_ASTFUNC_STREAM_VIDEO 停止指定摄像头实时上传，车端返回执行状态 VEH2CLOUD_ASTFUNC _STREAM_VIDEO_RES。

#### 8.9.5.3 数据结构

车辆视频流上传（CLOUD2VEH_ASTFUNC_STREAM_VIDEO）数据结构见表 51。

![image-20221021224638608](https://img-blog.csdnimg.cn/img_convert/1a1e9f5448c4cf8f3110b35b95d06c6f.png)

车辆视频流上传返回（VEH2CLOUD_ASTFUNC_STREAM_VIDEO_RES）数据结构见表 52。

| 项目             | 字段名称    | 元数据类型 | 备注                                                        |
| ---------------- | ----------- | ---------- | ----------------------------------------------------------- |
| 辅助功能类别类型 | astFuncType | BYTE       | 固定值为2                                                   |
| 唯一标识         | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号 |
| 辅助功能标志     | astFuncFlag | BYTE       | 枚举类型：[0..2]，0：失效；1：开始；2：结 束                |
| 执行标志         | doFlag      | BYTE       | 枚举类型：[0..2]，0：失效；1：成功；2：执 行失败；255：缺省 |

### 8.9.6 车辆历史视频上传及返回指令

#### 8.9.6.1 应用场景

云端请求车端上传车内历史视频数据。

#### 8.9.6.2 行为

云端下发 CLOUD2VEH_ASTFUNC_HIST_VIDEO 开始指定摄像头上传历史视频流，车端返回执行状态 VEH2CLOUD_ASTFUNC_ HIST _VIDEO_RES。

#### 8.9.6.3 数据结构

车辆历史视频上传（CLOUD2VEH_ASTFUNC_HIST_VIDEO）数据结构见表 53。

![image-20221021224708304](https://img-blog.csdnimg.cn/img_convert/908a15dfa9fc621178f662eac52a0884.png)

车辆历史视频上传返回（VEH2CLOUD_ASTFUNC_HIST_VIDEO_RES）数据结构见表 54。

| 项目             | 字段名称    | 元数据类型 | 备注                                                        |
| ---------------- | ----------- | ---------- | ----------------------------------------------------------- |
| 辅助功能类别类型 | astFuncType | BYTE       | 固定值为 4                                                  |
| 唯一标识         | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号 |
| 执行标志         | doFlag      | BYTE       | 枚举类型：[0..2]，0：失效；1：成功；2：执 行失败；255：缺省 |

### 8.9.7 车端事件数据记录系统数据上传及返回指令

#### 8.9.7.1 应用场景

云端请求车端上传事件数据记录系统（EDR）数据，包括车辆定位信息，主动安全报警和部分 CAN 数据，用于事故原因定位。

#### 8.9.7.2 行为

云端下发 CLOUD2VEH_ASTFUNC_HIST_EDR 开始车端 EDR 数据的上传，车端返回执行状态VEH2CLOUD_ASTFUNC_ HIST _EDR_RES。

#### 8.9.7.3 数据结构

车端事件数据记录系统数据上传（CLOUD2VEH_ASTFUNC_HIST_EDR）数据结构见表 55。

![image-20221021224742455](https://img-blog.csdnimg.cn/img_convert/500b5378af7af64349a500bd378c63dc.png)

车端事件数据记录系统数据上传返回（VEH2CLOUD_ASTFUNC_HIST_EDR_RES）数据结构见表 56。

| 项目             | 字段名称    | 元数据类型 | 备注                                                        |
| ---------------- | ----------- | ---------- | ----------------------------------------------------------- |
| 辅助功能类别类型 | astFuncType | BYTE       | 固定值为 6                                                  |
| 唯一标识         | uuid        | STRING[36] | 一组固定长度为 36 位的字符串，UTF-8 编码， 标识命令唯一编号 |
| 执行标志         | doFlag      | BYTE       | 枚举类型：[0..2]，0：失效；1：成功；2：执 行失败；255：缺省 |

### 8.9.8 云端下发信号灯信息及返回指令

#### 8.9.8.1 应用场景

车端请求云端下发信号灯信息功能，云端根据车辆的位置及路径信息推送前方信号灯当前状态、配时以及下一阶段状态和持续时间。

#### 8.9.8.2 行为

云端下发CLOUD2VEH_ASTFUNC_TLM信号灯数据 ， 车端返回执行状态VEH2CLOUD_ASTFUNC_TLM_RES。

#### 8.9.8.3 数据结构

云端下发信号灯信息（CLOUD2VEH_ASTFUNC_TLM）数据结构见表 57。

![image-20221021224853676](https://img-blog.csdnimg.cn/img_convert/d25c296b64ac3e123a7943c5849f56be.png)

![image-20221021224900303](https://img-blog.csdnimg.cn/img_convert/3c57a72f43faeb08ea878bec209b4d95.png)

![image-20221021224907080](https://img-blog.csdnimg.cn/img_convert/b8a9b9b7e0d4b768e221f2751a176b68.png)

云端下发信号灯信息返回（VEH2CLOUD_ASTFUNC_TLM_RES）数据结构见表 59。

| 项目     | 字段名称    | 元数据类型 | 备注                                                         |
| -------- | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | astFuncType | BYTE       | 固定值为 8                                                   |
| 消息标识 | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag      | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.9.9 云端下发定位增强信息及返回指令

#### 8.9.9.1 应用场景

车端请求云端下发定位增强信息功能，云端向车端推送定位增强数据。

#### 8.9.9.2 行为

云端下发CLOUD2VEH_ASTFUNC_RTCM 定位增强数据 ， 车端返回执行状态VEH2CLOUD_ASTFUNC_RTCM_RES。

#### 8.9.9.3 数据结构

云端下发定位增强信息（CLOUD2VEH_ASTFUNC_RTCM）数据结构见表 60。

| 项目         | 字段名称    | 元数据类型 | 备注                                                         |
| ------------ | ----------- | ---------- | ------------------------------------------------------------ |
| 辅助功能类型 | astFuncType | BYTE       | 固定值为 9                                                   |
| 时间戳       | timestamp   | TIMESTAMP  | 云端下发时间戳                                               |
| 消息标识     | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 数据版本     | rtcmVersion | BYTE       | [0..255]，版本号                                             |
| 数据长度     | rtcmLength  | WORD       | [0..65535]，数据长度                                         |
| 数据负载     | rtcmPayload | BYTE[N]    | RTCM 数据内容，长度为 N，其中 N 为数据长度                   |

云端下发定位增强信息返回（VEH2CLOUD_ASTFUNC_RTCM_RES）数据结构如表 61 所示。

| 项目     | 字段名称    | 元数据类型 | 备注                                                         |
| -------- | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | astFuncType | BYTE       | 固定值为 10                                                  |
| 消息标识 | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag      | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

### 8.9.10 云端下发实时感知信息及返回指令

#### 8.9.10.1 应用场景

车端请求云端下发感知信息功能，云端根据车辆的位置等信息，向车端推送车辆前后一定范围内的实时感知数据。

#### 8.9.10.2 行为

云端下发CLOUD2VEH_ASTFUNC_RSM实时感知数据 ， 车端返回执行状态VEH2CLOUD_ASTFUNC_RSM_RES。

#### 8.9.10.3 数据结构

云端下发实时感知信息（CLOUD2VEH_ASTFUNC_RSM）数据结构见表 62。

| 项目         | 字段名称      | 元数据类型 | 备注                                                         |
| ------------ | ------------- | ---------- | ------------------------------------------------------------ |
| 建议类型     | astFuncType   | BYTE       | 固定值为 11                                                  |
| 时间戳       | timestamp     | TIMESTAMP  | 云端下发时间戳                                               |
| 消息标识     | seq           | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 数据源       | source        | BYTE       | 枚举类型：[0..22]，0：未知；1：自身感知； 2：V2X；3；视频；4：微波；5：线圈；6：激 光；7：综合（其他均属综合）；11：视觉和毫 米波融合；12：视觉和激光融合；21：云平 台；22：人工发布 |
| 感知目标个数 | objNum        | WORD       | [0..512]，最多 512 个目标，N 为 65535 时，表 示异常或未获取到感知目标，不发送感知目标 数据 |
| 感知目标数据 | detectionData | 98N        | N 组云端感知目标数据，其中 N 为感知目标数 量，感知内容定义见表 C.1 目标信息数据格式 定义 |

云端下发实时感知信息返回（VEH2CLOUD_ASTFUNC_RSM_RES）数据结构见表 63。

| 项目     | 字段名称    | 元数据类型 | 备注                                                         |
| -------- | ----------- | ---------- | ------------------------------------------------------------ |
| 建议类型 | astFuncType | BYTE       | 固定值为 12                                                  |
| 消息标识 | seq         | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中 seq，车端向云端反馈收到的云端消息中的 seq 以确认接收 |
| 执行标志 | doFlag      | BYTE       | 枚举类型：[0..1]，0：失效；1：生效； 当前默认为收到即生效    |

## 8.10 上行自定义功能

上行自定义功能报文定义如下。

——报文名称：上行自定义功能

——通道：指令下发通道

——数据类别：TEST——0x19 

——版本号：0x01 

——数据定义：描述车端向云端发送自定义数据

——业务功能：向云端发送自定义数据，用于自定义数据的使用

### 8.10.1 传输行为

无前提条件。车端通过指令下发通道向云端发送自定义数据。

### 8.10.2 异常处理

当车端认为连接异常时，主动断开连接。

### 8.10.3 数据结构及定义

上行自定义功能数据结构见表 64。

| 项目     | 字段名称  | 元数据类型 | 备注                                                         |
| -------- | --------- | ---------- | ------------------------------------------------------------ |
| 车辆编号 | vehicleId | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控基础平台中进行登记/注册，车辆编号定义可参考附录 B vehicleId 编码规则，不可缺省 |
| 数据长度 | dataLen   | WORD       | [0..2048]，表示自定义数据的字节数                            |
| 数据内容 | Data      | BYTE[n]    | 自定义数据内容，长度由 dataLen 定义                          |

## 8.11 下行自定义功能

下行自定义功能报文定义如下。

——报文名称：下行自定义功能

——数据通道：指令下发通道

——数据类别：TEST——0x20 

——版本号：0x01 

——数据定义：描述云端向车端发送自定义数据

——业务功能：云端向车端发送自定义数据，用于自定义数据的使用

### 8.11.1 传输行为

无前提条件。云端通过数据下发通道向车端发送自定义数据。

### 8.11.2 异常处理

当云端认为连接异常时，主动断开连接。

### 8.11.3 数据结构及定义

下行自定义功能数据结构见表 65。

| 项目     | 字段名称  | 元数据类型 | 备注                                                         |
| -------- | --------- | ---------- | ------------------------------------------------------------ |
| 车辆编号 | vehicleId | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控基础平台中进行登记/注册，车辆编号定义可参考附录 B vehicleId 编码规则，不可缺省 |
| 数据长度 | dataLen   | WORD       | [0..2048]，表示自定义数据的字节数                            |
| 数据内容 | Data      | BYTE[n]    | 自定义数据内容，长度由 dataLen 定义                          |

## 8.12 心跳及回应

心跳及回应报文定义如下。

——报文名称名称：心跳 HEARTBEAT；心跳返回 HEARTBEAT_RES 

——数据通道：指令下发通道

——数据类别：HEARTBEAT——12（0x0C），HEARTBEAT_RES——13（0x0D）

——版本号：0x01 

——数据定义：车端向云端发送心跳信息，云端收到后向车端发送心跳返回信息。

——业务功能：用于维护车端与云端的连接不被断开。

由车端向云端以固定频率发送数据段为空的报文，云端收到后向车端返回数据段为空的回应报文。

# 附录 A（规范性）TCP 传输数据类别定义

采用 TCP 协议传输的数据类别分类定义见表 A.1。

![image-20221021225257492](https://img-blog.csdnimg.cn/img_convert/b3106d4fcbea02f7c5d27ec4c55fb686.png)

采用 TCP 协议传输的数据类别见表 A.2。

![image-20221021225307860](https://img-blog.csdnimg.cn/img_convert/701f000e65ca99e9bbe8bb527b9eb2e4.png)

# 附录 B（资料性）车辆编号编码规则

车辆编号 VehicleID 编码可使用下文方法，也可按需自行定义 vehicleID 编码规则。

为固定 8 位 UTF-8 编码，规则如下：

格式：AABCDDDD，四部分组成：

1）AA：车辆品牌及车型

2）B：车辆类别：1: 乘用车 passenger_vehicle，2：轻型货车 light trucks，3：货车 trucks，4：公交车 transit，5：紧急车辆 emergency vehicle，6：其他装配有 V2X 设备的交通参与者，0：模拟车…

3）C：车辆动力类型：0：未知类型 unknown，1：汽油，2：乙醇，3：柴油，4：电动车，5：混合动力，6：氢燃料车，7：液化天然气，natGasLiquid（

Liquefied），8：压缩天然气，natGasComp（Compressed），9：丙烷…

4）DDDD：4 位 32 进制表示内部编号

车辆品牌及车型见表 B.1。

| 序号 | 值   | 描述              |
| ---- | ---- | ----------------- |
| 1    | A1   | 启迪云控北汽EU260 |

# 附录 C（规范性）目标感知数据

感知目标信息的数据结构定义见表 C.1。

![image-20221021231241167](https://img-blog.csdnimg.cn/img_convert/f7d5ab2337ba90e0e4bcc5c44a5161c9.png)

![image-20221021231249303](https://img-blog.csdnimg.cn/img_convert/31b9b823dd053ee171b8b78d314068c1.png)

![image-20221021231259910](https://img-blog.csdnimg.cn/img_convert/6b9f19da7bba18e3ba5535cf6bb815de.png)

注：总长度为 90B。

感知目标的类型定义见表 C.2。

![image-20221021231315501](https://img-blog.csdnimg.cn/img_convert/498dd8d82cfd0ae3e4984e28c8818c42.png)

# 附录 D（规范性）精度等级

## D.1 位置及高程

位置及高程精度等级定义见表 D.1。

| 位置及高程精度等级 | 说明          |
| ------------------ | ------------- |
| 1                  | 误差小于 500m |
| 2                  | 误差小于 200m |
| 3                  | 误差小于 100m |
| 4                  | 误差小于 50m  |
| 5                  | 误差小于 20m  |
| 6                  | 误差小于 10m  |
| 7                  | 误差小于 5m   |
| 8                  | 误差小于 2m   |
| 9                  | 误差小于 1m   |
| 10                 | 误差小于 50cm |
| 11                 | 误差小于 20cm |
| 12                 | 误差小于 10cm |
| 13                 | 误差小于 5cm  |
| 14                 | 误差小于 2cm  |
| 15                 | 误差小于 1cm  |
| 16~254             | 预留          |
| 255                | 缺省          |

## D.2 速度

速度精度等级定义见表 D.2。

| 速度精度等级 | 说明             |
| ------------ | ---------------- |
| 1            | 误差小于 100m/s  |
| 2            | 误差小于 10m/s   |
| 3            | 误差小于 5m/s    |
| 4            | 误差小于 1m/s    |
| 5            | 误差小于 0.1m/s  |
| 6            | 误差小于 0.05m/s |
| 7            | 误差小于 0.01m/s |
| 8~254        | 预留             |
| 255          | 缺省             |

## D.3 航向角

航向角精度等级定义见表 D.3。

| 航向角精度等级 | 说明              |
| -------------- | ----------------- |
| 1              | 误差小于 10°      |
| 2              | 误差小于 5°       |
| 3              | 误差小于 1°       |
| 4              | 误差小于 0.1°     |
| 5              | 误差小于 0.05°    |
| 6              | 误差小于 0.01°    |
| 7              | 误差小于 0.00125° |
| 8~254          | 预留              |
| 255            | 缺省              |

## D.4 加速度

加速度精度等级定义见表 D.4。

| 加速度精度等级 | 说明               |
| -------------- | ------------------ |
| 1              | 误差小于 10m/s     |
| 2              | 误差小于 1m/s 2    |
| 3              | 误差小于 0.1m/s 2  |
| 4              | 误差小于 0.01m/s 2 |
| 5              | 误差小于 0.001m/s  |
| 6~254          | 预留               |
| 255            | 缺省               |

# 附录 E（规范性）RSI 事件类型（alertType）数据格式和定义

RSI 事件类型分为标识标牌和交通事件（alertType）两类，其数据格式和定义分别见表 E.1、表 E.2。

![image-20221021231433993](https://img-blog.csdnimg.cn/img_convert/fef348cf7dfbd576f58d10ae1bb2e442.png)

![image-20221021231444110](https://img-blog.csdnimg.cn/img_convert/ba1675cc0e5c43a6b408dbc625550310.png)

![image-20221021231451366](https://img-blog.csdnimg.cn/img_convert/b2399d3f0714fafe5c438ae3992e9987.png)

![image-20221021231501425](https://img-blog.csdnimg.cn/img_convert/8e35ba7b51a4c3adadaa8532d8856681.png)

![image-20221021231509261](https://img-blog.csdnimg.cn/img_convert/e571685c85237eeca0db22d1ecf79c86.png)

![image-20221021231518615](https://img-blog.csdnimg.cn/img_convert/c21d29792e226f4face32aff8c6af8ce.png)

![image-20221021231530087](https://img-blog.csdnimg.cn/img_convert/7116f131e52d723d0ed3d189b2b7598e.png)

# 附录 F（规范性）车端向云控平台注册及鉴权流程

## F.1 车端注册流程

车端在未注册状态下，应首先进行注册，注册成功后车端获取到云控平台鉴权码并保存，用于后续鉴权流程。

车端注册数据结构见表F .1。

| 项目             | 字段名称              | 元数据类型 | 描述                                                         |
| ---------------- | --------------------- | ---------- | ------------------------------------------------------------ |
| 车辆品牌及车型   | vehicleBrand          | STRING[8]  | 长度为 8 位的字符串                                          |
| 车辆类别         | vehicleType           | WORD       | 枚举类型：[0..6]，0：模拟车；1：乘用车；2：轻型货车；3：货车；4：公交车；5：紧急车辆；6：其他装配有 V2X 设备的交通参与者； |
| 车辆燃料动力类型 | fuelType              | WORD       | 枚举类型：[0..9]，0：未知类型；1：汽油；2：乙醇；3：柴油；4：电动车；5：混合动力；6：氢燃料车；7：液化天然气；8：压缩天然气；9：丙烷 |
| 车辆自动驾驶等级 | adLevel               | BYTE       | 枚举类型：[0..5]，0：L0；1：L1；2：L2；3：L3；4：L4；5：L5   |
| 车辆网联化等级   | conLevel              | BYTE       | 枚举类型：[1..3]，1：1 级；2：2 级；3：3级                   |
| 车牌号           | plateNumber           | STRING[8]  | 公安交通管理部门颁发的机动车号牌                             |
| 车载终端型号     | terminalType          | STRING[30] | 型号由终端厂商自行定义                                       |
| 自定义字段长度   | userdefinedDataLength | BYTE       | [0..255]，描述自定义字段长度，255 表示没有自定义字段，不发送自定义字段内容字段 |
| 自定义字段内容   | userdefinedData       | STRING[N]  | 自定义数据字段，长度为 N，其中 N 为自定义字段长度            |

云端向车端返回的注册返回数据结构见表 F.2。

| 项目       | 字段名称             | 元数据类型 | 描述                                                         |
| ---------- | -------------------- | ---------- | ------------------------------------------------------------ |
| 消息标识   | seq                  | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中seq，不可缺省 |
| 结果       | res                  | BYTE       | 枚举类型：[0..3]；0：注册成功；1：注册失败；车辆已注册；2：注册失败；车载终端已注册；3：注册失败；其他原因 |
| 鉴权码长度 | authenticationLength | BYTE       | 鉴权码长度，注册结成功时，才生成该字段，注册失败则无该字段   |
| 鉴权码     | authentication       | STRING[N]  | 长度为 N 的字符串，其中 N 为鉴权码长度，注册结成功时，才生成该字段，注册失败则无该字段 |
| 车辆编号   | vehicleID            | STRING[8]  | 长度为 8 位的字符串，由云端根据一定规则生成作为车辆在云端的唯一标识，注册结成功时，才生成该字段，注册失败则无该字段 |

## F.2 车端鉴权流程

已注册的车端每次与平台建立连接后，应立即进行鉴权，鉴权成功前车端不应发送其他消息。

车端鉴权数据结构见表 F.3。

| 项目       | 字段名称             | 元数据类型 | 描述                                                         |
| ---------- | -------------------- | ---------- | ------------------------------------------------------------ |
| 车辆编号   | vehicleId            | STRING[8]  | 长度为 8 位的字符串，该车辆编号必须在云控基础平台中进行登记/注册，车辆编号定义可参考附录 B vehicleId 编码规则，不可缺省 |
| 鉴权码长度 | authenticationLength | BYTE       | 鉴权码长度                                                   |
| 鉴权码     | authentication       | STRING[N]  | 长度为 N 的字符串，其中 N 为鉴权码长度                       |

云端向车端返回的鉴权返回数据结构见表 F.4。

| 项目     | 字段名称 | 元数据类型 | 描述                                                         |
| -------- | -------- | ---------- | ------------------------------------------------------------ |
| 消息标识 | seq      | BYTE[8]    | [0..2<sup>64</sup> -1]，云端维护（计数）下发消息中seq，不可缺省 |
| 结果     | res      | BYTE       | 枚举类型：[0..2]，0：确认；1：失败；2：消息有误；不可缺省    |