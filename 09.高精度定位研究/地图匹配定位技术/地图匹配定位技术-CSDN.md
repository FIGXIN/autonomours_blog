地图匹配定位利用实时道路物理信息与预制高精度地图进行匹配来实现汽车定位的技术。在卫星定位、惯性导航系统出现明显误差时，即可利用地图匹配定位技术为自动驾驶汽 车提供定位修正信息。本节将从地图匹配定位技术的简介、原理、误差分析以及地图匹配常用算法等方面进行介绍。

# 1 地图匹配定位技术简介 

无论是GNSS定位还是惯性导航定位，自动驾驶汽车定位系统的误差都是不可避免的，定位结果通常偏离实际位置。引入地图匹配可以有效消除系统随机误差，校正传感器参数，弥补在城市高楼区、林荫道、立交桥、隧道中长时间 GNSS定位失效而惯性导航系统误 差急剧增大时的定位真空期。 

地图匹配定位技术是指将自动驾驶汽车行驶轨迹的经纬度采样序列与高精度地图路网匹配的过程。地图匹配定位技术将汽车定位信息与高精度地图提供的道路位置信息进行比较，并采用适当的算法确定汽车当前的行驶路段以及在路段中的准确位置，校正定位误差[21]，并为自动驾驶汽车实现路径规划提供可靠依据。

如图3-16所示，由于各种原因导致自动驾驶汽车定位信息存在误差，尽管汽车行驶在中间车道上，但定位结果与实际情况存在偏差，利用地图匹配定位技术可将汽车定位信息纠 正回正确车道，提高定位精度。

![image-20220901142500859](https://img-blog.csdnimg.cn/img_convert/30284259c83f0f30546282c247ce0de9.png)

# 2 地图匹配定位技术原理 

地图匹配定位是在已知汽车的位姿信息的条件下进行高精度地图局部搜索的过程。首先，利用汽车装载的 GNSS和INS做出初始位置判断，确定高精度地图局部搜索范围。然后，将激光雷达实时数据与预先制作好的高精度地图数据变换到同一个坐标系内进行匹配， 匹配成功后即可确认汽车定位信息。地图匹配定位流程图如图3-17所示。

![image-20220901142524772](https://img-blog.csdnimg.cn/img_convert/e92b4e3428db0b52d5834a8831e8ea46.png)

高精度地图的预制是地图匹配的基础，需包含特征明显的结构化语义特征和具有统计 意义的信息。高精度地图中常用于地图匹配的特征主要包含车道线、停止线、导流线、路灯、 电线杆等特征明显的物体，同时，还包括平均反射值、方差及平均高度值等具有统计意义的信息。下面将以示意图的方式说明地图匹配定位技术原理。 

在自动驾驶过程中，位姿信息可能存在较大误差，不能满足自动驾驶定位精度要求[22]， 仅能确定其在道路上的大致位置，如图3-18所示。

![image-20220901142540198](https://img-blog.csdnimg.cn/img_convert/2f147a59acf5e6ebb027c3e054c1df58.png)

图3-18中带有“不执行”符号的汽车表示不可用的、带有误差的 GNSS或惯性导航系统 定位位姿。根据实时感知数据进行环境特征的检测，主要检测对象是地面上的车道线与 杆状物，并从高精度地图对应位置范围内提取对应的元素。实际匹配过程中，系统将检 测出的车道线、护栏等道路特征与高精度地图提供的道路特征进行对比，修正汽车的横纵向定位，如图3-19和图3-20所示。图中不带有“不执行”符号的汽车为修正后的汽车定位位姿。

![image-20220901142556415](https://img-blog.csdnimg.cn/img_convert/79199fbf2185a15c56687ac035e343a6.png)

如图3-19所示，GNSS将汽车定位在前进方向的左侧车道，自动驾驶汽车利用传感器 检测到的车道线信息与高精度地图数据进行匹配后，确定汽车位于前进方向中间车道，与 GNSS的定位结果存在差异，进而修正横向的位姿误差。如图3-20所示，纵向上修正主要 提取传感器所检测到的广告牌、红绿灯、交通标志灯等道路元素与高精度地图进行匹配，可 以修正汽车的纵向误差。 

# 3 地图匹配定位误差分析 

地图匹配定位误差主要由局部搜索范围正确性问题引起。局部搜索范围正确性即道路选择的正确性，是地图匹配中极大的影响因素之一，在选择道路正确的情况下，才能继续之后的地图匹配过程。

造成道路选择错误的原因主要包括路况引起的误差、传感器误差、高精度地图误差及算法误差等方面。 

## 3.1 路况引起的误差 

真实道路的情况复杂而多变，无法保证汽车在各种复杂路况上都能够正确地提取特征， 并实现正确定位。车速变化将会影响传感器采集数据的质量，车速越快，质量越低，甚至产生运动模糊、失真等情况。在没有INS的定位系统中，各种路况下造成的汽车轮胎的漂移及地面颠簸等情况都可能使激光点云数据存在畸变、抖动和运动模糊等问题。与此同时，实 际行驶情况中汽车有时会离开道路，这将导致道路匹配错误并引起误差。

## 3.2 传感器误差 

进行地图匹配需要利用传感器的量测信息(如激光雷达、摄像头)，这些数据存在误差将直接影响定位速度与成功率。

## 3.3 高精度地图误差

在实际使用中，一般默认高精度地图的精度比传感器获得的数据精度高，但实际上，高 精度地图同样有可能存在较大误差。在地图数据本身存在误差时，即使在正确选择道路的 情况下也会引入误差。 

## 3.4 算法误差 

在地图匹配过程中不可避免地因算法存在的缺点导致发生错误匹配，发生错误匹配会 对之后的地图匹配定位结果产生恶劣的影响。 

# 4 地图匹配常用算法 

任何一种地图匹配算法都涉及两个根本的问题:①当前汽车在哪一条道路上;②当前 汽车在对应道路的哪一个位置。因此，地图匹配算法几乎都可以用式(3-18)进行形式化 描述:

![image-20220901142624173](https://img-blog.csdnimg.cn/img_convert/4755498ab7d88844bfa5af90d9630f9c.png)

式中，X~n~ 表示n 时刻汽车的原始状态信息，如定位数据、速度、行驶方向等;G 表示道路网络，由道路路段集R 以及道路节点集N 构成。根据不同的地图匹配特点，将地图匹配算法分为几何匹配算法、概率统计算法和其他高级算法。

## 4.1 几何匹配算法 

几何匹配算法包括点到点、点到弧和弧到弧的地图匹配算法[23]。 

1)点到点的地图匹配算法 

点到点的地图匹配算法的原理即搜索汽车定位点与高精度地图中位置点之间几何距离最近的点作为匹配结果。该算法匹配精度取决于位置点集的数量，随着位置点集数量的增大，匹配精度更高，但占用的硬件资源也更多。点到点的地图匹配算法得到的匹配结果很可能会与实际情况不符，如在一条笔直道路上，待匹配 GNSS点都会错误地匹配到道路两端的节点上，这样得到的匹配精度显然不符合实际使用要求。 

2)点到弧的地图匹配算法 

通过寻找与汽车定位点几何距离最近的路段作为匹配线段，将汽车定位点投影到该线 段上作为匹配结果。对于曲线则做线性化处理后进行投影，该算法只利用了部分数据，当两条曲线距离较小或相同时极易造成误匹配，在路网密度大时匹配的结果的精度就会锐减，此时的算法缺乏稳定性。 

3)弧到弧的地图匹配算法 

将连续的汽车定位点组成一条轨迹曲线，寻找与这条曲线最近的匹配弧线作为匹配线段。由于最近路段的寻找方法是基于匹配路段与定位点的最小距离，所以，若某定位点与非正确匹配线段非常近，将导致严重误差。 

## 4.2 概率统计算法 

概率统计算法通过在汽车导航定位系统中获得的历史轨迹，建立置信区域来与高精度地图进行匹配。置信区域参考GNSS误差、汽车航迹、汽车速度及道路信息等进行选取，与高精度地图匹配后采取最近距离原则来确定匹配线段。

一个完整的基于概率统计的地图匹配算法包括三个主要的处理过程，即确定误差区域、 选取候选路段和计算匹配位置。基于概率统计算法地图匹配的一般过程如图3-21所示。

![image-20220901142650814](https://img-blog.csdnimg.cn/img_convert/a8c45fe7eb6eb4d5921bfa77c8b1ee84.png)

误差区域是指可能包含汽车真实位置的区域范围，它应根据传感器定位结果和误差情况确定。在误差区域内的道路称为候选路段，地图匹配算法认为其中包含了汽车的真实位置。匹配路段的选取方法是从候选路段中挑选最有可能的是汽车行驶路段，挑选原则依据具体的算法设计而不同，通常，挑选参考量是高精度地图中的道路形状与汽车轨迹的相似程度。

确定匹配路段后，计算汽车在该路段中最可能的位置，并用匹配结果修正原有的定位信息并输出。 

## 4.3 其他高级算法 

除了上述两种地图匹配算法外，还有非参数滤波算法和参数滤波算法等。

非参数滤波算法包括了直方图滤波(HistogramFilter，HF)和粒子滤波(ParticleFilter，PF)等。参数滤波算法包括卡尔曼滤波、扩展卡尔曼滤波 (Extended KalmanFilter，EKF)、信息滤波 (InformationFilter，IF)、扩展信息滤波(ExtendedInformationFilter，EIF)等。这些算法在固定场景下有很高的匹配准确率，但需要大量的数据进行参数的前期学习和总结，对系统的要求较高。