- [高精地图二三事 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/383909558)

## 1.什么是高精度地图

谈高精地图(HD Map)之前，一就会说到日常生活中使用的标清地图(SD Map)。

下图为某标清地图软件，左图为卫星影像图，其同步了路网数据，同时包含了一些POI(point of interst )数据，在此基础上可进行导航。如中间图，为在标清地图的导航图，其中还包括了道路的拥堵信息，在导航过程中，经过路口会有路口放大图进行引导，如右图。 可以看出，标精地图服务主体主要是人。

![img](https://pic2.zhimg.com/80/v2-96c20b839c964b21ae61acfada07866d_720w.jpg)

相比于标精地图，高精地图服务主体只要是自动驾驶的机器。由于是要服务机器，有一些地方就放生了变化，主要体现在以下三个方面：

1. **要素精细**：相比于标精地图，高精地图包含更多的信息，如画出每一个位置的每一个车道及交通标志这些。
2. **位置精准**：标精地图大约5-10m的精度，高精地图需要达到几十厘米精度的量级
3. **信息准确**：因为服务于机器，需对道路的变化做出快速反应。比如某处修路，需要短时间内更新地图。

在进行以上说明后，来看一个示例：

[小鹏P7的自动驾驶/辅助驾驶NGP自主导航官方说明_哔哩哔哩_bilibiliwww.bilibili.com/video/BV1Uv4y1Z7oS?spm_id_from=333.905.b_72656c61746564.1![img](https://pic1.zhimg.com/v2-2b50c9efdec73bfb739be432ccb53598_180x120.jpg)](https://link.zhihu.com/?target=https%3A//www.bilibili.com/video/BV1Uv4y1Z7oS%3Fspm_id_from%3D333.905.b_72656c61746564.1)

此为小鹏基于高精度地图完成的L3级别的自动驾驶，相比于特斯拉没有高精度地图的类似功能，有高精度地图体验是要好一些的。网上评测有很多相关评测。

![img](https://pic2.zhimg.com/80/v2-bd56383cb88b89d47641a3581fb31795_720w.jpg)

以上图来看，高精地图内包含车道边线(白色)，车道的中心线(蓝色)，路边沿，汇入汇出匝道这些基本元素。

其中，蓝色的车道中心线是引导车辆运动的，当然也可能为了规避某些情况，车辆运动方向可能在中心线上做一些微调。

## 2. 如何描述高精地图

既然知道是高精地图是什么，以及看到了高精地图的显示界面了，那高精地图是如何描述的呢，这就要对其进行建模，如下图为基本的车道模型：

![img](https://pic4.zhimg.com/80/v2-4f5a5986d4b00c514c5864b9eb9d663b_720w.jpg)

此上图可以看出高精地图被划分为不同的段，section1/2/3...，都是在每一段内描述高精地图的信息，一般为100m一段。

在段与段之间，会出现状态的变化，比如车道线由虚变实，车道分离，而在分离时还涉及到关联状态的问题，比如section1的lane3关联section2的lane6与lane7。

一般上，描述一个地图或者说描述这个地图中的一个要素需要考虑3个问题：

1. **形点**。处于地理空间的位置。
2. **属性**。比如车道线是实线还是虚线，还有就是数学属性，数学属性一会说。
3. **拓扑关系**。某一段车道关联到下一段的哪几个车道。



对于车道的数学属性，主要包括以下几种：

1. **曲率**：就是弯道半径的倒数，用于描述道路弯曲的程度。其与方向盘的转角是相关的，曲率越大，方向盘则打的就越大，若此时速度快，人就会感受到较大离心力，较易出现不适感。于是在辅助驾驶中通过考量曲率用以限制车速，提升驾驶的舒适性。

![img](https://pic2.zhimg.com/80/v2-9780d64a054a1b2e297227c56269942d_720w.jpg)

\2. **航向角**：就是heading，有较明确定义。

![img](https://pic2.zhimg.com/80/v2-c8be91a1b93a9b7ad80c3f4888a0caf9_720w.jpg)

\3. 坡度：由于法律法规的原因不会给出具体多少度，一般都是分级。横坡的话一般较小。

![img](https://pic4.zhimg.com/80/v2-53ad1af5fe4f02bd60494741a0ef5bcf_720w.jpg)



在高速上这些数学属性就够了，但是在城市道路上就不够了。因为**城区相比高速复杂，具体复杂在哪里**：

- **路口场景**

如下图红框内为路网的拓扑关系。某车道拓扑关系既有左转，也有直行，在这个过程中，既要画出中间绿色的虚拟车道线，也要给这个车道补出两个边界。并且路口场景的元素更为复杂，多出了很多人行道、停止线、障碍物等元素。元素复杂造成的逻辑更为复杂，由于各个元素之间是有逻辑控制链的，会使得拓扑关系变得复杂。

![img](https://pic3.zhimg.com/80/v2-da5d4583c981734dfe2d86cf9123da3a_720w.jpg)

- **无GPS信号**：比如在高架下面的路是没有GPS信号的。
- **弱GPS/错误GPS信号**：两侧有高楼。
- **修路。**
- **动态变化场景**：可以移动的护栏，这种护栏是又人工控制的。

以上这些点是城区高精地图的难点和重点需要解决的点。

## **3. 高精地图的作用**

一套自动驾驶或辅助驾驶环节一般包括：感知预测、决策规划、控制以及仿真。

高精地图在其中为基础环节，高精地图+感知可以实现超视距感知；高精地图+规划可以实现车道级的规划；高精地图+控制可以方便方向盘控制以及加减速；高精地图+仿真可以在模拟场景中不断的试错学习，方便迭代。

这一切前提是定位得好。定位建图不可分割。

## **4. 高精地图业界进展**

**国内：高德**

高德地图早在2015年建立了完整的高精地图生产线。 2018年凯迪拉克量产车型CT6搭载了高德高精地图。 2021年1月，高德地图发布了第三代车载导航，基于高精高德实现了车道级导航，已在小鹏P7上量产应用。同时，高德高精地图覆盖了国内35万公里的高速路和城市快速路，可以提供一年4次的更新支持。

注意其工作均集中在高速路场景，而没有城区。

![img](https://pic2.zhimg.com/80/v2-82dcee2df5122a8e1d4ad80f6862fd25_720w.jpg)

**国内：百度**

2018年，百度对外宣布完成了覆盖全国高速公路和城市快速路的高精地图绘制。 2020年蔚来,广汽在量产车型上基于百度高精地图实现了高速场景L2/L3的辅助驾驶。百度城区高精地图已覆盖北京海淀、亦庄，长沙，成都等多个自动驾驶示范区，支撑了Apollo自动驾驶的示范运营。示范区一般是10几公里或几十公里的道路。

相比于高德，其更偏向与自研 采集车是自己搭建的。而且其有针对城区建立自己的高精地图能力。主要就是多了一步数据处理，就是为了解决自己GPS信号不准或没有GPS信号的情况。

![img](https://pic3.zhimg.com/80/v2-faef566018a46ead475b15090563b39a_720w.jpg)

**国外：TOMTOM**

[https://www.youtube.com/watch?v=ga5fW-QSXp0www.youtube.com/watch?v=ga5fW-QSXp0](https://link.zhihu.com/?target=https%3A//www.youtube.com/watch%3Fv%3Dga5fW-QSXp0)

![img](https://pic4.zhimg.com/80/v2-2c804a919b2e172ebe07be7128f23137_720w.jpg)

**国外：atlatec**

使用两个单目+高精度惯导+RTK。双目合成得到地面俯视图，而后进行人工标志车道线、标志牌等。

有硬件成本低的优点，但是对光线要求高，效果不好。对城区中GPS信号不好的场景，多趟采集拼接效果也不浩。

## 5. 高精度地图生产流程

- **采集解算**：

采集作业之前要划定作业区域，然后选定路线，作业车去外业采集。

采集完成之后进行内业解算，内业解算本质上是对所有数据进行时空间的对齐。

硬件设备不同厂商有不同的方案，可以包括：高精度组合导航(高精度IMU，高精度GPS接收机以及高精度PS天线)；激光雷达用于感知环境，采集点云信息；360°全景相机，捕捉车周围全景图像；高精度时钟同步板卡，保证各数据的时间对齐等等。

- **精度优化**：

对于城区，一个路口大约得采4遍，如果是复杂路口，8遍也是有的。如果多次采集，地图就会不重合，没办法对齐，这是GPS信号不好导致的。而高速场景一般采一遍，而且高速路GPS信号好，基本没有这些问题。

出现这种重影的情况一般两种方法：

1. 传统图商用测绘方法：外业时候打一个基准点，而后基于基准点进行优化，这种方法对高速场景比较适用，但是城市道路，每个路口可能需要打7-8个控制点，而且每个路口采集多遍时，每一趟都要打，代价比较高昂，
2. slam方法：进行匹配以及全局优化可以消除重影和分层。slam算法在学术界和工业界应用比较广泛，但常见的算法对停留在几百米到几公里的量级，而真实场景则是几公里到几十公里甚至成百上千公里，且过程中有大量动态障碍物，虚警，也可能相对之间没有共视区域这些情况，需要算法多做突破。

- **自动化识别**

在精度优化后就可以送入生产地图了，首先做的就是自动化识别。自动化识别一般分为两类：

1. 2D图像分割检测：这个是在图像上来做。分割出地面、车辆、地面的边缘、旁边的障碍物、红绿灯以及高牌。
2. 3D点云分割检测：在点云上进行分割，分出地面特征、车辆、栅栏/柱状物、树木这些。

使用深度学习的方法，而后基于分割，进行矢量化：比如吧车道线变为线，而不是孤零零的放像素在那里，亦或把左右转地面表示的外框回归出来，画上停止线，人行横道这些。

- **人工标注**

不可能完全自动化，需要人工进行一些精确标注，需要厂商自行开发交互界面。

- **后处理**

1. 道路自动生成：包括道路形点、对向道路关系、道路前后继关系以及道路与人行横道关系。
2. 车道自动生成：车道形点、车道前后继关系、车道与路口关系、车道与障碍物关系、车道与停止线关系以及车道转向信息。
3. 路口自动生成：路口外包络、 路口内车道中心线、路口内车道边线、 路口关联关系 。
4. 其他：车道的道路归属 车道的排序 车道边线与车道的绑定 道路边线与道路的绑定

- **质检**

重点关注几何属性与拓扑。而后做逻辑判断，用经验判定。

- **路测发布**

场景数据发生变更，要及时发现并处理问题，而后合成分发。

## 6.高精地图的挑战

1. MobileEye的REM降维打击的可能性。通过秦通论文也看出，华为在积累此方面技术积累。
2. 利润可能没多大，全世界大约100亿美元市场，中国大概能拿30%。 各厂商虽然明知不太赚钱，但数据一定要拿到，所以竞争激烈。
3. 一定会赢者通吃，毕竟用的人越多，更新越快，形成正向反馈。
4. 政策法规的限制：地图数据偏转加密、偏转插件的影响、审图政策、数据回传问题、个人隐私问题。
5. 单一高精地图难以应用，需要与自动驾驶(尤其是定位，导航等)融合提供完整的一整套满足人驾+自动驾驶需求的服务。 高精地图的采集和生产难度及复杂度高于标精地图，短期内高精地图的覆盖范围无法满足人驾需求。
6. 如果进行标清地图与高精地图融合，如何处理以下问题：二者匹配保证准召率，二者同步更新，数据出现不一致如何解决，POI如何获取。