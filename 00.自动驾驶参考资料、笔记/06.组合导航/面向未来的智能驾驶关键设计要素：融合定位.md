- [面向未来的智能驾驶关键设计要素：融合定位 (360doc.com)](http://www.360doc.com/content/21/0726/11/74487539_988232048.shtml)

汽车在自动驾驶领域将面临前所未有的变革，这一变革不仅与驾驶过程中要求的功能更新有巨大的联系，也包含了对于整个驾驶系统开发过程中的架构设计方案所将产生的重大变革。其中，高精地图作为其定位、导航的重要方面，也将发生重大的设计变革。这主要体现在如下几个重要的方面：

1）路侧地图的部署需要具备更多来自政府基建部门的强力支持，其中包括类似V2I的车联网系统，提供V2X场景渲染SDK，支撑自定义渲染风格，实现个性化车端V2X应用。利用路侧信息通路（PC5），可以解决由于蜂窝网络覆盖盲点对地图服务影响的问题。

2）对于地图的实时分发也从原来的秒级升级为毫秒级别，高精地图更新与分发能力趋向于边缘部署，实现实时地图更新与毫秒级数据分发服务，意在提高其传输数据的实时性。

3）自动驾驶系统中的实时高精地图平台也从原来的分布式系统逐渐向集中式系统进行过度。高精地图引擎可为自动驾驶系统提供实时高精地图应用服务，助力自动驾驶车端应用。

4）地图需要建立更多的自学习机制，包含建立影子模式下的自学习地图，不断地更新地图对于环境的认知和学习。

5）由优化的地图重新定义自动驾驶功能，这个过程实际是基于地图不断的对自动驾驶功能进行迭代的过程。

6）提供多元化的基础地图服务

未来高精地图将通过不断的优化更新使其具备相应的管理服务及技术优势，包含完善的功能迭代、系统数据安全、多类型数据支持、多端授权支持、高质量服务与运维体系以及数据在线升级服务几方面。

其中功能完善指标项包括：数据分发、收集、订阅、通知功能，动态数据在线编译、可视化在线显示编辑、Campaign, Map Learning众包更新、数据仿真平台等。

多数据支持方面包含：版本静态图层、有效动态数据支持、流数据支持、OSO自定义数据支持、增量数据发布更新，Map数据完整性保证。

系统数据安全包括：完善的网络安全配置，防火墙，VPC、多级系统权限管理，用户、角色、权限、资源、https双向加密、数据签名，HSM设备集成。

多终端权限支持包括：基于OAuth2授权管理，海量并发相应，Auto Scaling动态扩缩、完善的API SDK开发包支持、2V终端开发包与功能集成，OTA更新、VCDN，保证数据安全与速度。

7）支持边缘计算的V2X高精度地图服务

未来自动驾驶的发展主要走向智能化、网联化两大方向，其重点是从车端智能化逐渐过渡到路端甚至云端智能化的方向。而针对高精地图部署来说，最重要的几个点是其云端、路端和车端上所产生的一系列升级和变革。其中，云端变革主要涉及高精度地图服务、分片数据聚合、数据接边、数据分片几个方面。而路侧端主要涉及分片地图众包更新、地图版本管理、地图分包、路侧动态信息优化、地图消息服务等几个方面。应用到车端时，要求在分包数据融合、V2X场景还原、高精地图引擎也随之更新。

![image-20220817180331900](https://img-blog.csdnimg.cn/img_convert/23818448bf23923c29212e6b3fd6bafd.png)

地图的如上迭代更新过程可应用于实现L4/L5级无人驾驶功能，生成相关的机器人控制模式，也可在商用车的实现中发力，最终实现无人驾驶甚至远程驾驶。

# 1 面向量产的高精度融合定位解决方案

很显然，高精地图要实现精准定位和不断向前延展提升其功能性能就必须通过不断的优化自身的融合定位方案来获得。这一过程包含两个主要的软件算法。其一是通过全状态-扩展卡尔曼滤波进行车辆位姿的动态最优估计；其二是使用视觉传感器获取道路环境的语义信息，通过精确地图匹配算法获取精确位置。此外，需要提高经济性、适配度及整体性能。通过选择配置工业级车载终端RTK：采用高性能工业级32位处理器，内置高精度RTK板卡；通过3G/4G/5G与千寻平台建立通道，把GGA信息发给差分服务器，同时接收差分信息后，再通过 RS232输出精准位置信息。

![image-20220817180358730](https://img-blog.csdnimg.cn/img_convert/606876fc9320d9ac9dc52339ca3d2f6e.png)

通过选择消费级传感器，即已经在车上搭载完成的传感器（如适用于智能驾驶系统的摄像头、激光雷达雷达等信息）用于定位融合（如视觉SLAM、激光SLAM）提升定位性能。对于高适配性方案主要采用了独有硬件适配层（如独立的域控制器系统）及软件适配层（如标准的C语言接口）避免对于平台的依赖性。在高性能的需求中主要涉及对于横向、纵向两者定位的需求结果输出。一般的，横向定位误差要求为20cm，纵向定位误差要求为1m，航向角定位误差为0.5°。同时，对于GNSS在纵向定位误差上的信号丢失率应该小于0.3%。此外，还需要支持1000Hz的外置IMU及50Hz频率的摄像头输入方案。

除开地图整体架构设置外，对于其数据发布模式也要求具备最小流量成本来完成高精度地图更新，支持流式增量发布。这一过程包括流式发布适量瓦片、增量更新数据，浏览丰富数据集并区分目录、层级、瓦片，做到能够分层查询。最后按需检索云端历史数据，随时追溯到任意版本信息。

# 2 地图分发与地图纵包

高精地图最重要的过程是包含地图众包的采集与分发。关于众包式地图数据的采集，实际上可以理解为用户通过自动驾驶车辆自身的传感器，或其他低成本的传感器硬件，收集的道路数据传到云端进行数据融合，并通过数据聚合的方式提高数据精度，来完成高精地图的制作。整个众包流程实际是包括物理传感器报告、地图场景匹配、场景聚类、改变检测与更新。

![image-20220817180439026](https://img-blog.csdnimg.cn/img_convert/1dacfb121739bbe80812aebf90f2a1b9.png)

# 3 基于地图开发的自动驾驶的全新架构将面向何方？

当前自动驾驶系统的高精地图架构仍然面向分布式方式，其重点关注项包含地图众包采集，地图盒子对于高精地图原始信息的解析，地图如何对其他传感器输入数据进行融合等方面。这里我们注意一点，未来的自动驾驶系统架构中将不断的从分布式的开发方式进化为集中式。集中式的方式可以被看成分三两步走：

## Step1：智能驾驶域全集中式控制方案

即，将智能行车ADS、智能泊车AVP系统进行全集中控制，采用一套中央预处理装置将两大系统中索要处理的信息进行融合、预测、规划等处理方式。而与智能行车和智能泊车相关的所有传感及数据单元的处理方式（高精地图、激光雷达、全分布式摄像头、毫米波雷达等）都会相应的被融合进入中央域控制单元。

## Step2：智能驾驶域与智能座舱域全集中式控制方案

这种方式是实现全集中式分布方式的第二个阶段，即将智能驾驶域控制器所涵盖的所有功能开发（如自动驾驶、自动泊车）与智能座舱域所涵盖的所有功能开发（包含驾驶员监控DMS、影音娱乐系统iHU、仪表显示系统IP）进行融合覆盖。

## Step3：智能整车域全集中式控制方案

这里是实现包含智能驾驶、智能座舱与智能底盘域的全融合控制方式。即三大主体功能并入整车中央控制单元，后期对于该数据的处理将对域控制器产生更多的性能（算力、带宽、存储量等）需求。

这里我们所关注的高精地图定位开发在未来将更多的面向集中式的设计方式。我们将进行详述。

![image-20220817180504805](https://img-blog.csdnimg.cn/img_convert/2169c0b9a9879f71c0cef2733823760f.png)

如上图表示了针对高精地图在未来自动驾驶系统控制中的架构发展趋势。未来自动驾驶系统将致力于将感知单元、决策单元及定图定位单元等全部并入中央域控制单元，意在从底层减少对于高精地图盒子的依赖。其域控制器的设计中充分考虑对于AI运算芯片SOC、逻辑运算芯片MCU、高精地图盒子的充分融合。

![image-20220817180543981](https://img-blog.csdnimg.cn/img_convert/7f4cf8ec1f39f6f8c11a7afb21a79971.png)

如上图表示了整个云端控制逻辑下相应的高精地图传感数据采集、数据学习、AI训练、高精地图服务、仿真等方面的业务，同时在车端的移动和验证过程中会通过物理感知、动态数据感知、地图目标感知、定位、路径规划等内容不断更新地图数据并进行OTA上传至云端更新整体的众包数据。

前文所述了关于高精地图数据如何生成可以为自动驾驶控制器处理的相关数据方式流程，我们知道高精地图所处理的原始数据为EHP数据。该数据实际包含如下主要的数据支撑：

1：接收的外部GPS位置信息；

2：位置信息匹配到地图；

3：建立路网拓扑信息；

4：通过CAN发送数据；

5：融合部分导航数据；

该数据一般是通过千兆以太网从HDMap感知端直接处理完成后输入至高精地图中央处理单元的，该中央处理单元我们称之为“高精地图盒子”。通过地图盒子对数据的进一步处理（这个实际的处理过程我们将在后续的文章中进行具体说明），可以转化为可以满足自动驾驶控制器处理的EHR（实际为CanFD）数据。

对于下一代自动驾驶系统而言，我们致力于将高精地图的信息综合接入自动驾驶域控制器进行整体处理，这一过程意味着我们自动驾驶域控制器需要接续地图盒子所要进行的所有数据解析工作，那么我们需要重点考虑以下几点：

1）自动驾驶域控制器AI芯片能否处理包含高精地图所需要的所有传感器数据？

2）高精定位地图的逻辑运算单元是否具备足够的算力执行传感器数据信息融合？

3）整个底层操作系统是否满足功能安全需求？

4）AI芯片与逻辑芯片采用怎样的连接方式可以确保数据传输的可靠性，Ethernet 还是 CanFD？

为了回答如上问题我们需要分析如下图所示的控制器处理高精地图数据方式。

![image-20220817180604818](https://img-blog.csdnimg.cn/img_convert/1b9eb517b56f46116091e8cacb7e4209.png)

SOC作为自动驾驶系统的AI芯片，在未来高精地图数据处理中主要承担传感数据的基础处理，包含摄像头数据、激光雷达数据、毫米波数据等。在应用的处理方法上除开基本的数据点云融合、聚类外，还包括了常用的深度学习算法，且一般采用ARM核进行中央运算处理。

MCU作为自动驾驶域控制器逻辑运算单元后续会承担将原来高精地图盒子需要的全部逻辑计算量。包括前端的矢量聚合、传感融合定位、建立路网图，以及最为重要的替代原来的地图盒子功能，将EHP信息转化为EHR信号（对于中央处理器MCU如何有效的将EHP信息转化为EHR信息将在后面的文章中进行详述），并通过Can线进行有效的信号传输。最终利用AutoBox这一逻辑运算单元进行路径规划、决策控制等操作。

# 4 总结

未来的自动驾驶将倾向于将高精地图所处理的所有数据信息从原始地图盒子中融入到自动驾驶域控制器中，旨在建立真正的以整车域控制器为集成单位的中央处理大融合。这样的方式不仅能够节省更多的计算资源，也能够使得AI数据处理算法更好的应用到高精定位中，确保两者对于环境认知的一致性。我们后续需要更多的关注高精度传感数据大融合这个重要的方向，在芯片算力、接口设计、带宽设计及功能安全设计上多下功夫。