- [【自动驾驶】1.V2X、OBU、RSU、V2V之间的协作关系_Mister Zhu的博客-CSDN博客_obu和rsu](https://blog.csdn.net/u011754972/article/details/116239660)

### `1.` `V2X`、`OBU`、`RSU`、`V2V` 名词术语解释

`OBU`： `On Board Unit` 车载单元
`RSU`： `Road Side Unit` 路侧单元
`V2V`： `Vehicle to Vehicle` 车与车通信
`V2X`： `Vehicle to Everything` 车辆到一切通信

------

### `2.` `V2X`、`OBU`、`RSU`、`V2V`之间的协作关系

假设有两辆智能驾驶汽车`A`和`B`

- `A`车具备：自动驾驶计算平台`mdc`、`V2X`设备`OBU`
- `B`车具备：自动驾驶计算平台`mdc`、`V2X`设备`OBU`

智能驾驶道路路侧安装有: 路测单元`RSU`(`RSU`用来发送交通灯、交通标志、和道路上障碍物的数据给`OBU`)

路测单元`RSU` 和 `V2X`设备`OBU`也是通过 无线电波 进行通信

------

### `3.` 以A车和B车的车路协同、车车协同 为例：

`A`车`mdc`中有[自动驾驶](https://so.csdn.net/so/search?q=自动驾驶&spm=1001.2101.3001.7020)的各个节点，包括转发`obu`设备发来的数据的`v2x`节点。

- (1) `A`车`mdc`上的`v2x`节点收到`A`车`Obu`通过`UDP`协议发来的 {1.RSU数据 + 2.B车辆信息}，然后`A`车`mdc`上的`v2x`节点将OBU消息解析后打包成`Autosar`的AP消息发送出去供`A`车`mdc`自动驾驶的其他节点订阅。
  数据类型：`1.RSU数据` + `2.B车底盘、定位信息` ；
  数据流向：`A车obu` --> `A车mdc的v2x节点`
- (2) A车`mdc`上的`v2x`节点订阅本车的底盘信息和定位信息等，把这些AP消息打包成`proto`格式，然后封装到udp数据包中，通过`UDP`协议发送给A车`OBU`.
  数据类型：`底盘、定位等信息`；
  数据流向：A车`mdc`的`v2x`节点–> `A车obu`
- (3) A车OBU 将A车底盘、定位等信息 通过无线电波发送给 B车OBU，实现A车B车车辆底盘、定位信息共享。 (`V2V`)
  数据类型：`底盘、定位等信息`；
  数据流向：双向 `A车obu` <–> `B车obu`

------

#### 车车通讯无RSU：![车车通讯无RSU](https://img-blog.csdnimg.cn/2021052710052496.JPG#pic_center)

------

#### 车车-车路通讯有RSU：![车车-车路通讯有RSU](https://img-blog.csdnimg.cn/20210527100611744.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTE3NTQ5NzI=,size_16,color_FFFFFF,t_70#pic_center)

------

### `4.` 每辆车的`OBU`的输入与输出

##### `4.1` 每辆车的`OBU`接收三部分的输入：

- (1) 路侧单元`RSU`数据：
  接收路侧单元`RSU`的 交通灯、交通标志、障碍物数据 （`无线电波通信`）
- (2) 其他车`obu`发来的其他车数据:
  接收其他车`obu`数据，获取其他车的车辆底盘、定位灯信息 （`无线电波通信`）
- (3) 本车mdc的`v2x`节点发来的本车数据：
  接收本车`mdc`的`v2x`节点转发的本车底盘和定位信息（`udp`）

##### `4.2` 每辆车的`OBU`会有两路输出：

- (1) 整合前面第一部分输入(`RSU数据`) 和 第二部分输入(`其他车obu发来的其他车数据`)，通过`udp`发送给本车mdc的`v2x`节点；
- (2) 将前面第三部分输入(`本车mdc的v2x发来的本车数据`)，通过`本车和其他车的obu`之间的通信，发给其他车`obu`;

【`注意`】：目前`obu`上的开发，是我们公司其他部门的`obu`开发人员根据我们的需求进行开发，我目前没有代码工程开发权限，后面会有。我目前拥有的权限是mdc的`v2x`开发权限。

其中，本车`obu` 发给 本车`v2x`节点的 (`1.RSU数据`) 和 (`2.其他车底盘定位信息`)，会被本车`v2x`解析为`autosar`消息后,转发给本车其他节点。
本车`v2x`节点 会把 本车定位底盘信息 通过`UDP`转发给 本车`OBU`。

------

`obu` 发给自车`mdc`的`v2x`节点的UDP数据包，通过包头类似 `0x88`,`0x89`标识来确认是否使我们想要的数据

`mdc` 发给自车`obu `的`UDP`数据包，通过包头类似 "`obuxxx`"等做标识来确认是否使我们想要的数据

------

### `5.` `mdc`的`v2x`节点的 `输入` 与 `输出`：

##### `5.1` `mdc`的`v2x`节点的输入：

- `mdc`的`v2x`节点有很多输入，包括`车辆底盘`、`定位`、`odometry`、`调度`、`本车obu`等。
- 其中，本车`obu`接收到其他车的`obu`数据后，直接和`RSU`过来的数据一起打包后`透传`给`mdc`的`v2x`节点。

##### `5.2` `mdc`的`v2x`节点的输出：

- (1) 将本车`obu`发来的数据解析后，封装成`Autosar`消息，转发给`mdc`各节点进行订阅；
- (2) 通过`udp`将`本车信息`发送给`本车obu`。